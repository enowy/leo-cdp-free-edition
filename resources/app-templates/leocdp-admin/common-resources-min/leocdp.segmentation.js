'use strict';var loadSegmentStatistics=function(c){var d=$("#donut_chart").empty().width(),f=d-140,a=c.totalProfilesInCdp;if(0==a)$("#donut_chart").html("\x3cbr\x3e No data available! ");else if(!1===c){var b=[{count:0,color:"#000000"},{count:100,color:"#f8b70a"}];renderDonutChart("#donut_chart",b,0,d,d,f,0)}else{b=[{count:c.totalProfilesInSegment,color:"#000000"},{count:a-c.totalProfilesInSegment,color:"#f8b70a"}];var e=c.totalProfilesInSegment;c=(c.totalProfilesInSegment/a).toFixed(2);c=Math.floor(100*
c);renderDonutChart("#donut_chart",b,e,d,d,f,c)}},deleteSegment=deleteSegment||function(){if("object"===typeof segmentDataModel&&""!=window.segmentDataModel.id){$("#delete_callback").val("");$("#confirmDeleteDialog").modal({focus:!0});var c="deleteSegment"+segmentDataModel.id;window[c]=function(){LeoAdminApiUtil.callPostAdminApi(baseAdminApi+"/cdp/segment/delete",{id:segmentDataModel.id},function(d){0===d.httpCode?!0===d.data?iziToast.success({title:"OK",message:'Successfully deleted the segment "'+
segmentDataModel.name+'"',onClosing:function(f,a,b){location.hash="calljs-leoCdpRouter('Customer_Segment_List')"}}):iziToast.error({title:"Error",message:d.data,onClosing:function(f,a,b){location.reload(!0)}}):($("#error-on-save").html(d.errorMessage).show().delay(5E3).fadeOut("slow"),LeoAdminApiUtil.logErrorPayload(d))})};$("#delete_callback").val(c);$("#deletedInfoTitle").html(segmentDataModel.name);$("#deletedInfoMsg").html("Do you want to delete this segment ?")}},loadSegmentBuilder=function(c,
d,f,a){c=[{id:"visitorId",label:"Visitor ID",type:"string",operators:getOperatorsForStringField()},{id:"crmRefId",label:"CRM ID",type:"string",operators:getOperatorsForStringField()},{id:"firstName",label:"First Name",type:"string",operators:getOperatorsForStringField()},{id:"lastName",label:"Last Name",type:"string",operators:getOperatorsForStringField()},{id:"primaryEmail",label:"Primary Email",type:"string",operators:getOperatorsForStringField()},{id:"primaryPhone",label:"Primary Phone",type:"string",
operators:getOperatorsForStringField()},{id:"livingLocation",label:"Living Location",type:"string",operators:["contains"]},{id:"mainNationality",label:"Primary Nationality",type:"string",operators:["contains"]},{id:"gender",label:"Gender",type:"integer",input:"radio",values:{0:"Female",1:"Male",2:"Lesbian",3:"Gay",4:"Bisexual",5:"Transgender",6:"Unknown"},operators:["equal","not_equal"]},{id:"age",label:"Age",type:"integer",validation:{min:16,step:1},operators:getOperatorsForNumberField()},{id:"personalProblems",
label:"Personal Problems",type:"string",operators:["contains_any","not_contains_any"]},{id:"personalInterests",label:"Personal Interests",type:"string",operators:["contains_any","not_contains_any"]},{id:"solutionsForCustomer",label:"Solutions For Customer",type:"string",operators:["contains_any","not_contains_any"]},{id:"mediaChannels",label:"Reachable Media Channels",type:"string",operators:["contains_any","not_contains_any"]},{id:"contentKeywords",label:"Content Marketing Keywords",type:"string",
operators:["contains_any","not_contains_any"]},{id:"jobTitles",label:"Job Title",type:"string",operators:["contains_any","not_contains_any"]},{id:"learningHistory",label:"Learning History",type:"string",operators:["contains_any","not_contains_any"]},{id:"workingHistory",label:"Working History",type:"string",operators:["contains_any","not_contains_any"]},{id:"businessIndustries",label:"Business Industry",type:"string",operators:["contains_any","not_contains_any"]},{id:"behavioralEvents",label:"Behavioral Events",
type:"string",input:"select",values:c,operators:["contains_any","not_contains_any"]},{id:"funnelStage",label:"Funnel Stage",type:"string",input:"select",values:{"new-visitor":"New Visitor","returning-visitor":"Returning Visitor",lead:"Lead",prospect:"Prospect","new-customer":"New Customer","engaged-customer":"Engaged Customer","happy-customer":"Happy Customer","brand-advocate":"Brand Advocate","unhappy-customer":"Unhappy Customer"},operators:["equal","not_equal"]},{id:"type",label:"Profile Type",
type:"integer",input:"select",values:{0:"Anonymous Visitor",1:"Direct Customer",2:"Internal User",3:"Key Influencer",4:"Imported Contact",5:"Key Account",6:"Partner",7:"Integrator",8:"Competitor",9:"Gatekeeper",10:"Social Login User",11:"Manually Input Contact"},operators:["equal","not_equal"]},{id:"dataContext",label:"Data Context",type:"integer",input:"radio",values:{1:"Production Data",0:"Test Data","-1":"Fake Data"},operators:["equal","not_equal"]},{id:"receiveNotification",label:"Receive Notification",
type:"integer",input:"radio",values:{0:"No data",1:"Subscribed","-1":"Unsubscribed"},operators:["equal","not_equal"]},{id:"receiveEmail",label:"Receive Email",type:"integer",input:"radio",values:{0:"No data",1:"Subscribed","-1":"Unsubscribed"},operators:["equal","not_equal"]},{id:"receiveMobileSms",label:"Receive Mobile SMS",type:"integer",input:"radio",values:{0:"No data",1:"Subscribed","-1":"Unsubscribed"},operators:["equal","not_equal"]},{id:"journeyScore",label:"Percentage Journey Score",type:"integer",
validation:{min:0,max:100,step:1},operators:getOperatorsForNumberField()},{id:"totalLoyaltyPoints",label:"Total Loyalty Points",type:"integer",validation:{step:1,min:0},operators:getOperatorsForNumberField()},{id:"totalCreditScore",label:"Customer Credit Score",type:"integer",validation:{min:0,max:100,step:1},operators:getOperatorsForNumberField()},{id:"totalProspectScore",label:"Total Prospect Score",type:"integer",validation:{step:1},operators:getOperatorsForNumberField()},{id:"totalLeadScore",
label:"Total Lead Score",type:"integer",validation:{min:0,max:100,step:1},operators:getOperatorsForNumberField()},{id:"dataQualityScore",label:"Data Quality Score",type:"integer",validation:{min:0,max:100,step:1},operators:getOperatorsForNumberField()},{id:"totalEngagementScore",label:"Customer Engagement Score",type:"integer",validation:{min:0,step:1},operators:getOperatorsForNumberField()},{id:"totalCAC",label:"Customer Acquisition Cost",type:"double",validation:{min:0,step:.01},operators:getOperatorsForNumberField()},
{id:"totalCLV",label:"Customer Lifetime Value",type:"double",validation:{step:.01},operators:getOperatorsForNumberField()},{id:"totalTransactionValue",label:"Total Transaction Value",type:"double",validation:{min:0,step:.01},operators:getOperatorsForNumberField()},{id:"totalCFS",label:"Customer Feedback Score",type:"integer",validation:{min:0,max:100,step:1},operators:getOperatorsForNumberField()},{id:"totalCSAT",label:"Customer Satisfaction Score",type:"integer",validation:{min:0,max:100,step:1},
operators:getOperatorsForNumberField()},{id:"totalNPS",label:"Net Promoter Score",type:"integer",validation:{min:0,max:100,step:1},operators:getOperatorsForNumberField()},{id:"totalCES",label:"Customer Effort Score",type:"integer",validation:{min:0,max:100,step:1},operators:getOperatorsForNumberField()},{id:"rfeScore",label:"RFE Score",type:"integer",validation:{min:0,step:1},operators:getOperatorsForNumberField()},{id:"rfmScore",label:"RFM Score",type:"integer",validation:{min:0,step:1},operators:getOperatorsForNumberField()}];
d=d||!1;var b=_.union(getOperatorsForStringField(),getOperatorsForNumberField());b.push({type:"contains_any",optgroup:"custom",nb_inputs:1,multiple:!0,apply_to:["string","number","boolean"]});b.push({type:"not_contains_any",optgroup:"custom",nb_inputs:1,multiple:!0,apply_to:["string","number","boolean"]});$("#segment-builder-holder").queryBuilder({plugins:["bt-tooltip-errors"],operators:b,filters:c,rules:d});f?($("#segment-builder-holder").find("input,select").attr("disabled","disabled"),$("#segment-builder-holder button").hide()):
"function"===typeof a&&a()},loadProfilesInSegment=function(c){var d=$("#profile_list_querybuilder");segmentDataModel&&(!0===c?(d.DataTable().clear(),d.DataTable().ajax.reload()):loadProfileViewByAjax(d,"/cdp/segment/query-builder"))},loadProfileViewByAjax=function(c,d){var f=getUserSession();f&&c.DataTable({lengthMenu:[[20,30,50],[20,30,50]],processing:!0,serverSide:!0,searching:!1,serverMethod:"POST",ajax:{url:d,contentType:"application/json",beforeSend:function(a){a.setRequestHeader("leouss",f)},
data:function(a){var b=$("#segment-builder-holder").queryBuilder("getRules");a.jsonQueryRules=JSON.stringify(b);a.beginFilterDate=segmentDataModel.beginFilterDate;a.endFilterDate=segmentDataModel.endFilterDate;return JSON.stringify(a)}},columnDefs:[{render:function(a,b,e){b="Anonymous Person";try{var g=e.firstName||"",h=e.lastName||"";0<g.length&&0<h.length&&(b=textTruncate(g+" "+h,30))}catch(k){console.log(k)}return'\x3ca target\x3d"_blank" title\x3d"Profile Report" href\x3d"#calljs-leoCdpRouter(\'Customer_Profile_Info\',\''+
(a+"')\" \x3e")+b+"\x3c/a\x3e"},targets:0},{render:function(a,b,e){return'\x3cdiv class\x3d"datatable_text"\x3e'+a+"\x3c/div\x3e"},targets:1},{render:function(a,b,e){b="No information";0===a?b="Female":1===a?b="Male":2===a&&(b="LGBT");return'\x3cdiv class\x3d"datatable_text"\x3e'+b+"\x3c/div\x3e"},targets:2},{render:function(a,b,e){return null!=a||""!=a?'\x3cdiv class\x3d"datatable_text"\x3e\x3ca title\x3d"Profile Report" href\x3d"#calljs-leoCdpRouter(\'Customer_Profile_Info\',\''+(e.id+"')\" \x3e"+
textTruncate(a,25)+"\x3c/a\x3e\x3c/div\x3e"):""},targets:3},{render:function(a,b,e){return'\x3cdiv class\x3d"datatable_text text-center"\x3e'+(new Number(a)).toLocaleString()+"\x3c/div\x3e"},targets:4},{render:function(a,b,e){return'\x3cdiv class\x3d"datatable_text text-center"\x3e'+a+"\x3c/div\x3e"},targets:5},{render:function(a,b,e){return a?'\x3cdiv class\x3d"small"\x3e'+moment.utc(new Date(a)).local().format("YYYY-MM-DD HH:mm:ss")+"\x3c/div\x3e":""},targets:6},{render:function(a,b,e){a=e.lastTouchpoint?
e.lastTouchpoint.name:"";return'\x3cdiv class\x3d"datatable_text" title\x3d"'+a+'" \x3e'+textTruncate(a,30)+"\x3c/div\x3e"},targets:7}],columns:[{data:"id"},{data:"age"},{data:"gender"},{data:"primaryEmail"},{data:"dataQualityScore"},{data:"funnelStage"},{data:"updatedAt"},{data:"lastTouchpoint"}]})};