'use strict';var connectorStatusReadyHtml='\x3ci class\x3d"fa fa-check-square" aria-hidden\x3d"true" style\x3d"font-size:1.1em"\x3e\x3c/i\x3e API Key is active',dataConnectorMap={},renderDataConnector=function(a){var b=$("#data_connectors_holder").empty().show();dataConnectorMap={};_.forEach(a,function(c,d){d=c.id;dataConnectorMap[d]=c;var e=!1;c.configs.service_api_key&&""!=c.configs.service_api_key?(c.service_api_key=c.configs.service_api_key.substr(0,5)+"...",e=!0):c.service_api_key="";var f=_.template($("#tpl_data_connector_view").html());
b.append(f(c));b.find("i.config_description").tooltip();e&&$("#connector_box_"+d).addClass("active_connector_box");1===c.status&&$("#"+d+"_api_key_label").html(connectorStatusReadyHtml).addClass("config_ready")});$("#connectors_tooltip").tooltip()},dataConnectorLoader=function(a,b,c,d,e,f,g,h){a={keywords:a,filterConnectorValue:b,startIndex:f,numberResult:g};a.forPersonalization=c;a.forDataEnrichment=d;a.forSynchronization=e;LeoAdminApiUtil.getSecuredData("/cdp/data-connector/list",a,function(k){"function"===
typeof h&&"object"===typeof k.data&&h(k.data)})},loadDataConnectors=function(a,b){$("#data_connectors_pagination").empty();$("#data_connectors_loader").show();$("#data_connectors_holder").hide();var c=!0,d=!0,e=!0;"active_for_personalization"===b?e=d=!1:"active_for_enrichment"===b?e=c=!1:"active_for_synchronization"===b&&(c=d=!1);dataConnectorLoader(a,b,c,d,e,0,1E4,function(f){$("#data_connectors_loader").hide();0<f.length?$("#data_connectors_pagination").pagination({dataSource:f,className:"paginationjs paginationjs-big",
pageSize:6,callback:function(g,h){renderDataConnector(g)},beforePageOnClick:function(){}}):$("#data_connectors_holder").show().html('\x3cdiv class\x3d"col-lg-12 row highlight_text"\x3e \x3ch4 style\x3d"text-align: center;" \x3eNo data available !\x3c/h4\x3e \x3c/div\x3e')})};function resetConnectorFilter(){$("#filter_connectors_keywords").val("");$("#select_filter_connectors").val("all");doConnectorFilter()}
function doConnectorFilter(){var a=$("#filter_connectors_keywords"),b=$("#select_filter_connectors");a=a.val();b=b.val();loadDataConnectors(a,b)}
function saveDataConnectorInfo(a){a=$(a).data("id");var b=dataConnectorMap[a];b.name=$("#connectorName").val().trim();b.description=$("#connectorDescription").val().trim();b.forDataEnrichment=$("#forDataEnrichment").prop("checked");b.forPersonalization=$("#forPersonalization").prop("checked");b.forSynchronization=$("#forSynchronization").prop("checked");var c=b.configs||{};$("#connectorConfigList input").each(function(){var e=$(this).attr("name"),f=$(this).attr("type");c[e]="number"===f?parseInt($(this).val()):
"checkbox"===f?$(this).prop("checked"):$(this).val()});b.configs=c;b.status=b.configs.service_api_key&&""!=b.configs.service_api_key?1:0;if(""===b.name)notifyErrorMessage("Connector name is empty, please enter a name");else{a={objectJson:JSON.stringify(b)};var d=function(e){null!=e?($("#dialogSetConnectorInfo").modal("hide"),notifySuccessMessage('The config of data connector "\x3cb\x3e'+b.name+'\x3c/b\x3e" is saved OK!'),loadDataConnectors()):console.error("saveDataConnectorInfo ",e)};LeoAdminApiUtil.callPostAdminApi("/cdp/data-connector/save",
a,function(e){0===e.httpCode&&""===e.errorMessage?d(e.data):LeoAdminApiUtil.logErrorPayload(e)},d)}}function newDataConnector(){LeoAdminApiUtil.getSecuredData("/cdp/data-connector/get",{connectorName:"",connectorId:""},function(a){a=a.data;showDataConnectorDialog(a);dataConnectorMap[a.id]=a})}function loadDataConnector(a){var b=dataConnectorMap[a];"object"===typeof b?showDataConnectorDialog(b):notifyErrorMessage("Can not load data for connector: "+a)}
function resetDataConnector(a){$("#"+a+"_api_key").val("");$("#"+a+"_api_url").val("");var b=dataConnectorMap[a];_.forOwn(b.configs,function(d,e){b.configs.service_api_url="";b.configs.service_api_key=""});b.status=0;var c=function(d){null!=d?(iziToast.success({title:"Data Connector",message:"The config of \x3cb\x3e"+b.name+"\x3c/b\x3e is reset OK!",timeout:3E3}),loadDataConnectors()):console.error("resetDataConnector ",d)};a={objectJson:JSON.stringify(b)};LeoAdminApiUtil.callPostAdminApi("/cdp/data-connector/save",
a,function(d){0===d.httpCode&&""===d.errorMessage?c(d.data):LeoAdminApiUtil.logErrorPayload(d)},c)}
function deleteDataConnector(a){$("#delete_callback").val("");$("#confirmDeleteDialog").modal({focus:!0});if(a){var b="deleteDataConnector"+a;window[b]=function(){LeoAdminApiUtil.callPostAdminApi("/cdp/data-connector/delete",{connectorId:a},function(c){0===c.httpCode&&""===c.errorMessage?c.data===a?(iziToast.success({title:"Data Connector",message:"The connector \x3cb\x3e"+a+"\x3c/b\x3e is successfully deleted!",timeout:3E3}),loadDataConnectors()):console.error("deleteDataConnector ",c):LeoAdminApiUtil.logErrorPayload(c)})};
$("#delete_callback").val(b);$("#deletedInfoTitle").text("Connector ID: "+a).show();$("#deletedInfoMsg").text("Do you want to delete the selected connector permanently?")}}
function showDataConnectorDialog(a){if("string"!==typeof a.id)notifyErrorMessage("Invalid data connector: "+a);else{$("#dialogSetConnectorInfo").modal({backdrop:"static",keyboard:!1});var b=a.id;$("#dataConnectorSaveButton").data("id",b);$("#connectorName").val(a.name);$("#connectorDescription").val(a.description);$("#connectorBuiltIn").prop("checked",a.builtInConnector);$("#forPersonalization").prop("checked",a.forPersonalization);$("#forDataEnrichment").prop("checked",a.forDataEnrichment);$("#forSynchronization").prop("checked",
a.forSynchronization);var c=$("#connectorConfigList");c.empty();_.forOwn(a.configs,function(d,e){var f={inputName:e};f.inputType="number"===typeof d?"number":"boolean"===typeof d?"checkbox":"text";var g=_.template($("#tpl_config_row_item").html());c.append(g(f));"checkbox"===f.inputType?c.find('input[name\x3d"'+e+'"]').prop("checked",d):c.find('input[name\x3d"'+e+'"]').val(d)})}};