'use strict';const eventDataTypes=[{name:"First-party Data",id:1},{name:"Second-party Data",id:2},{name:"Third-party Data",id:3}],journeyStages=[{name:"AWARENESS",id:1},{name:"ATTRACTION",id:2},{name:"ASK",id:3},{name:"ACTION",id:4},{name:"ADVOCACY",id:5}],journeyStagesMap={1:"AWARENESS",2:"ATTRACTION",3:"ASK",4:"ACTION",5:"ADVOCACY"},scoringModels=[{name:"LEAD",id:1},{name:"PROSPECT",id:2},{name:"ENGAGEMENT",id:3},{name:"DATA_QUALITY",id:4},{name:"ACQUISITION",id:5},{name:"LIFETIME_VALUE",id:6},
{name:"CX_EFFORT",id:7},{name:"CX_SATISFACTION",id:8},{name:"CX_FEEDBACK",id:9},{name:"CX_PROMOTER",id:10},{name:"CREDIT_SCORING",id:11},{name:"CX_LOYALTY",id:12},{name:"CX_DETRACTOR",id:13}],CheckBoxIcon=function(a){jsGrid.Field.call(this,a)};
CheckBoxIcon.prototype=new jsGrid.Field({sorter:function(a,b){return 0},itemTemplate:function(a){return getCheckedBoxIcon(a)},insertTemplate:function(a){return this._insertCode=a},editTemplate:function(a){return this._editCode=a},insertValue:function(){return this._insertCode},editValue:function(){return this._editCode}});jsGrid.fields.CheckBoxIcon=CheckBoxIcon;var CustomCheckBox=function(a){jsGrid.Field.call(this,a)};
CustomCheckBox.prototype=new jsGrid.Field({sorter:function(a,b){return 0},itemTemplate:function(a){return'\x3cdiv class\x3d"text-center"\x3e'+getCheckedBoxIcon(a)+"\x3c/div\x3e"},insertTemplate:function(a){var b=$('\x3cinput type\x3d"checkbox" \x3e');a&&b.attr("checked","checked");return this._insertCheckbox=$('\x3cdiv class\x3d"text-center"\x3e'+b[0].outerHTML+"\x3c/div\x3e")},editTemplate:function(a){var b=$('\x3cinput type\x3d"checkbox" \x3e');a&&b.attr("checked","checked");return this._editCheckbox=
$('\x3cdiv class\x3d"text-center"\x3e'+b[0].outerHTML+"\x3c/div\x3e")},insertValue:function(){return 0<this._insertCheckbox.find("input:checked").length},editValue:function(){return 0<this._editCheckbox.find("input:checked").length}});jsGrid.fields.CustomCheckBox=CustomCheckBox;const UrlLink=function(a){jsGrid.Field.call(this,a)};
UrlLink.prototype=new jsGrid.Field({sorter:function(a,b){return 0},itemTemplate:function(a){var b=45<a.length?a.substring(0,45)+"...":a;return 0===a.indexOf("https://plus.codes/")?'\x3ca href\x3d"javascript:" style\x3d"font-size:11.5px" data-url\x3d"'+a+'" onclick\x3d"openLocationUrl(this)" \x3e'+b+"\x3c/a\x3e":'\x3ca href\x3d"'+a+'"  style\x3d"font-size:11.5px" target\x3d"_blank" \x3e'+b+"\x3c/a\x3e"},insertTemplate:function(a){return this._insertCode=a},editTemplate:function(a){return this._editCode=
a},insertValue:function(){return this._insertCode},editValue:function(){return this._editCode}});jsGrid.fields.UrlLink=UrlLink;const BoldText=function(a){jsGrid.Field.call(this,a)};BoldText.prototype=new jsGrid.Field({sorter:function(a,b){return 0},itemTemplate:function(a){return"\x3cb\x3e"+a+"\x3c/b\x3e"},insertTemplate:function(a){return this._insertCode=a},editTemplate:function(a){return this._editCode=a},insertValue:function(){return this._insertCode},editValue:function(){return this._editCode}});
jsGrid.fields.BoldText=BoldText;
const refreshJourneyMapView=function(){currentJourneyMapId&&(location.hash="#calljs-leoCdpRouter('Data_Journey_Map','"+currentJourneyMapId+"','_refresh_"+(new Date).getTime()+"')")},updateJourneyMap=function(a){a={touchpointHubJson:JSON.stringify($("#touchpoint_hub_table").jsGrid("option","data")),journeyMapId:currentJourneyMapId};LeoAdminApiUtil.callPostAdminApi("/cdp/journeymap/save",a,function(b){0===b.httpCode&&""===b.errorMessage?""!=b.data?refreshJourneyMapView():console.error("updateJourneyMap ",
rs):LeoAdminApiUtil.logErrorPayload(b)})},loadFeedbackTemplateItems=function(a,b){LeoAdminApiUtil.getSecuredData("/cdp/asset-item/asset-templates",{obsid:a},function(d){cxFeedbackTemplates=d.data.cxFeedbackTemplates;landingPageTemplates=d.data.landingPageTemplates;b()})},loadEventMetrics=function(){LeoAdminApiUtil.getSecuredData("/cdp/funnel/event-metrics",{},function(a){eventMetrics=a.data})};
var loadJourneyTemplate=function(){iziToast.info({title:"Information",message:"This function is under development and is not yet available"})},jsGridItemUrlTemplate=function(a){a=a.trim();a=$("\x3ca\x3e").attr("href","javascript:").attr("title",a).attr("onclick","openUrlInNewTab(event,this)").text(a);return $('\x3cdiv class\x3d"long_url_holder" \x3e\x3c/div\x3e').append(a)};
function initJourneyMapNameEditor(){var a="Journey Map: "+(new Date).toDateString(),b=function(d){LeoAdminApiUtil.callPostAdminApi("/cdp/journeymap/update-name",{journeyMapName:d,journeyMapId:currentJourneyMapId},function(e){0===e.httpCode&&""===e.errorMessage?(iziToast.success({title:"Data Journey Map",message:"\x3cb\x3e"+d+"\x3c/b\x3e is updated successfully!",timeout:2500}),loadJourneyMapList(!0)):LeoAdminApiUtil.logErrorPayload(e)})};$("#journeyMapNameEditor").blur(function(){var d=$(this).val().trim();
d=""===d?a:d;$("#journeyMapNameEditor").hide();$("#journeyMapName").text()!==d?($("#journeyMapName").text(d).show(),b(d)):$("#journeyMapName").show()});$("#journeyMapNameEditor").keyup(function(d){"13"==(d.keyCode?d.keyCode:d.which)&&(d=$(this).val().trim(),d=""===d?a:d,$("#journeyMapNameEditor").hide(),$("#journeyMapName").text()!==d?($("#journeyMapName").text(d).show(),b(d)):$("#journeyMapName").show())})}
function loadJourneyStagesList(a){var b=$("#journeyStagesList");journeyStages.forEach(function(d){b.append('\x3coption value\x3d"'+d.id+'" \x3e'+d.name+"\x3c/option\x3e")});b.val("1").change();b.chosen({width:"100%",no_results_text:"Oops, nothing found!"}).trigger("chosen:updated").change(function(){"function"===typeof a&&a($(this).val())})}
function loadJourneyMapList(a,b,d){var e=$("#journeyMapList");!0===a&&e.find("option").remove().trigger("chosen:updated");LeoAdminApiUtil.getSecuredData("/cdp/journeymap/list-all",{},function(c){0===c.httpCode&&""===c.errorMessage?(c=c.data,!0===d&&e.append('\x3coption value\x3d"" \x3e All Data from All Journeys\x3c/option\x3e'),c.forEach(function(g){e.append('\x3coption value\x3d"'+g.id+'" \x3e'+g.name+"\x3c/option\x3e")}),"string"===typeof currentJourneyMapId?e.val(currentJourneyMapId).change():
e.val("").change(),e.chosen({width:"100%",no_results_text:"Oops, nothing found!"}).trigger("chosen:updated").change(function(){if("function"===typeof b){var g=$(this).val();b(g);"string"===typeof currentJourneyMapId&&(currentJourneyMapId=g)}else window.currentJourneyMapId=$(this).val(),refreshJourneyMapView()})):LeoAdminApiUtil.logErrorPayload(c)})}function editJourneyMapName(){$("#journeyMapNameEditor").val($("#journeyMapName").text()).show().focus();$("#journeyMapName").hide()}
function createNewJourneyMap(){$("#dialogCreateNewJourneyMap").modal({backdrop:"static",keyboard:!1})}
function saveNewJourneyMap(){var a=$("#newJourneyMapName").val();5>=a.length?iziToast.error({title:"Journey Map Creation",message:"The journey map \x3cb\x3e"+a+"\x3c/b\x3e is too short, please enter at least 6 characters !",timeout:3E3}):($("#dialogCreateNewJourneyMap").modal("hide"),setTimeout(function(){LeoAdminApiUtil.callPostAdminApi("/cdp/journeymap/create-new",{journeyMapName:a},function(b){0===b.httpCode&&""===b.errorMessage?"string"===typeof b.data&&(currentJourneyMapId=b.data,iziToast.success({title:"Journey Map Creation",
message:"The journey map \x3cb\x3e"+a+"\x3c/b\x3e has been created created successfully !",timeout:3E3}),refreshJourneyMapView()):LeoAdminApiUtil.logErrorPayload(b)})},1E3))}
function deleteCurrentJourneyMap(){if("string"===typeof currentJourneyMapId&&"id_default_journey"!=currentJourneyMapId){var a=$("#journeyMapList").find("option:checked").text();$("#delete_callback").val("");$("#confirmDeleteParentChildDialog").modal({focus:!0});$("#deleteChildItemMsg").text("Delete all touchpoint hubs and related data in this journey map!");$("#deleteChildItemCheckbox").prop("checked",!0);$("#deleteChildItem").show();var b="deleteJourneyMap"+currentJourneyMapId;window[b]=function(){var d=
baseLeoAdminUrl+"/cdp/journeymap/delete";$("#deleteChildItemCheckbox").is(":checked");LeoAdminApiUtil.callPostAdminApi(d,{journeyMapId:currentJourneyMapId},function(e){0===e.httpCode?!0===e.data?($("#deleteChildItem").hide(),$("#deleteChildItemMsg").text(""),iziToast.success({title:"OK",message:'Successfully deleted the journey map "'+a+'"',onClosing:function(c,g,h){currentJourneyMapId="id_default_journey";refreshJourneyMapView()}})):iziToast.error({title:"Error",message:e.data,onClosing:function(c,
g,h){locatio.href="/admin"}}):($("#error-on-save").html(e.errorMessage).show().delay(5E3).fadeOut("slow"),LeoAdminApiUtil.logErrorPayload(e))})};$("#delete_parent_callback").val(b);$("#deletedParentInfoTitle").text(a);$("#deletedParentInfoMsg").text("Do you want to delete the journey map ?")}}
var loadJourneyMap=function(a,b,d){LeoAdminApiUtil.getSecuredData("/cdp/journeymap/get",{id:a},function(e){if(0<e.errorCode)iziToast.error({title:"Data Journey Map",message:e.errorMessage});else{var c=e.data.journeyMap;e=c.defaultMetricName;var g=c.name,h=c.journeyStages,l=c.journeyLinks,n=c.journeyNodes;c=c.touchpointHubMap;$(d).text(g);renderJourneyFlowChart(b,e,h,n,l,c)}})},loadJourneyMapAndTouchpointHubs=function(a,b,d,e){LeoAdminApiUtil.getSecuredData("/cdp/journeymap/get",{id:a},function(c){if(0<
c.errorCode)iziToast.error({title:"Data Journey Map",message:c.errorMessage});else{var g=c.data.touchpointHubTypes,h=c.data.journeyMap,l=h.defaultMetricName,n=h.name,q=h.journeyStages,t=h.journeyLinks,m=h.journeyNodes,p=h.touchpointHubIndex,u=h.touchpointHubMap;$(d).text(n);renderJourneyFlowChart(b,l,q,m,t,u);h=[];for(n in u)l=p[n],q=u[n],q.index=l+1,h[l]=q;n=[];for(p=1;30>=p;p++)n.push({Name:"[ "+p+" ]",Id:p});var w=[];Object.keys(g).forEach(f=>{var k=parseInt(f);0<k&&w.push({typeName:g[f].replaceAll("_",
" "),type:k})});p=c.canInsertData;l=c.canEditData;c=c.canDeleteData;var v=-1;$(e).jsGrid({width:"100%",height:"auto",inserting:p,editing:l,sorting:!0,paging:!1,deleteConfirm:function(f){return"The touchpoint hub ["+f.name+"] will be removed. Are you sure?"},data:h,onItemInserting:function(f){console.log(f.item);var k=f.item.url,r=f.item.type;null!=u[f.item.name]?(f.cancel=!0,iziToast.error({title:"Data Journey Map",message:f.item.name+" is duplicated, please enter a different name !"})):!isValidURL(k)&&
30>=r?(f.cancel=!0,iziToast.error({title:"Data Journey Map",message:k+" is not valid URL !"})):30==r?(f.cancel=!0,iziToast.error({title:"Data Journey Map",message:"Can not have more than one data observer !"})):0<v&&(f.item.index=v,v=-1)},onItemUpdating:function(f){console.log(f.item);var k=f.item,r=k.type,x=k.name;k=k.url;30!=r?isValidURL(k)||31==r||(f.cancel=!0,iziToast.error({title:"Data Journey Map",message:k+" is not valid URL !"})):(f.cancel=!0,iziToast.error({title:"Data Journey Map",message:x+
" is read-only touchpoint, you can not update it !"}))},onItemInserted:function(f){iziToast.success({title:"Data Journey Map",message:f.item.name+" is inserted successfully!",timeout:2500,onClosed:function(){updateJourneyMap(!0)}})},onItemUpdated:function(f){iziToast.success({title:"Data Journey Map",message:f.item.name+" is updated successfully!",timeout:2500,onClosed:function(){updateJourneyMap(!1)}})},onItemDeleting:function(f){var k=f.item,r=k.name;0<k.type&&30>k.type||(f.cancel=!0,iziToast.error({title:"Data Journey Map",
message:r+" is read-only touchpoint hub, you can not delete it !"}))},onItemDeleted:function(f){u[f.item.name]=null;LeoAdminApiUtil.callPostAdminApi("/cdp/touchpointhub/delete",{id:f.item.id},function(k){0===k.httpCode&&""===k.errorMessage?iziToast.success({title:"Data Journey Map",message:f.item.name+" is deleted successfully!",timeout:2500,onClosed:function(){updateJourneyMap(!1)}}):LeoAdminApiUtil.logErrorPayload(k)})},onRefreshed:function(f){var k=f.grid._insertRow;f=f.grid._bodyGrid;console.log(k);
v=parseInt($(".jsgrid-grid-body tbody tr:last td:first").text())+1;$(k).find("td:first").text(v);$("\x3ctfoot\x3e\x3c/tfoot\x3e").appendTo(f).append(k)},fields:[{name:"index",title:"",type:"number",width:15,editing:!1,align:"center"},{name:"name",title:"Name",type:"text",width:60,validate:"required",align:"center",css:"touchpoint_hub_name"},{name:"type",title:"Type",type:"select",items:w,valueField:"type",textField:"typeName",width:58,insertTemplate:function(){var f=jsGrid.fields.select.prototype.insertTemplate.call(this);
f.change(function(){30==$(this).val()&&(iziToast.error({title:"Data Journey Map",message:"Can not have more than one data observer !"}),$("#touchpoint_hub_table").jsGrid("cancelEdit"))});return f},editTemplate:function(f){var k=jsGrid.fields.select.prototype.editTemplate.call(this,f);return 30==f?"LEO CDP OBSERVER":k}},{name:"journeyLevel",title:"Level",type:"select",items:n,valueField:"Id",textField:"Name",width:24},{name:"firstPartyData",title:"First-party Data",type:"CustomCheckBox",validate:"required",
width:34,align:"center"},{name:"url",title:"URL",type:"text",itemTemplate:jsGridItemUrlTemplate,validate:"required",align:"center"},{type:"control",deleteButton:c,width:30}]});p&&l||$("#touchpoint_hub_table").find(".jsgrid-button").click(errorNoAuthorization)}})};
const getJsCodeEventTrackingFunctions=function(){var a="",b=0;eventMetrics.forEach(function(d){if(!0===d.showInObserverJS){b++;var e="#leo-tracking-view-event-code-tpl";3===d.journeyStage||4===d.journeyStage||5===d.journeyStage?e=6===d.scoreModel?"#leo-tracking-conversion-event-code-tpl":"#leo-tracking-action-event-code-tpl":6===d.journeyStage&&(e="#leo-tracking-feedback-event-code-tpl");e=_.template($(e).html());d={counter:b,eventMetricId:d.id,eventMetricName:d.eventLabel.replaceAll(" ","")};a+=
e(d)}});return a},getTrackingJsCode=function(a){a=JSON.parse(decodeURIComponent($(a).data("json")));var b=a.id,d=a.name,e=a.type;a=a.dataSourceUrl;var c=window.baseLeoObserverDomain,g=window.baseStaticDomain,h=getJsCodeEventTrackingFunctions();if(0<e&&12>e){$("#webDataObserverCodeDialog").modal({backdrop:"static",keyboard:!1});$("#code_holder .CodeMirror").remove();e=$("#webDataObserverCodeDialog .code")[0];var l=CodeMirror.fromTextArea(e,{mode:"htmlmixed",lineNumbers:!0,styleActiveLine:!0,matchBrackets:!0,
readOnly:!1});l.setSize(null,480);setTimeout(function(){var n=function(){var q=$("#leo_observer_auto_track").is(":checked"),t=$("#leo_observer_auto_collect_UTM").is(":checked"),m=$("#webDataObserverCodeDialog .code").val().trim().replace("__leoObserverId__",b);m=m.replace("__tpHubName__",d);m=m.replace("__leoObserverDomain__",c);m=m.replace("__staticFileDomain__",g);m=m.replace("__eventTrackingFunctions__",h);m=q?t?m.replace("__autoTrackingFunctions__","LeoObserver.recordEventPageView(parseDataUTM())"):
m.replace("__autoTrackingFunctions__","LeoObserver.recordEventPageView()"):m.replace("__autoTrackingFunctions__","// No auto tracking, please call it yourself");l.getDoc().setValue("\x3cscript\x3e\n"+m+"\n\x3c/script\x3e");l.refresh();l.execCommand("selectAll")};$("#leo_observer_auto_track, #leo_observer_auto_collect_UTM").change(function(){n()});n();addHandlerCopyCodeButton("#webDataObserverCodeDialog .code","#webDataObserverCodeDialog button.btn-copy-code")},350);e=$("#testObserverChromeExtBtn");
e.attr({leoObserverId:b,leoObserverDomain:c,staticFileDomain:g,dataSourceUrl:a});e.click(function(){var n=$(this).attr("leoObserverId"),q=$(this).attr("leoObserverDomain"),t=$(this).attr("staticFileDomain"),m=$(this).attr("dataSourceUrl");m=0<m.indexOf("?")?m:m+"?";window.open(m+"_leoObserverLogDomain\x3d"+q+"\x26_leoObserverId\x3d"+n+"\x26_leoObserverCdnDomain\x3d"+t,"_blank")})}else notifyErrorMessage("Can not get tracking code of offline touchpoint, please use QR code")},getCxFeedbackJsCode=function(a){a=
JSON.parse(decodeURIComponent($(a).data("json")));var b=a.id,d=a.type;30>d?loadFeedbackTemplateItems(b,function(){var e=function(h){var l="https://"+baseUploadDomain+h.qrCodeUrl.replace("./","/");$("#cx_qrHrefUrl").attr("href",l);$("#cx_qrImgSrc").attr("src",l);$("#cx_qrCodeImageURL").val(l);h="https://"+baseLeoObserverDomain+"/webform?tplid\x3d"+h.id+"\x26obsid\x3d"+b;$("#cx_qrFormURL").val(h)};if(0===$("#feedbackTemplateSelector option").length&&0<cxFeedbackTemplates.length)for(var c in cxFeedbackTemplates){var g=
'\x3coption value\x3d"'+c+'" \x3e'+cxFeedbackTemplates[c].title+"\x3c/option\x3e";$("#feedbackTemplateSelector").append(g)}$("#dialogEmbeddedCxFeedbackForm").modal({backdrop:"static",keyboard:!1});$("#feedbackTemplateSelector").val("0").change();0<d&&12>d?($("#tab_panel_cx_web_form").addClass("active").show().find("a").click(),$("#tab_panel_cx_qr_code").removeClass("active"),initEmbeddedFeedbackForm(b,"dialogEmbeddedCxFeedbackForm",cxFeedbackTemplates[0])):($("#tab_panel_cx_qr_code").addClass("active").find("a").click(),
$("#tab_panel_cx_web_form").removeClass("active").hide());e(cxFeedbackTemplates[0]);$("#feedbackTemplateSelector").chosen({width:"100%",no_results_text:"Oops, nothing found!"}).trigger("chosen:updated").change(function(){var h=parseInt($(this).val());h=cxFeedbackTemplates[h];initEmbeddedFeedbackForm(b,"dialogEmbeddedCxFeedbackForm",h);e(h)})}):notifyErrorMessage("Can not get feedback code for the touchpoint hub type \x3d "+d)},getWebLeadFormJsCode=function(a){a=JSON.parse(decodeURIComponent($(a).data("json")));
var b=a.id,d=a.name;a=a.type;if(0<a&&12>a){$("#webLeadFormCodeDialog").modal({backdrop:"static",keyboard:!1});$("#code_holder .CodeMirror").remove();a=$("#webLeadFormCodeDialog .code")[0];var e=CodeMirror.fromTextArea(a,{mode:"htmlmixed",lineNumbers:!0,styleActiveLine:!0,matchBrackets:!0,readOnly:!0});e.setSize(null,480);setTimeout(function(){var c=$("#webLeadFormCodeDialog .code").val().trim().replace("__leoObserverId__",b);c=c.replace("__tpHubName__",d);c=c.replace("__LeoObserverDomain__",baseLeoObserverDomain);
e.getDoc().setValue("\x3cscript\x3e\n"+c+"\n\x3c/script\x3e");e.refresh();e.execCommand("selectAll")},350)}},getQrImageFormCode=function(a){a=decodeURIComponent($(a).data("json"));a=JSON.parse(a);console.log("getQrImageFormCode ",a);var b=a.qrCodeData,d=window.baseUploadDomain;$("#qrImageFormCodeDialog").modal({backdrop:"static",keyboard:!1});a=b.landingPageUrl;var e=b.trackingUrl;b="https://"+d+b.qrCodeImage.replace("./","/");$("#qrHrefUrl").attr("href",b);$("#qrImgSrc").attr("src",b);$("#qrTouchpointHubURL").val(a);
$("#qrTrackingURL").val(e);$("#qrCodeImageURL").val(b)},getRecommenderJsCode=function(a){a=JSON.parse(decodeURIComponent($(a).data("json")));console.log("getRecommenderJsCode ",a);var b=a.id,d=a.name;a=a.type;if(0<a&&12>a){$("#dialogEmbeddedRecomender").modal({backdrop:"static",keyboard:!1});$("#dialogEmbeddedRecomender .CodeMirror").remove();a=$("#dialogEmbeddedRecomender .code")[0];var e=CodeMirror.fromTextArea(a,{mode:"htmlmixed",lineNumbers:!0,styleActiveLine:!0,matchBrackets:!0,readOnly:!1});
e.setSize(null,480);setTimeout(function(){var c=$("#dialogEmbeddedRecomender .code").val().trim().replace("__observerId__",b);c=c.replace("__tpHubName__",d);c=c.replace("__LeoObserverDomain__",baseLeoObserverDomain);var g="leo_recommender_"+b;e.getDoc().setValue('\x3cscript id\x3d"'+g+'"\x3e\n'+c+"\n\x3c/script\x3e");e.refresh();e.execCommand("selectAll");addHandlerCopyCodeButton("#dialogEmbeddedRecomender .code","#dialogEmbeddedRecomender button.btn-copy-code")},350)}},showRedisSourceInfo=function(a){a=
decodeURIComponent($(a).data("json"));var b=JSON.parse(a).dataSourceUrl.split("/");a=b[2];b=b[3];$("#dataSourceConfigHostAndPort").text(a);$("#dataSourceConfigTouchpointName").text(b);$("#redisSourceInfoDialog").modal({backdrop:"static",keyboard:!1})},showObserverApiInfo=function(a){a=decodeURIComponent($(a).data("json"));a=JSON.parse(a);a="string"===typeof a.accessTokens.default_key?a.accessTokens.default_key:"";$("#leoCdpApiTokenKey").val("default_key");$("#leoCdpApiTokenValue").val(a);$("#leoCdpGetProfileApiUrl").text(baseLeoObserverUrl+
"/api/profile");$("#leoCdpTrackEventApiUrl").text(baseLeoObserverUrl+"/api/event");$("#leoCdpListEventsApiUrl").text(baseLeoObserverUrl+"/api/list-events?profileId\x3d[profile_ID]\x26startIndex\x3d0\x26numberResult\x3d10 ");$("#observerApiInfoDialog").modal({backdrop:"static",keyboard:!1})},resetAccessTokenForLeoObserverApi=function(){LeoAdminApiUtil.callPostAdminApi(baseLeoAdminUrl+"/cdp/touchpointhub/reset-access-token",{},function(a){0===a.httpCode&&""===a.errorMessage&&(a=a.data,$("#leoCdpApiTokenKey").val(a.tokenKey),
$("#leoCdpApiTokenValue").val(a.tokenValue),iziToast.success({title:"Reset Access Token",message:"The new access token is generated successfully!"}))})},initDataObserverJsGridPlugin=function(){var a=function(b){jsGrid.Field.call(this,b)};a.prototype=new jsGrid.Field({sorter:function(b,d){return 0},itemTemplate:function(b){if(""!==b.data){console.log("observerModel ",b);var d=b.data,e=b.type;b=b.firstPartyData;var c="";30===e?c=c+'\x3cbutton type\x3d"button" class\x3d"btn btn-success  btn-sm btn-do-now btn-get-code" onclick\x3d"showObserverApiInfo(this)"  data-json\x3d"'+
(d+'" \x3e\x3ci class\x3d"fa fa-info-circle" style\x3d"font-size:1.1em" aria-hidden\x3d"true"\x3e\x3c/i\x3e API Information \x3c/button\x3e'):31===e?c=c+'\x3cbutton type\x3d"button" class\x3d"btn btn-success  btn-sm btn-do-now btn-get-code" onclick\x3d"showRedisSourceInfo(this)"  data-json\x3d"'+(d+'" \x3e\x3ci class\x3d"fa fa-info-circle" style\x3d"font-size:1.1em" aria-hidden\x3d"true"\x3e\x3c/i\x3e Redis Information \x3c/button\x3e'):32===e?c=c+'\x3cbutton type\x3d"button" class\x3d"btn btn-success  btn-sm btn-do-now btn-get-code" onclick\x3d"showKafkaSourceInfo(this)"  data-json\x3d"'+
(d+'" \x3e\x3ci class\x3d"fa fa-info-circle" style\x3d"font-size:1.1em" aria-hidden\x3d"true"\x3e\x3c/i\x3e Kafka Information \x3c/button\x3e'):b?30>e&&(c='\x3cbutton type\x3d"button" class\x3d"btn btn-primary btn-sm btn-get-code" onclick\x3d"getQrImageFormCode(this)" data-json\x3d"'+(d+'" \x3e\x3ci class\x3d"fa fa-qrcode" style\x3d"font-size:1.1em" aria-hidden\x3d"true"\x3e\x3c/i\x3e  QR Image Code \x3c/button\x3e'),0<e&&12>e?(c=c+'\x3cbutton type\x3d"button" class\x3d"btn btn-goto-router  btn-sm btn-get-code" onclick\x3d"getTrackingJsCode(this)"  data-json\x3d"'+
(d+'" \x3e\x3ci class\x3d"fa fa-code" style\x3d"font-size:1.1em" aria-hidden\x3d"true"\x3e\x3c/i\x3e Event Tracking Code \x3c/button\x3e\x3cbutton type\x3d"button" class\x3d"btn btn-success btn-sm btn-get-code" onclick\x3d"getCxFeedbackJsCode(this)" '),c+=' data-json\x3d"'+d+'" \x3e\x3ci class\x3d"fa fa-code" style\x3d"font-size:1.1em" aria-hidden\x3d"true"\x3e\x3c/i\x3e CX Tracking Code \x3c/button\x3e\x3cbutton type\x3d"button" class\x3d"btn btn-info  btn-sm btn-get-code" onclick\x3d"getRecommenderJsCode(this)" ',
c+=' data-json\x3d"'+d+'" \x3e\x3ci class\x3d"fa fa-code" style\x3d"font-size:1.1em" aria-hidden\x3d"true"\x3e\x3c/i\x3e Personalized Widget \x3c/button\x3e'):(c+='\x3cbutton type\x3d"button" class\x3d"btn btn-success btn-sm btn-get-code" onclick\x3d"getCxFeedbackJsCode(this)" ',c+=' data-json\x3d"'+d+'" \x3e\x3ci class\x3d"fa fa-code" style\x3d"font-size:1.1em" aria-hidden\x3d"true"\x3e\x3c/i\x3e CX Tracking Code \x3c/button\x3e')):c='\x3cbutton type\x3d"button" class\x3d"btn btn-primary btn-sm btn-get-code" onclick\x3d"getQrImageFormCode(this)" data-json\x3d"'+
(d+'" \x3e\x3ci class\x3d"fa fa-qrcode" style\x3d"font-size:1.1em" aria-hidden\x3d"true"\x3e\x3c/i\x3e QR Image Code \x3c/button\x3e');return c}return""},insertTemplate:function(b){return this._insertCode=b},editTemplate:function(b){return this._editCode=b},insertValue:function(){return this._insertCode},editValue:function(){return this._editCode}});jsGrid.fields.LeoDataObserver=a};
var loadDataObserverList=function(a){initDataObserverJsGridPlugin();LeoAdminApiUtil.getSecuredData("/cdp/observers",{journeyMapId:currentJourneyMapId},function(b){var d=b.data.eventObservers;b=b.data.touchpointHubTypes;for(var e=0;e<d.length;e++){var c=d[e];c.index=e+1;var g=b[c.type];c.typeName=g;var h=c.firstPartyData,l=c.type;g={id:c.id,name:c.name,type:l,typeName:g};g.collectDirectly=c.collectDirectly;g.qrCodeData=c.qrCodeData;g.accessTokens=c.accessTokens;g.securityCode=c.securityCode;g.dataSourceUrl=
c.dataSourceUrl;g=JSON.stringify(g);c.observerModel={type:l,data:encodeURIComponent(g),firstPartyData:h}}$(a).jsGrid({width:"100%",height:"auto",inserting:!1,editing:!1,sorting:!1,paging:!1,data:d,fields:[{name:"index",title:"",type:"number",width:20,align:"center"},{name:"name",title:"Name",type:"string",align:"center",css:"observer_name"},{name:"id",title:"Unique ID",type:"string",width:68,align:"center",css:"observer_id"},{name:"firstPartyData",title:"First-party Data",type:"CheckBoxIcon",width:40,
align:"center"},{name:"collectDirectly",title:"Tracking directly",type:"CheckBoxIcon",width:40,align:"center"},{name:"dataSourceUrl",title:"URL",type:"UrlLink",width:120,align:"center",css:"observer_url"},{name:"observerModel",title:"Actions",type:"LeoDataObserver",width:72,align:"center"}]})})};