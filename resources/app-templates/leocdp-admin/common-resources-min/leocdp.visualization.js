'use strict';var chartColorCodes="#0029ab #493771 #503f62 #55475a #594d56 #5d5453 #625a51 #66614f #6b674e #706d4d #75734d #7a794c #7f804c #84864b #898c4b #8e924a #949949 #999f49 #9fa648 #a4ac48 #aab247 #b0b946 #b5bf45 #bbc644 #c1cc43 #ea9d97 #e69894 #e29291 #de8d8d #da888a #d68287 #d27d83 #ce7880 #ca737c #c76d79 #c36875 #bf6271 #bc5d6d #b8576a #b55266 #b14c62 #ae465e #aa4059 #a73a55 #a33351 #a02c4c #9d2548 #991c43 #96113f #93003a".split(" ");
function randomInteger(a,b){return Math.floor(Math.random()*(b-a+1))+a}function getColorCodeProfileFunnel(a){var b="#7A9F8D #5D897C #40736D #24585C #225059 #1F4360 #1A2E55 #161C4A #15113E #180D32".split(" ");return 0<=a&&9>=a?b[a]:b[0]}function getColorCodeJourneyFunnel(a){var b="#180D32 #15113E #161C4A #1A2E55 #1F4360 #225059 #24585C #40736D #5D897C #7A9F8D".split(" ");return 0<=a&&9>=a?b[a]:b[0]}
var renderFunnelChart=renderFunnelChart||function(a,b,e,f){var d=[];b.forEach(function(h){var c=h.orderIndex;d.push([h.name,"[Stage "+c+"]",f(c)])});(new D3Funnel(a)).draw(d,e)},renderJourneyFlowChart=renderJourneyFlowChart||function(a,b,e,f,d,h,c){e={margin:{top:10,left:10,right:10,bottom:10},nodes:{dynamicSizeFontNode:{enabled:!0,minSize:14,maxSize:26},fontSize:16,draggableX:!1,draggableY:!0,colors:d3.scaleOrdinal(d3.schemeCategory20)},links:{formatValue:function(g,k){g=f[g]?f[g]:b;return k&&1<
k?d3.format(",.0f")(k)+" "+g:g},unit:b},tooltip:{infoDiv:!0,labelSource:"Input:",labelTarget:"Output:"}};sk.createSankey(a,e,{nodes:d,links:h});$(a+" g.sk-node text").each(function(){var g=$(this).text().trim();g="["+c[g].journeyLevel+"] "+g;$(this).html(g)})},renderDonutChart=function(a,b,e,f,d,h,c){h=d3.arc().outerRadius(h-12).innerRadius(100);var g=d3.pie().sort(null).value(function(k){return k.count});a=d3.select(a).append("svg").attr("width",f).attr("height",d).append("g").attr("transform","translate("+
f/2+","+d/2+")").selectAll(".arc").data(g(b)).enter().append("g");a.append("path").attr("d",h).style("fill",function(k,m){return k.data.color});a.append("text").attr("text-anchor","middle").attr("font-size","1.2em").attr("y",20).text(e+" (~"+c+"%)")},loadMediaTouchpoints=loadMediaTouchpoints||function(){var a=venn.VennDiagram().width(500).height(400),b=d3.select("#venn_two").datum([{sets:["Email"],figure:27.92,label:"Email",size:27.92},{sets:["Direct Traffic"],figure:55.28,label:"Direct Traffic",
size:55.28},{sets:["Search Engine"],figure:7.62,label:"Search Engine",size:7.62},{sets:["Email","Direct Traffic"],figure:3.03,label:"Email and Direct Traffic",size:3.03},{sets:["Email","Search Engine"],figure:1.66,label:"Email and Search Engine",size:1.66},{sets:["Direct Traffic","Search Engine"],figure:2.4,label:"Direct Traffic and Search Engine",size:2.4},{sets:["Email","Direct Traffic","Search Engine"],figure:1.08,label:"Email, Direct Traffic, and Search Engine",size:1.08}]).call(a);b.selectAll("text").style("fill",
"white");b.selectAll(".venn-circle path").style("fill-opacity",.8).style("stroke-width",1).style("stroke-opacity",1).style("stroke","fff");var e=d3.select("body").append("div").attr("class","venntooltip");b.selectAll("g").on("mouseover",function(f,d){venn.sortAreas(b,f);e.transition().duration(40).style("opacity",1);e.text(f.size+"% media touchpoint "+f.label);d3.select(this).transition("tooltip").duration(400).select("path").style("stroke-width",3).style("fill-opacity",1==f.sets.length?.8:0).style("stroke-opacity",
1)}).on("mousemove",function(){e.style("left",d3.event.pageX+"px").style("top",d3.event.pageY-28+"px")}).on("mouseout",function(f,d){e.transition().duration(2500).style("opacity",0);d3.select(this).transition("tooltip").duration(400).select("path").style("stroke-width",3).style("fill-opacity",1==f.sets.length?.8:0).style("stroke-opacity",1)})},personalityDiagram=function(){d3.select("chart_persornality").append("svg").attr("width",300).attr("height",300);RadarChart.draw("#chart_persornality",[[{area:"Openness",
value:80},{area:"Conscientiousness",value:40},{area:"Extraversion ",value:40},{area:"Agreeableness ",value:90},{area:"Neuroticism ",value:60}]],{w:300,h:300,maxValue:100,levels:5,ExtraWidthX:300})},loadProfileAttribution=loadProfileAttribution||function(){var a=Math.round($("#profile_attribution").width())-140-60,b=d3.select("#profile_attribution").append("svg").attr("width",a+140+60).attr("height",550).append("g").attr("transform","translate(140,30)"),e=d3.scaleBand().range([0,a]).domain(["Live_in_Saigon",
"Visited_Web","Installed_App","Used_Credit_Card","Buy_Product"]).padding(.01);b.append("g").attr("transform","translate(0,420)").attr("class","x_axis").call(d3.axisBottom(e)).selectAll("text").attr("transform","translate(-10,10)rotate(-30)").style("text-anchor","end").style("font-size",15).style("fill","#E91E0D");var f=d3.scaleBand().range([420,0]).domain(["Buy_Product","Used_Credit_Card","Installed_App","Visited_Web","Live_in_Saigon"]).padding(.01);b.append("g").attr("class","y_axis").call(d3.axisLeft(f)).selectAll("text").style("text-anchor",
"end").style("font-size",15).style("fill","#463CC4");var d=d3.scaleLinear().range(["white","#008748"]).domain([1,100]);a="/public/uploaded-files/sample-profile-attribution.csv?_\x3d"+(new Date).getTime();d3.csv(a,function(h){b.selectAll().data(h,function(c){return c.profile_attr+":"+c.persona_attr}).enter().append("rect").attr("id",function(c){return"cell_"+c.profile_attr+"_"+c.persona_attr}).attr("x",function(c){return e(c.profile_attr)}).attr("y",function(c){return f(c.persona_attr)}).attr("width",
e.bandwidth()).attr("height",f.bandwidth()).style("fill",function(c){return d(c.matching_score)}).on("click",function(c){var g=" [Profile attribute: "+c.profile_attr+" - Persona attribute: "+c.persona_attr+"] : Matching Score \x3d "+c.matching_score+" %";$("#attribution_description").text(g);b.select("#cell_"+c.profile_attr+"_"+c.persona_attr);g=" [Profile attribute: "+c.profile_attr+" - Persona attribute: "+c.persona_attr+"] : Matching Score \x3d "+c.matching_score+" %";$("#attribution_description").text(g).effect("highlight",
{color:"#5eeb34"},6E3)}).on("mouseover",function(c){console.log(c);b.select("#cell_"+c.profile_attr+"_"+c.persona_attr).style("fill","#5eeb34");c=" [Profile attribute: "+c.profile_attr+" - Persona attribute: "+c.persona_attr+"] : Matching Score \x3d "+c.matching_score+" %";$("#attribution_description").text(c)}).on("mouseout",function(c){b.select("#cell_"+c.profile_attr+"_"+c.persona_attr).style("fill",d(c.matching_score))})})};
function loadCustomerVenn(){var a=venn.VennDiagram().width($("#customer_source").width()).height(360),b=d3.select("#customer_source").datum([{sets:["Email"],figure:27.92,label:"Email",size:27.92},{sets:["Social Media"],figure:55.28,label:"Social Media",size:55.28},{sets:["Search Engine"],figure:7.62,label:"Search Engine",size:7.62},{sets:["Email","Social Media"],figure:3.03,label:"",size:3.03},{sets:["Email","Search Engine"],figure:2.66,label:"",size:1.66},{sets:["Social Media","Search Engine"],figure:2.4,
label:"",size:2.4},{sets:["Email","Social Media","Search Engine"],figure:1.08,label:"",size:1.08}]).call(a);b.selectAll("text").style("fill","white");b.selectAll(".venn-circle path").style("fill-opacity",.8).style("stroke-width",1).style("stroke-opacity",1).style("stroke","fff");var e=d3.select("body").append("div").attr("class","venntooltip");b.selectAll("g").on("mouseover",function(f,d){venn.sortAreas(b,f);e.transition().duration(40).style("opacity",1);e.text(f.size+"% of Segment Two saw "+f.label);
d3.select(this).transition("tooltip").duration(400).select("path").style("stroke-width",3).style("fill-opacity",1==f.sets.length?.8:0).style("stroke-opacity",1)}).on("mousemove",function(){e.style("left",d3.event.pageX+"px").style("top",d3.event.pageY-28+"px")}).on("mouseout",function(f,d){e.transition().duration(2500).style("opacity",0);d3.select(this).transition("tooltip").duration(400).select("path").style("stroke-width",3).style("fill-opacity",1==f.sets.length?.8:0).style("stroke-opacity",1)})}
function loadChannelPerformance(){var a=[{channelName:"Ecommerce Website",lead:181},{channelName:"Ecommerce App",lead:189},{channelName:"Social Media Groups",lead:387},{channelName:"Retail Store",lead:187},{channelName:"Book Reseller",lead:52}],b=$("#chart").width()-180-20,e=d3.scaleBand().range([300,0]).padding(.1),f=d3.scaleLinear().range([0,b]);b=d3.select("#chart svg").attr("width",b+180+20).attr("height",350).append("g").attr("transform","translate(180,20)");a.forEach(function(d){d.lead=+d.lead});
f.domain([0,d3.max(a,function(d){return d.lead})]);e.domain(a.map(function(d){return d.channelName}));b.selectAll(".bar").data(a).enter().append("rect").attr("class","bar").attr("width",function(d){return f(d.lead)}).attr("y",function(d){return e(d.channelName)}).attr("height",e.bandwidth());b.append("g").attr("transform","translate(0,300)").call(d3.axisBottom(f));b.append("g").call(d3.axisLeft(e))}
var renderTimeseriesChart=function(a,b,e,f){var d={labels:[],datasets:[]},h=[],c=getRawDateFilterValues(),g=c.beginFilterDate;for(c=c.endFilterDate;g.isBefore(c,"day");)h.push(g.format("YYYY-MM-DD")),g.add(1,"days");d.labels=h;var k=0;h=Object.keys(b.reportMap);h.sort();h.forEach(function(m){var n={};b.reportMap[m].forEach(function(l){n[l.dateKey]=l.dailyCount});var p=[];d.labels.forEach(function(l){p.push(n[l]?n[l]:0)});var q=chartColorCodes[k];k+=randomInteger(1,3);k>=chartColorCodes.length&&(k=
0);d.datasets.push({label:m,backgroundColor:q,borderColor:q,fill:!1,borderWidth:2,tension:.1,data:p})});if(!0===e&&"object"===typeof f)f.data=d,f.update();else return e=(e=$("#"+a).data("chart-type"))?e:"line",a=document.getElementById(a).getContext("2d"),new Chart(a,{type:e,data:d,options:{tooltips:{mode:"index",intersect:!1},responsive:!0,scales:{xAxes:[{stacked:!0}],yAxes:[{stacked:!0}]}}})},PluginCenterTextChartJS=function(){return{beforeDraw:function(a){var b=a.data.donutChartCenterData;if("object"===
typeof b){var e="number"===typeof b.value?b.value:0,f="number"===typeof b.marginTop?b.marginTop:30;b="string"===typeof b.suffix?b.suffix:"";var d=a.chart.width,h=a.chart.height;a=a.chart.ctx;a.restore();var c=(h/114).toFixed(2);a.font=c+"em sans-serif";a.textBaseline="middle";c=e;d=Math.round((d-a.measureText(c).width)/2);"string"===typeof b&&(c+=b,d-=10);0<=e?a.fillStyle="#1EC900":(a.fillStyle="#E80015",d+=4);a.fillText(c,d,h/2+f);a.save()}}}},renderDonutChartJs=function(a,b){a=document.getElementById(a).getContext("2d");
return new Chart(a,{type:"doughnut",data:b,options:{title:{display:!1,text:"Overall CX Score",fontSize:15},responsive:!0,maintainAspectRatio:!0,showDatapoints:!0,legend:{display:!0},plugins:{datalabels:{color:"black",formatter:function(e){return e+"%"},font:{weight:"bold",size:15}}}},plugins:[PluginCenterTextChartJS(),ChartDataLabels]})},renderBarChart=function(a,b){a=document.getElementById(a).getContext("2d");return new Chart(a,{type:"bar",data:b,options:{tooltips:{mode:"index",intersect:!1},responsive:!0,
scales:{xAxes:[{stacked:!0}],yAxes:[{stacked:!0}]}}})};