'use strict';function profileAddNewTextHashSet(a){var e=$('\x3cli class\x3d"list-group-item" \x3e\x3cdiv class\x3d"row" \x3e\x3cdiv class\x3d"col-md-11" \x3e\x3cinput class\x3d"form-control" type\x3d"text" placeholder\x3d"Value" data-fieldholder\x3d"hashset" data-fieldtype\x3d"string" autocomplete\x3d"off"\x3e\x3c/div\x3e\x3cdiv class\x3d"col-md-1" \x3e\x3ch4 onclick\x3d"$(this).parent().parent().parent().remove()" \x3e\x3ci class\x3d"fa fa-times-circle delete-item-btn" aria-hidden\x3d"true"\x3e\x3c/i\x3e\x3c/h4\x3e \x3c/div\x3e\x3c/div\x3e\x3c/li\x3e');
$('p[data-field\x3d"'+a+'"] \x3e ul').append(e);e.effect("highlight",{},3600);e.find("input:first").focus()}function profileAddNewCustomField(a){var e=$(loadCustomFieldEditor(a,"",""));$('p[data-field\x3d"'+a+'"] \x3e ul').append(e);e.effect("highlight",{},3600);e.find("input:first").focus()}
function handleProfileListFiltersBy(a,e){$("#profile_filter_inputs \x3e .form-control").val("").hide();$(e).show();$("#profile_filter_input_label").text($(a).text()).show();$("#main_search_profile").val("");showDeleteNotActiveProfile()}
var addNewHashMapItem=function(a,e){var b=a+"_"+(new Date).getTime(),d=$("#"+a),f=Object.assign({},e);d.find("option:selected").each(function(){var k=$(this).val();delete f[k]});a=$(loadHashMapSelector(b,a,f,"",""));d.find("ul.list-group").append(a);a.effect("highlight",{},4E3)};function removeHashMapItem(a){$(a).parent().parent().remove()}
function loadHashMapSelector(a,e,b,d,f){var k='\x3cdiv class\x3d"col-md-3" \x3e \x3cselect class\x3d"form-control" id\x3d"key_'+a+'" name\x3d"'+e+'" \x3e';_.forOwn(b,function(n,h){n='\x3coption name\x3d"'+e+'" value\x3d"'+h+'"\x3e '+h.toUpperCase()+" \x3c/option\x3e";h===d&&(n='\x3coption name\x3d"'+e+'" selected value\x3d"'+h+'"\x3e '+h.toUpperCase()+" \x3c/option\x3e");k+=n});k+=" \x3c/select\x3e \x3c/div\x3e";""===d&&$("#key_"+a).find("option:first").attr("selected","selected");return'\x3cli id\x3d"item_'+
a+'" class\x3d"list-group-item" \x3e\x3cdiv class\x3d"row" \x3e '+k+('\x3cdiv class\x3d"col-md-8" \x3e\x3cinput id\x3d"value_'+a+'" value\x3d"'+(f?f:"")+'" class\x3d"form-control" type\x3d"text" placeholder\x3d"Value" data-fieldholder\x3d"hashmap" data-fieldtype\x3d"string" autocomplete\x3d"off"\x3e\x3c/div\x3e\x3cdiv title\x3d"Delete" class\x3d"col-md-1" onclick\x3d"removeHashMapItem(this)" \x3e \x3ch4\x3e\x3ci class\x3d"fa fa-times-circle delete-item-btn" aria-hidden\x3d"true"\x3e\x3c/i\x3e\x3c/h4\x3e \x3c/div\x3e \x3c/div\x3e\x3c/li\x3e')}
function loadCustomFieldEditor(a,e,b){return'\x3cli class\x3d"list-group-item" \x3e\x3cdiv class\x3d"row" \x3e \x3cdiv class\x3d"col-md-3" \x3e \x3cinput type\x3d"text" class\x3d"form-control custom_field_name" placeholder\x3d"Field Name" value\x3d"'+(e+'"\x3e \x3c/div\x3e\x3cdiv class\x3d"col-md-8" \x3e\x3cinput class\x3d"form-control custom_field_value" type\x3d"text" value\x3d"')+((b?b:"")+'" placeholder\x3d"Field Value" data-fieldholder\x3d"hashmap" data-fieldtype\x3d"string" autocomplete\x3d"off"\x3e\x3c/div\x3e\x3cdiv title\x3d"Delete" class\x3d"col-md-1" onclick\x3d"removeHashMapItem(this)" \x3e \x3ch4\x3e\x3ci class\x3d"fa fa-times-circle delete-item-btn" aria-hidden\x3d"true"\x3e\x3c/i\x3e\x3c/h4\x3e \x3c/div\x3e \x3c/div\x3e\x3c/li\x3e')}
const loadProfileDataIntoDOM=function(a,e,b,d,f,k){var n=!1,h={};"string"===typeof e?(n="/cdp/profile/get-by-id",h.id=e):"string"===typeof b?(n="/cdp/profile/get-by-crm-id",h.crmRefId=b):"string"===typeof d&&(n="/cdp/profile/get-by-visitor-id",h.visitorId=d);!1===n?(console.error("loadProfileDataIntoDOM is failed, profileId or crmRefId must be a valid string! "),console.log("urlStr "+n),console.log("params "+h)):LeoAdminApiUtil.callPostAdminApi(baseLeoAdminUrl+n,h,function(p){if(0===p.httpCode&&""===
p.errorMessage){var c=p.canInsertData,g=p.canDeleteData;p.canEditData||$("button.data-control-edit").attr("disabled","disabled");g||$("button.data-control-delete").attr("disabled","disabled");c||$("button.data-control-insert").attr("disabled","disabled");LeoCdpAdmin.routerContext.dataObject="function"===typeof f?f(p.data):p.data;$("#data_model_holder").find("*[data-field]").each(function(){var m=$(this).attr("type"),q=$(this).data("fieldholder"),v=$(this).data("fieldtype"),w=$(this).data("field"),
x=w.split(".");if(1===x.length){var l=LeoCdpAdmin.routerContext.dataObject[x[0]];if("html"===q){if("int"===v||"float"===v)if(void 0===l||null==l)l="-";else{if(l=(new Number(l)).toLocaleString(),NaN==l||"NaN"==l)l="-"}else"date"===v?l=l?moment.utc(l).local().format("YYYY-MM-DD"):"-":"date_time"===v?l=l?moment.utc(l).local().format("YYYY-MM-DD HH:mm:ss"):"-":"phone"===v&&(l=l?l.replace(/\D/g,""):"-");$(this).html(l)}else if("percentage"===q)$(this).html(l).parent().attr("aria-valuenow",l).css("width",
l+"%"),m=$(this).parent(),m.attr("title",l+"% "+m.attr("title"));else if("url"===q)$(this).html(checkToAddUrlValueToDOM(l));else if("locationcode"===q)m=$("\x3ca/\x3e").attr("href","javascript:").html(textTruncate(l,80)).click(function(){var r=LeoCdpAdmin.routerContext.dataObject.locationCode;0===r.indexOf("http")?eModal.iframe(r,"Location"):r&&""!=r.trim()&&eModal.iframe("https://plus.codes/"+r,l)}),$(this).html(m);else if("selectionvalue"===q)"checkbox"===m&&1==l?$(this).attr("checked","checked"):
"radio"===m&&l==$(this).val()&&$(this).attr("checked","checked");else if("html_hashmap"===q){var t=' \x3cul class\x3d"list-group" \x3e ';_.forOwn(l,function(r,u){u=u.trim();a?(r=loadHashMapSelector(w+"_"+u,w,"socialMediaProfiles"===w?SocialMediaIconMap:"personalContacts"===w?PersonalContactIconsMap:ContactIconsMap,u,r),t+=r):(u="socialMediaProfiles"===w?SocialMediaIconMap[u]?SocialMediaIconMap[u]:!1:"personalContacts"===w?PersonalContactIconsMap[u]?PersonalContactIconsMap[u]:!1:ContactIconsMap[u]?
ContactIconsMap[u]:!1,!1===u&&(u=' \x3ci class\x3d"fa fa-info-circle" aria-hidden\x3d"true"\x3e\x3c/i\x3e '),t=t+'\x3cli class\x3d"list-group-item" \x3e '+u+checkToAddUrlValueToDOM(r)+"\x3c/li\x3e")});t+=" \x3c/ul\x3e ";$(this).html(t)}else"html_hashset"===q?(t='\x3cul class\x3d"list-group" \x3e',_.forOwn(l,function(r,u){r=a?'\x3cdiv class\x3d"col-md-11" \x3e\x3cinput value\x3d"'+r+'" class\x3d"form-control" type\x3d"text" placeholder\x3d"Value" data-fieldholder\x3d"hashset" data-fieldtype\x3d"string" autocomplete\x3d"off"\x3e\x3c/div\x3e\x3cdiv class\x3d"col-md-1" \x3e\x3ch4 onclick\x3d"$(this).parent().parent().parent().remove()" \x3e\x3ci class\x3d"fa fa-times-circle delete-item-btn" aria-hidden\x3d"true"\x3e\x3c/i\x3e\x3c/h4\x3e\x3c/div\x3e':
"system_user"===v?' \x3cdiv class\x3d"col-md-12" \x3e \x3cb\x3e \x3ci class\x3d"fa fa-info-circle" aria-hidden\x3d"true"\x3e\x3c/i\x3e\x3c/b\x3e '+buildSystemUserInfoLink(r)+"\x3c/div\x3e":' \x3cdiv class\x3d"col-md-12" \x3e \x3cb\x3e \x3ci class\x3d"fa fa-info-circle" aria-hidden\x3d"true"\x3e\x3c/i\x3e\x3c/b\x3e '+checkToAddUrlValueToDOM(r)+"\x3c/div\x3e";t=t+'\x3cli class\x3d"list-group-item" \x3e \x3cdiv class\x3d"row" \x3e '+r+"\x3c/div\x3e\x3c/li\x3e"}),t+="\x3c/ul\x3e",$(this).html(t)):"html_list_key_value"===
q?(t='\x3cul class\x3d"list-group" \x3e',m=Object.keys(l),m.sort(),m.forEach(function(r){t=t+'\x3cli class\x3d"list-group-item" \x3e '+r+'  \x3ci class\x3d"fa fa-arrow-right" aria-hidden\x3d"true"\x3e\x3c/i\x3e  '+l[r]+"\x3c/li\x3e"}),t+="\x3c/ul\x3e",$(this).html(t)):"html_custom_field"===q?(t=' \x3cul class\x3d"list-group" \x3e ',_.forOwn(l,function(r,u){u=u.trim();a?(r=loadCustomFieldEditor(w+"_"+u,u,r),t+=r):(t+='\x3cli class\x3d"list-group-item" \x3e',t+='\x3cdiv class\x3d"row" \x3e \x3cdiv class\x3d"col-md-3"\x3e \x3cb\x3e '+
u+'\x3c/b\x3e \x3ci  style\x3d"font-size:20px" class\x3d"fa fa-equals" aria-hidden\x3d"true"\x3e\x3c/i\x3e \x3c/div\x3e',t+='\x3cdiv class\x3d"col-md-9"\x3e'+r+"\x3c/div\x3e \x3c/div\x3e\x3c/li\x3e")}),t+=" \x3c/ul\x3e ",$(this).html(t)):"inputvalue"===q&&$(this).val(l)}else if(2===x.length){var y=LeoCdpAdmin.routerContext.dataObject[x[0]]||{};l=y[x[1]]||"";"html"===q?$(this).html(l):"date"===v?(l=moment.utc(l).local().format("YYYY-MM-DD"),$(this).html(l)):"date_time"===v?(l=moment.utc(l).local().format("YYYY-MM-DD HH:mm:ss"),
$(this).html(l)):"inputvalue"===q?$(this).val(l):"url"===q?$(this).html(checkToAddUrlValueToDOM(l)):"eventlocation"===q&&(m=$("\x3ca/\x3e").attr("href","javascript:").html(l).click(function(){var r=y.locationCode||"";r&&""!=r.trim()&&eModal.iframe("https://plus.codes/"+r,l)}),$(this).html(m))}else 3===x.length&&(y=LeoCdpAdmin.routerContext.dataObject[x[0]]||{},l=(y[x[1]]||{})[x[2]]||"","html"===q?$(this).html(l):"inputvalue"===q?$(this).val(l):"url"===q?$(this).html(checkToAddUrlValueToDOM(l)):"eventlocation"===
q&&(m=$("\x3ca/\x3e").attr("href","javascript:").html(l).click(function(){var r=y.locationCode||"";r&&""!=r.trim()&&eModal.iframe("https://plus.codes/"+r,l)}),$(this).html(m)),"date"===v?(l=moment.utc(l).local().format("YYYY-MM-DD"),$(this).html(l)):"date_time"===v&&(l=moment.utc(l).local().format("YYYY-MM-DD HH:mm:ss"),$(this).html(l)))}).promise().done(function(){"function"===typeof k&&k()})}else LeoAdminApiUtil.logErrorPayload(p)})};
var updateProfileDataToModel=function(a,e,b){$("#data_model_holder").find("*[data-field]").each(function(){var d=$(this).data("field"),f=$(this).data("fieldholder"),k=$(this).data("fieldtype");f="checkbox"===$(this).attr("type")?$(this).prop("checked"):"html"===f?$(this).html().trim():$(this).val();"int"===k?f=parseInt(f.replace(/,/g,"")):"float"===k?f=parseFloat(f.replace(/,/g,"")):"date"===k?f=new Date(f):"tel"===k&&(f=f.replace(/\D/g,""));d=d.split(".");1===d.length?LeoCdpAdmin.routerContext.dataObject[d[0]]=
f:2===d.length&&(LeoCdpAdmin.routerContext.dataObject[d[0]][d[1]]=f)}).promise().done(function(){LeoAdminApiUtil.callPostAdminApi(a,e,function(d){0===d.httpCode&&""===d.errorMessage?"function"===typeof b&&b(d):LeoAdminApiUtil.logErrorPayload(d)})})},loadProfileEventDailyReportUnit=function(){var a=currentJourneyMapId||"id_default_journey",e=getDateFilterValues();e.profileId=viewProfileId;e.journeyMapId=a;a=e.beginFilterDate;$("#eventDataFromDate").text((new moment(a)).format("YYYY-MM-DD HH:mm:ss"));
a=e.endFilterDate;$("#eventDataToDate").text((new moment(a)).format("YYYY-MM-DD HH:mm:ss"));var b=$("#profile_event_report_loader").show();LeoAdminApiUtil.getSecuredData(baseLeoAdminUrl+"/cdp/analytics360/event-report/profile",e,function(d){b.hide();0===d.httpCode&&""===d.errorMessage?!1!==window.profileTimeseriesChart?renderTimeseriesChart("timeseriesProfileEventChart",d.data,!0,profileTimeseriesChart,!0):window.profileTimeseriesChart=renderTimeseriesChart("timeseriesProfileEventChart",d.data,!1,
!1,!0):LeoAdminApiUtil.logErrorPayload(d)})};function handleProfileTabBehavioralInfo(){$("#event_flow_tabs a:first").click();$("#event_flow_vertital_tabs div:first").addClass("active")}function handleProfileTabExtInfo(){$("#profile_ext_info_tabs a:first").click();$("#profile_ext_info_vertital_tabs div:first").addClass("active")}
const loadRecommendedContentsOfProfile=function(a,e,b){var d=systemConfig.leo_recommender.service_max_item_for_profile,f=$("#recommended_content_list").empty().html('\x3cdiv class\x3d"loader"\x3e\x3c/div\x3e');LeoAdminApiUtil.getSecuredData("/cdp/profile/recommended-contents",{profileId:a,startIndex:0,numberResult:d},function(k){k=k.data;var n=k.length;0<n?f.empty():f.empty().html('\x3cdiv class\x3d"list-group-item" \x3e No data available \x3c/div\x3e');_.forEach(k,function(h){var p=_.template($("#recommended-content-tpl").html());
h.indexScore=f.find("\x3e div").length+1;h.updatedAt=moment.utc(h.updatedAt).local().format("YYYY-MM-DD HH:mm:ss");var c=h.content.headlineImageUrl;h.content.headlineImageUrl=null==c||""===c?"https://cdn-icons-png.flaticon.com/128/9872/9872434.png":c;h.content.landingPageUrl=null==h.content.fullUrl||""===h.content.fullUrl?h.content.shortLinkUrl:h.content.fullUrl;h=p(h);f.append(h)});!0===e&&new Sortable(f[0],{swap:!0,swapClass:"sortable_highlighted_item",animation:150,onEnd:function(h){var p=h.newIndex,
c=h.swapItem;h=$(h.item).data("key");c=$(c).data("key");var g=parseInt($("#rank_content_"+h).text());p+=1;$("#rank_content_"+h).text(p);$("#rank_content_"+c).text(g);var m={};$("#recommended_content_list span.rank_info").each(function(q){q=$(this).data("key");var v=parseInt($(this).text());m[q]=v;console.log(m)}).promise().done(function(){var q={rankingInfoList:JSON.stringify(m),graphName:"cdp_content_graph",profileId:a,recommendationModel:1};LeoAdminApiUtil.callPostAdminApi("/cdp/profile/update-item-ranking",
q,function(v){v.data?iziToast.success({title:"Update Content Content Ranking",timeout:3E3,message:"Data is saved successfully!"}):LeoAdminApiUtil.logErrorPayload(v)})})}});"function"===typeof b&&b(n)})};
var loadRecommendedProductsOfProfile=function(a,e,b){var d=systemConfig.leo_recommender.service_max_item_for_profile,f=$("#recommended_product_list").empty().html('\x3cdiv class\x3d"loader"\x3e\x3c/div\x3e');LeoAdminApiUtil.getSecuredData("/cdp/profile/recommended-products",{profileId:a,startIndex:0,numberResult:d},function(k){k=k.data;var n=k.length;0<n?f.empty():f.empty().html('\x3cdiv class\x3d"list-group-item" \x3e No data available \x3c/div\x3e');var h=_.template($("#recommended-product-tpl").html());
_.forEach(k,function(p){var c=p.product;if("object"===typeof c){p.indexScore=f.find("\x3e div").length+1;p.updatedAt=moment.utc(p.updatedAt).local().format("YYYY-MM-DD HH:mm:ss");c.offerPrice=c.salePrice*(1-p.discount);c.discount=100*p.discount;c.keywordsText=textTruncate(c.keywords.join(", "),6555);var g=c.headlineImageUrl;c.headlineImageUrl=null==g||""===g?NO_IMAGE_URL:g;p=h(p);f.append(p)}});!0===e&&new Sortable(f[0],{swap:!0,swapClass:"sortable_highlighted_item",animation:150,onEnd:function(p){var c=
p.newIndex,g=p.swapItem;p=$(p.item).data("key");g=$(g).data("key");var m=parseInt($("#rank_product_"+p).text());c+=1;$("#rank_product_"+p).text(c);$("#rank_product_"+g).text(m);var q={};f.find("span.rank_info").each(function(v){v=$(this).data("key");var w=parseInt($(this).text());q[v]=w;console.log(q)}).promise().done(function(){var v={rankingInfoList:JSON.stringify(q),graphName:"cdp_product_graph",profileId:a,recommendationModel:1};LeoAdminApiUtil.callPostAdminApi("/cdp/profile/update-item-ranking",
v,function(w){w.data?iziToast.success({title:"Product Item Ranking",timeout:2200,message:"Data is saved successfully!"}):LeoAdminApiUtil.logErrorPayload(w)})})}});$("input.autoselectall").on("click",function(){$(this).select()});"function"===typeof b&&b(n)})},loadPurchasedItemsOfProfile=function(){LeoAdminApiUtil.getSecuredData("/cdp/profile/get-purchased-items",{profileId:viewProfileId,startIndex:0,numberResult:100},function(a){var e=$("#purchased_items_list");a=a.data;0<a.length&&e.empty();_.forEach(a,
function(b){var d=_.template($("#purchased-product-tpl").html());b.indexScore=e.find("\x3e div").length+1;b.createdAt=moment.utc(b.createdAt).local().format("YYYY-MM-DD HH:mm:ss");b=d(b);e.append(b)})})},loadFinancialEventList=function(){var a=$("#financial_event_list"),e=LeoCdpAdmin.routerContext.dataObject.financeCreditEvents;0<e.length&&a.empty();_.forEach(e,function(b){var d=_.template($("#financial-event-tpl").html());"good"===b.risk?(b.riskIcon="fa-thumbs-o-up",b.riskIconColor="#45D50F"):(b.riskIcon=
"fa-thumbs-o-down",b.riskIconColor="#F40209");b.risk=b.risk.toUpperCase();b=d(b);a.append(b)})},emptyInfo='\x3cbr\x3e \x3cdiv style\x3d"font-size:24px;" class\x3d"text-center" \x3e No data available \x3ci class\x3d"fa fa-exclamation" aria-hidden\x3d"true"\x3e\x3c/i\x3e \x3c/div\x3e \x3cbr\x3e',loadEventsInProfileIndex=0,loadEventsInProfileResult=25,callApiToGetTrackingEventsOfProfile=function(a,e){var b=$("#profile_activitiy_flow"),d=$("#profile_activitiy_flow_container");0===loadEventsInProfileIndex&&
(b.empty().css({"max-height":"660px","min-height":"80px"}),d.css({height:"680px"}));if(0<b.find("li.all-loaded").length)console.log("Loaded all data for loadEventsInProfile"),b.show();else{d.hide();var f=$("#profile_activitiy_flow_loader").show(),k={profileId:viewProfileId};k.startIndex=loadEventsInProfileIndex;k.numberResult=loadEventsInProfileResult;k.journeyMapId=currentJourneyMapId;k.searchValue=a;LeoAdminApiUtil.getSecuredData("/cdp/profile/tracking-events",k,function(n){f.hide();0===n.data.length&&
(0===loadEventsInProfileIndex?(b.html(emptyInfo),$("#profileEventStatistics").html(emptyInfo)):(b.find("li:last-child").addClass("all-loaded"),$("#profile_activitiy_flow_done").show(),$("#btn_loadMoreEvents").attr("disabled","disabled").attr("title","All data is loaded"),$("#btn_filterEvents").attr("disabled","disabled")));_.forEach(n.data,function(h){try{h.srcTouchpoint.url=h.srcTouchpoint.url.replace("leosyn\x3d","leovid\x3d");h.srcTouchpoint.name=textTruncate(decodeURI(h.srcTouchpoint.name),120);
h.srcTouchpoint.truncatedUrl=textTruncate(h.srcTouchpoint.url,120);h.createdAt=moment.utc(h.createdAt).local().format("YYYY-MM-DD HH:mm:ss");0<_.size(h.eventData)?h.cssStyleDisplay="block":h.cssStyleDisplay="none";var p=h.journeyStage,c=h.transactionValue,g=_.template($("#"+(4===p&&0<c?"conversion-event-tpl":3<=p?"action-event-tpl":2===p?"key-info-view-event-tpl":"view-event-tpl")).html())(h);b.append(g)}catch(m){console.error(m)}});d.show();"function"===typeof e?e():(n=b.height()+20,d.height(n).scrollTop(0),
console.log("\x3d\x3d\x3e hfh \x3d "+n))})}},loadEventsInProfile=function(a,e,b){$("#btn_loadMoreEvents").removeAttr("disabled").attr("Load more events");$("#btn_filterEvents").removeAttr("disabled");!0===a&&(loadEventsInProfileIndex=0,$("#profile_activitiy_flow_done").hide());a=$("#keywords_filter_events");!0===e&&a.val("");e=a.val().trim();callApiToGetTrackingEventsOfProfile(e,b)};
function initProfileEventInStream(){loadEventsInProfile(!0,!0);$("#keywords_filter_events").keypress(function(a){"13"==(a.keyCode?a.keyCode:a.which)&&(0<$(this).val().trim().length?(loadEventsInProfileIndex=0,loadEventsInProfile(!1,!1)):loadEventsInProfile(!0,!1))}).change(function(){$("#profile_activitiy_flow").empty();$("#profile_activitiy_flow_container").height(20).scrollTop(0);$("#btn_loadMoreEvents").attr("disabled","disabled")})}
function loadMoreEventsInProfile(){loadEventsInProfileIndex=$("#profile_activitiy_flow \x3e li").length;loadEventsInProfile(!1,!1,function(){$(document).scrollTop($(document).height()-100);var a=$("#profile_activitiy_flow_container"),e=a.prop("scrollHeight")+200;a.scrollTop(e)})}var loadFeedbacksInProfileIndex=0,loadFeedbacksInProfileResult=120;
function loadFeedbackEventsInProfile(){$("#keyword_filter_feedbacks").val("");var a=$("#profile_feedback_flow");0===loadEventsInProfileIndex&&(a.empty(),$("#keywords_filter_events").change(function(){2>$(this).val().trim().toLowerCase().length&&$("#profile_activitiy_flow li").show()}));var e=$("#profile_feedback_flow_loader").show();LeoAdminApiUtil.getSecuredData("/cdp/profile/feedback-events",{id:viewProfileId,startIndex:loadFeedbacksInProfileIndex,numberResult:loadFeedbacksInProfileResult},function(b){e.hide();
b=b.data;0===b.length?a.html('\x3cli class\x3d"list-group-item view" \x3e \x3cdiv class\x3d"list-group-item" \x3e No data available \x3c/div\x3e \x3c/li\x3e'):(a.css("height","650px"),_.forEach(b,function(d,f){d.createdAt=moment.utc(d.createdAt).local().format("YYYY-MM-DD HH:mm:ss");f=baseLeoObserverUrl+"/webform?\x26tplfbt\x3dSURVEY\x26tplid\x3d"+d.refTemplateId;d.previewUrl="SURVEY"===d.feedbackType?f:d.touchpointUrl;f=d.eventName;d.eventIcon="submit-feedback-form"===f?"fa-commenting-o":"submit-rating-form"===
f?"fa-star":"fa-smile-o";f=$("RATING"===d.feedbackType?"#feedback-rating-event-tpl":"#feedback-survey-event-tpl").html();f=_.template(f);a.append(f(d))}))});$("#keyword_filter_feedbacks").change(function(){2>$(this).val().trim().toLowerCase().length&&$("#profile_feedback_flow li").show()})}
function filterFeedbackEvent(){var a=$("#keyword_filter_feedbacks").val().trim().toLowerCase(),e=$("#profile_feedback_flow li");2<=a.length&&e.each(function(){0>$(this).find("h5.media-heading").text().toLowerCase().indexOf(a)?$(this).hide():$(this).show()})}function removeCurrentProfile(){var a=LeoCdpAdmin.routerContext.dataObject;a?LeoCdpAdmin.navFunctions.removeCustomerProfile(a.id):notifyErrorMessage("LeoCdpAdmin.routerContext.dataObject is NULL !")}
function refreshCurrentProfile(){var a=LeoCdpAdmin.routerContext.dataObject;if(a){var e=(new Date).getTime();location.hash="#calljs-leoCdpRouter('Customer_Profile_Info','"+a.id+"','_refresh_"+e+"')"}else notifyErrorMessage("LeoCdpAdmin.routerContext.dataObject is NULL !")}var deduplicateCurrentProfileDialog=function(){$("#deduplicateCurrentProfileDialog").modal({backdrop:"static",keyboard:!1,focus:!0})};
function deduplicateCurrentProfile(){var a=LeoCdpAdmin.routerContext.dataObject;a&&($("#deduplicateCurrentProfileDialog").modal("hide"),iziToast.info({title:"Profile Data Duplication",message:"CDP is processing for profile deduplication. It takes several minutes to do this job"}),LeoAdminApiUtil.callPostAdminApi("/cdp/profile/deduplicate",{profileId:a.id},function(e){0===e.httpCode&&""===e.errorMessage?("object"===typeof e.data&&iziToast.info({title:"Merge Duplicate Profile",message:"Total processed profile: "+
e.data.count}),location.hash="#calljs-leoCdpRouter('Customer_Profile_Info','"+e.data.keyProfileId+"')"):LeoAdminApiUtil.logErrorPayload(e)}))}
function removeSelectedProfiles(){$("#delete_callback").val("");$("#confirmDeleteDialog").modal({focus:!0});var a=Object.keys(window.selectedDuplicateProfileIdMap||{}).length;0<a&&""===$("#filterProfileListByStatus").val()&&($("#deletedInfoTitle").text("Total Selected Profile \x3d "+a).show(),$("#deletedInfoMsg").text("Do you want to remove selected profiles?"),window.removeSelectedProfilesConfirmOk=function(){LeoAdminApiUtil.callPostAdminApi("/cdp/profiles/batch-update",selectedDuplicateProfileIdMap,
function(e){0===e.httpCode&&""===e.errorMessage?(iziToast.info({title:"Customer Profile Management",message:"Total removed profile is "+e.data+" !"}),_.forOwn(selectedDuplicateProfileIdMap,function(b,d){delete selectedDuplicateProfileIdMap[d]}),resetProfileSearch()):LeoAdminApiUtil.logErrorPayload(e)})},$("#delete_callback").val("removeSelectedProfilesConfirmOk"))}
function deleteNotActiveProfile(){$("#delete_callback").val("");$("#deletedInfoTitle").empty().hide();var a=$("#filterProfileListByStatus option:selected").text().trim();$("#deletedInfoMsg").text("Do you want to delete ALL "+a+" ?");$("#confirmDeleteDialog").modal({focus:!0});window.deleteNotActiveProfileConfirmOk=function(){var e=$("#filterProfileListByStatus").val(),b=-4;""!=e&&(b=parseInt(e));LeoAdminApiUtil.callPostAdminApi("/cdp/profiles/delete-not-active",{status:b},function(d){0===d.httpCode&&
""===d.errorMessage?(iziToast.info({title:"Profile Data Management",message:"Deleted \x3cb\x3e"+d.data+"\x3c/b\x3e profiles"}),resetProfileSearch()):LeoAdminApiUtil.logErrorPayload(d)})};$("#delete_callback").val("deleteNotActiveProfileConfirmOk")}
function loadProfileJourneyFlowReport(a,e){$("#journeyFlowChart").parent().hide();""===e&&(e="id_default_journey");LeoAdminApiUtil.getSecuredData("/cdp/analytics360/journey-flow-report",{journeyMapId:e,profileId:a},function(b){if(0<b.errorCode)iziToast.error({title:"Data Journey Map",message:b.errorMessage});else{var d=b.data;b=d.defaultMetricName;var f=d.journeyStages,k=d.journeyLinks,n=d.journeyNodes;d=d.touchpointHubMap;$("#journeyFlowChart").parent().show();renderJourneyFlowChart("#journeyFlowChart",
b,f,n,k,d)}})}
const renderProfileBarChart=function(a,e){if(e){var b=[],d=[];$.each(e,function(f,k){b.push(f);d.push(k)});renderHorizontalBarChart(a,b,d)}else $("#"+a).html('\x3ch4 class\x3d"alert alert-info" role\x3d"alert"\x3e No data available \x3c/h4\x3e')},loadProfileEventMatrix=function(a,e){var b={};b.profileId=a;b.journeyMapId=e;LeoAdminApiUtil.getSecuredData(baseLeoAdminUrl+"/cdp/analytics360/event-matrix",b,function(d){0===d.httpCode&&""===d.errorMessage?(d=d.data,renderMatrixChart("Event Matrix Report","profile_event_matrix",
d.xLabels,d.yLabels,d.dataList)):LeoAdminApiUtil.logErrorPayload(d)})},loadJourneyReportForProfile=function(a){var e=currentJourneyMapId||"id_default_journey",b={};$.each(a.eventStatistics,function(f,k){var n=f.indexOf("-");if(0>n)b[e]="object"===typeof b[e]?b[e]:{},b[e][f]=k;else{var h=f.substring(0,n).trim();f=f.substring(n+1);b[h]="object"===typeof b[h]?b[h]:{};b[h][f]=k;b[""]="object"===typeof b[""]?b[""]:{};b[""][f]="number"===typeof b[""][f]?b[""][f]+k:k}});renderProfileBarChart("profileReferrerChannels",
a.referrerChannels);a.journeyEventStats=b;var d=window.viewProfileId;loadJourneyMapList(!1,function(f,k){$("span.profileJourneyName").text(k);renderProfileBarChart("profileEventStatsChart",b[f]);loadProfileEventMatrix(d,f);setTimeout(function(){loadProfileEventDailyReportUnit()},800)},!0,function(f,k){$("span.profileJourneyName").text(k);renderProfileBarChart("profileEventStatsChart",b[f]);loadProfileEventMatrix(d,f);setTimeout(function(){window.profileTimeseriesChart=!1;$("#timeseriesProfileEventChart").empty();
loadProfileEventDailyReportUnit()},3E3)})},loadProfileDataJourneyReport=function(){setTimeout(function(){$("#event_journey_funnel").empty();loadEventJourneyProfile(viewProfileId,currentJourneyMapId)},700);loadTouchpointFlowForProfile(viewProfileId,currentJourneyMapId);loadTouchpointHubReportForProfile(viewProfileId,currentJourneyMapId)},loadTouchpointHubReportForProfile=function(a,e){$("#profileObserverChart").html('\x3cdiv class\x3d"loader"\x3e\x3c/div\x3e');LeoAdminApiUtil.getSecuredData(baseLeoAdminUrl+
"/cdp/analytics360/touchpoint-hub-report",{profileId:a,journeyMapId:e},function(b){if(0===b.httpCode&&""===b.errorMessage)if(b=b.data,0<b.length){var d=[],f=[];b.forEach(function(k){d.push(k.name);f.push(k.eventCount)});renderHorizontalBarChart("profileObserverChart",d,f)}else $("#profileObserverChart").html('\x3ch4 class\x3d"alert alert-info" role\x3d"alert"\x3e No data available \x3c/h4\x3e');else LeoAdminApiUtil.logErrorPayload(b)})},loadProfileTopTouchpoints=function(){renderProfileTouchpointChart(viewProfileId,
-1,0,20)},renderProfileTouchpointChart=function(a,e,b,d){$("#profileTouchpointChart").html('\x3cdiv class\x3d"loader"\x3e\x3c/div\x3e');LeoAdminApiUtil.getSecuredData(baseLeoAdminUrl+"/cdp/analytics360/touchpoint-report",{profileId:a,touchpointType:e,startIndex:b,numberResult:d},function(f){if(0===f.httpCode&&""===f.errorMessage){f=f.data;var k=$("#engaged_touchpoint_list");if(0<f.length){k.empty();var n=[],h=[];f.forEach(function(p){var c=p.touchpoint,g=textTruncate(c.name,60);n.push(g);h.push(p.eventCount);
g=_.template($("#engaged-touchpoint-tpl").html());c.updatedAt=moment.utc(c.updatedAt).local().format("YYYY-MM-DD HH:mm:ss");c.truncatedUrl=textTruncate(c.url,120);""===c.locationCode&&(c.cssShowLocationCode="none");c.eventCount=p.eventCount;k.append(g(c))});renderHorizontalBarChart("profileTouchpointChart",n,h)}else $("#profileTouchpointChart").html("\x3ch4\x3e No data available \x3c/h4\x3e")}else LeoAdminApiUtil.logErrorPayload(f)})},renderTaxonomyTextData=function(a){var e=$("#profileInSegments"),
b=a.inSegments.length;a.inSegments.forEach(function(c){b--;var g=0<b,m="Segment: "+c.name;c="\x3cb\x3e"+$("\x3ca/\x3e").attr("title",m).attr("href","#calljs-leoCdpRouter('Segment_Details','"+c.id+"')").text(c.name)[0].outerHTML+"\x3c/b\x3e";g&&(c+="; ");e.append(c)});var d=$("#profileInJourneyMaps"),f=a.inJourneyMaps.length;a.inJourneyMaps.forEach(function(c){f--;var g=0<f,m="Journey Map: "+c.name+" \x3d\x3e At Stage: "+journeyStagesMap[c.indexScore],q=c.name;m="\x3cb\x3e"+$("\x3ca/\x3e").attr("title",
m).attr("href","#calljs-leoCdpRouter('Data_Journey_Map','"+c.id+"')").html(q)[0].outerHTML+"\x3c/b\x3e";g&&(m+="; ");""===c.queryHashedId&&d.append(m)});var k=$("#profileInAccounts"),n=a.inAccounts.length;a.inAccounts.forEach(function(c){n--;var g=0<n;c="\x3cb\x3e"+$("\x3ca/\x3e").attr("href","#calljs-leoCdpRouter('Account_Details','"+c.id+"')").html(c.name)[0].outerHTML+"\x3c/b\x3e";g&&(c+="; ");k.append(c)});var h=$("#profileDataLabels"),p=a.dataLabels.length;a.dataLabels.forEach(function(c){p--;
c="\x3cb\x3e"+c+"\x3c/b\x3e";0<p&&(c+="; ");h.append(c)})},loadEventJourneyProfile=function(a,e){var b=$("#event_journey_funnel").parent().width()-15;a={profileId:a,journeyMapId:e};e=baseLeoAdminUrl+"/cdp/analytics360/event-report/journey-profile";$("#event_journey_funnel_info").html('\x3cdiv class\x3d"loader"\x3e\x3c/div\x3e');LeoAdminApiUtil.getSecuredData(e,a,function(d){if(0===d.httpCode&&""===d.errorMessage){var f=d.data.total,k=0,n=d.data.funnelIndex;d.data.scoreCX&&(k=d.data.scoreCX.sentimentScore);
var h=$("#profileJourneyFunnel");90<=n?h.attr("class","progress-bar progress-bar-striped active progress-bar-danger"):50<=n&&90>n?h.attr("class","progress-bar progress-bar-striped active progress-bar-success"):h.attr("class","progress-bar progress-bar-striped active progress-bar-primary");$("#profileJourneySentimentScore").text(k);$("#profileJourneyFunnelValue").text(n);h.attr("aria-valuenow",n).css("width",n+"%");$("#profile_funnel_report \x3e div").removeClass("funnel-stage-active");k=Math.floor(n/
10);for(n=1;n<=k;n++)$("#profile_funnel_stage_"+n).addClass("funnel-stage-active");0==f?($("#event_journey_funnel_info").html('\x3cdiv class\x3d"alert alert-info" role\x3d"alert" \x3eNo data available\x3c/div\x3e').show(),$("#journeyFlowChart").hide()):($("#event_journey_funnel_info").empty().hide(),$("#journeyFlowChart").show(),(new FunnelGraph({container:"#event_journey_funnel",gradientDirection:"horizontal",data:{labels:journeyLabel5A,subLabels:["Event Data Point"],colors:[["#9ACAEF","#67B0E9",
"#309EF3"]],values:d.data.reportData},displayPercent:!0,direction:"horizontal",width:b,height:330,subLabelValue:"raw"})).draw())}else LeoAdminApiUtil.logErrorPayload(d)})},loadTouchpointFlowForProfile=function(a,e){var b=$("#profileTouchpointFlow");a={profileId:a,journeyMapId:e,beginFilterDate:"",endFilterDate:""};e=baseLeoAdminUrl+"/cdp/analytics360/touchpoint-flow-report";b.html('\x3cdiv class\x3d"loader"\x3e\x3c/div\x3e');LeoAdminApiUtil.getSecuredData(e,a,function(d){0===d.httpCode&&""===d.errorMessage?
(b.empty(),renderDirectedGraph("profileTouchpointFlow",{nodes:d.data.nodes,edges:d.data.edges},d.data.rootNodeId)):LeoAdminApiUtil.logErrorPayload(d)})},profileInfoLoadProcessor=function(a){viewProfileId=a.id;a.fullName=""!==a.firstName||""!==a.lastName?a.firstName+" "+a.lastName:"Web Visitor";a.typeAsText=a.typeAsText.replaceAll("_"," ");0>=a.age&&(a.age="-");""===a.livingLocation&&(a.livingLocation="_");""===a.primaryPhone&&(a.primaryPhone="-");""===a.firstName&&(a.firstName="-");""===a.lastName&&
(a.lastName="-");""===a.primaryEmail&&(a.primaryEmail="-");if("number"===typeof a.jobType){var e=a.jobType;a.jobTypeAsString=0===e?"UNSKILLED AND NON-RESIDENT":1===e?"UNSKILLED AND RESIDENT":2===e?"SKILLED":3===e?"HIGHLY SKILLED":"-"}a.funnelStage=a.funnelStage?a.funnelStage.toUpperCase():"-";a.lastTrackingEvent?(a.lastTrackingEvent.createdAt=moment.utc(a.lastTrackingEvent.createdAt).local().format("YYYY-MM-DD HH:mm:ss"),a.lastTrackingEvent.fingerprintId=a.lastTrackingEvent.fingerprintId?a.lastTrackingEvent.fingerprintId:
"-",a.lastTrackingEvent&&a.lastTrackingEvent.refTouchpoint&&(a.lastTrackingEvent.refTouchpoint.name=decodeURISafe(a.lastTrackingEvent.refTouchpoint.name))):a.lastTrackingEvent.createdAt="-";a.lastTouchpoint.name=decodeURI(a.lastTouchpoint.name);return a},loadProfileListByFilter=function(a,e,b,d,f,k,n){var h=[{data:"id"},{data:"firstName"},{data:"primaryEmail"},{data:"primaryPhone"},{data:"lastTouchpoint"},{data:"dataQualityScore"},{data:"totalLeadScore"},{data:"totalCLV"},{data:"updatedAt"},{data:"status"}],
p=getUserSession();return p?$(d).DataTable({lengthMenu:[[30,50,60],[30,50,60]],processing:!0,serverSide:!0,searching:!1,ordering:!0,serverMethod:"POST",ajax:{url:baseLeoAdminUrl+"/cdp/profiles/filter",contentType:"application/json",beforeSend:function(c){$(b).show();$(e).hide();c.setRequestHeader("leouss",p)},data:function(c){c=f(c);c.order.map(function(g){g.field=h[g.column]?h[g.column].data:""});return JSON.stringify(c)},dataSrc:function(c){var g=c.canInsertData,m=c.canEditData,q=c.canDeleteData;
$(d).data("canInsertData",g);$(d).data("canEditData",m);$(d).data("canDeleteData",q);"function"===typeof k&&k(c);$(b).hide();$(e).show();return c.data}},columnDefs:[{render:function(c,g,m){g="";"function"===typeof window[a]&&(g=getTableRowCheckedBox(a,d,c,!1));return g},targets:0,orderable:!1},{render:function(c,g,m){c="Web Visitor";var q="datatable_text no_contact";g="Data Profile of ";0<m.firstName.length||0<m.lastName.length?(q=m.firstName+" "+m.lastName,c=textTruncate(q,30),g+=q,q="datatable_text has_contact"):
g+=c;m.dataVerification&&(c='\x3ci class\x3d"fa fa-check-circle-o" aria-hidden\x3d"true" title\x3d"Verified Data" \x3e\x3c/i\x3e '+c,g="Verified "+g);return'\x3ca class\x3d"'+q+'" title\x3d"'+g+"\" href\x3d\"#calljs-leoCdpRouter('Customer_Profile_Info','"+(m.id+"')\" \x3e")+c+"\x3c/a\x3e"},targets:1,orderable:!1},{render:function(c,g,m){return"string"===typeof c?'\x3cdiv class\x3d"datatable_text "\x3e\x3ca title\x3d"'+(c+"\" href\x3d\"#calljs-leoCdpRouter('Customer_Profile_Info','"+(m.id+"')\" \x3e")+
textTruncate(c,40)+"\x3c/a\x3e\x3c/div\x3e"):"-"},targets:2,orderable:!1},{render:function(c,g,m){return"string"===typeof c?'\x3cdiv class\x3d"datatable_text"\x3e\x3ca title\x3d"'+(c+"\" href\x3d\"#calljs-leoCdpRouter('Customer_Profile_Info','"+(m.id+"')\" \x3e")+textTruncate(c,30)+"\x3c/a\x3e\x3c/div\x3e"):"-"},targets:3,orderable:!1},{render:function(c,g,m){"object"!==typeof m.lastTouchpoint&&(m.lastTouchpoint={name:"No data"});return'\x3cdiv style\x3d"font-size:11.4px;" title\x3d"'+m.lastTouchpoint.name+
'"\x3e'+textTruncate(m.lastTouchpoint.name,50)+"\x3c/div\x3e"},targets:4,orderable:!1},{render:function(c,g,m){g=(new Number(c)).toLocaleString();return 100>=c?'\x3cdiv class\x3d"datatable_text text-center"\x3e'+g+" \x3c/div\x3e":100<c&&250>c?'\x3cdiv class\x3d"highlight_text text-center profile_medium_score" \x3e'+g+"\x3c/div\x3e":'\x3cdiv class\x3d"highlight_text text-center profile_high_score"  \x3e'+g+"\x3c/div\x3e"},targets:5},{render:function(c,g,m){g=(new Number(c)).toLocaleString();return 20>
c?'\x3cdiv class\x3d"datatable_text text-center"\x3e'+g+" \x3c/div\x3e":20<=c&&100>c?'\x3cdiv class\x3d"highlight_text text-center profile_medium_score" \x3e'+g+"\x3c/div\x3e":100<=c?'\x3cdiv class\x3d"highlight_text text-center profile_high_score" \x3e'+g+"\x3c/div\x3e":'\x3cdiv class\x3d"highlight_text text-center" style\x3d"color:#404040!important;font-size:0.8em!important" \x3e'+g+" \x3c/div\x3e"},targets:6},{render:function(c,g,m){g=(new Number(c)).toLocaleString();return 20>c?'\x3cdiv class\x3d"datatable_text text-center"\x3e'+
g+" \x3c/div\x3e":20<=c&&100>c?'\x3cdiv class\x3d"highlight_text text-center profile_medium_score" \x3e'+g+"\x3c/div\x3e":100<=c?'\x3cdiv class\x3d"highlight_text text-center profile_high_score" \x3e'+g+" \x3c/div\x3e":'\x3cdiv class\x3d"highlight_text text-center" style\x3d"color:#404040!important;font-size:0.8em!important" \x3e'+g+" \x3c/div\x3e"},targets:7},{render:function(c,g,m){return c?'\x3cdiv class\x3d"small text-center" style\x3d"color:#3300ff;width:74px" \x3e'+moment.utc(c).local().format("YYYY-MM-DD HH:mm:ss")+
"\x3c/div\x3e":"-"},targets:8},{render:function(c,g,m){g="ACTIVE";0===c?g="INACTIVE":-1===c?g="INVALID":-4===c&&(g="REMOVED");return'\x3cdiv class\x3d"small text-center" style\x3d"color:#3300ff!important" title\x3d"The profile status is '+g+'"\x3e'+g+"\x3c/div\x3e"},targets:9},{render:function(c,g,m){c='\x3cdiv style\x3d"width:76px;"\x3e \x3ca class\x3d"control" title\x3d"View Profile Report" href\x3d"#calljs-leoCdpRouter(\'Customer_Profile_Info\',\''+(m.id+'\')" \x3e \x3ci class\x3d"fa fa-info-circle" aria-hidden\x3d"true"\x3e\x3c/i\x3e View\x3c/a\x3e');
$(d).data("canEditData")&&(c+=' \x3cbr\x3e\x3ca class\x3d"control" title\x3d"Edit Profile Data" href\x3d"#calljs-leoCdpRouter(\'Customer_Profile_Editor\',\''+(m.id+'\')" \x3e \x3ci class\x3d"fa fa-pencil-square-o" aria-hidden\x3d"true"\x3e\x3c/i\x3e Edit\x3c/a\x3e'));"string"===typeof n&&(c+=n);return c+"\x3c/div\x3e"},targets:10}],columns:h,order:[[8,"desc"]]}):!1};
function loadDuplicatedProfiles(){selectedDuplicateProfileIdMap={};var a=LeoCdpAdmin.routerContext.dataObject,e=function(b){b.excludeProfileId=a.id;b.email=5<a.primaryEmail.length?a.primaryEmail:"";b.phone=1<a.primaryPhone.length?a.primaryPhone:"";b.visitorId=1<a.visitorId.length?a.visitorId:"";b.crmRefId=1<a.crmRefId.length?a.crmRefId:"";b.fingerprintId=1<a.fingerprintId.length?a.fingerprintId:"";b.lastSeenIp=1<a.lastSeenIp.length?a.lastSeenIp:"";b.lastUsedDeviceId=1<a.lastUsedDeviceId.length?a.lastUsedDeviceId:
"";return b};!1!==duplicateProfileTable&&"object"===typeof duplicateProfileTable.ajax?duplicateProfileTable.ajax.reload():duplicateProfileTable=loadProfileListByFilter(!1,"#duplicate_profile_container","#duplicate_profile_loader","#duplicate_profile_table",e,!1,"")};