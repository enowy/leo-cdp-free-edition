'use strict';function profileAddNewTextHashSet(a){var e=$('\x3cli class\x3d"list-group-item" \x3e\x3cdiv class\x3d"row" \x3e\x3cdiv class\x3d"col-md-11" \x3e\x3cinput class\x3d"form-control" type\x3d"text" placeholder\x3d"Value" data-fieldholder\x3d"hashset" data-fieldtype\x3d"string" autocomplete\x3d"off"\x3e\x3c/div\x3e\x3cdiv class\x3d"col-md-1" \x3e\x3ch4 onclick\x3d"$(this).parent().parent().parent().remove()" \x3e\x3ci class\x3d"fa fa-times-circle delete-item-btn" aria-hidden\x3d"true"\x3e\x3c/i\x3e\x3c/h4\x3e \x3c/div\x3e\x3c/div\x3e\x3c/li\x3e');
$('p[data-field\x3d"'+a+'"] \x3e ul').append(e);e.effect("highlight",{},4E3)}function profileAddNewCustomField(a){var e=$(loadCustomFieldEditor(a,"",""));$('p[data-field\x3d"'+a+'"] \x3e ul').append(e);e.effect("highlight",{},4E3)}function handleProfileListFiltersBy(a,e){$("#profile_filter_inputs \x3e .form-control").val("").hide();$(e).show();$("#profile_filter_input_label").text($(a).text()).show();$("#main_search_profile").val("");showDeleteNotActiveProfile()}
var addNewHashMapItem=function(a,e){var b=a+"_"+(new Date).getTime(),c=$("#"+a),f=Object.assign({},e);c.find("option:selected").each(function(){var k=$(this).val();delete f[k]});a=$(loadHashMapSelector(b,a,f,"",""));c.find("ul.list-group").append(a);a.effect("highlight",{},4E3)};function removeHashMapItem(a){$(a).parent().parent().remove()}
function loadHashMapSelector(a,e,b,c,f){var k='\x3cdiv class\x3d"col-md-3" \x3e \x3cselect class\x3d"form-control" id\x3d"key_'+a+'" name\x3d"'+e+'" \x3e';_.forOwn(b,function(d,g){d='\x3coption name\x3d"'+e+'" value\x3d"'+g+'"\x3e '+g.toUpperCase()+" \x3c/option\x3e";g===c&&(d='\x3coption name\x3d"'+e+'" selected value\x3d"'+g+'"\x3e '+g.toUpperCase()+" \x3c/option\x3e");k+=d});k+=" \x3c/select\x3e \x3c/div\x3e";""===c&&$("#key_"+a).find("option:first").attr("selected","selected");return'\x3cli id\x3d"item_'+
a+'" class\x3d"list-group-item" \x3e\x3cdiv class\x3d"row" \x3e '+k+('\x3cdiv class\x3d"col-md-8" \x3e\x3cinput id\x3d"value_'+a+'" value\x3d"'+(f?f:"")+'" class\x3d"form-control" type\x3d"text" placeholder\x3d"Value" data-fieldholder\x3d"hashmap" data-fieldtype\x3d"string" autocomplete\x3d"off"\x3e\x3c/div\x3e\x3cdiv title\x3d"Delete" class\x3d"col-md-1" onclick\x3d"removeHashMapItem(this)" \x3e \x3ch4\x3e\x3ci class\x3d"fa fa-times-circle delete-item-btn" aria-hidden\x3d"true"\x3e\x3c/i\x3e\x3c/h4\x3e \x3c/div\x3e \x3c/div\x3e\x3c/li\x3e')}
function loadCustomFieldEditor(a,e,b){return'\x3cli class\x3d"list-group-item" \x3e\x3cdiv class\x3d"row" \x3e \x3cdiv class\x3d"col-md-3" \x3e \x3cinput type\x3d"text" class\x3d"form-control custom_field_name" placeholder\x3d"Field Name" value\x3d"'+(e+'"\x3e \x3c/div\x3e\x3cdiv class\x3d"col-md-8" \x3e\x3cinput class\x3d"form-control custom_field_value" type\x3d"text" value\x3d"')+((b?b:"")+'" placeholder\x3d"Field Value" data-fieldholder\x3d"hashmap" data-fieldtype\x3d"string" autocomplete\x3d"off"\x3e\x3c/div\x3e\x3cdiv title\x3d"Delete" class\x3d"col-md-1" onclick\x3d"removeHashMapItem(this)" \x3e \x3ch4\x3e\x3ci class\x3d"fa fa-times-circle delete-item-btn" aria-hidden\x3d"true"\x3e\x3c/i\x3e\x3c/h4\x3e \x3c/div\x3e \x3c/div\x3e\x3c/li\x3e')}
const loadProfileDataIntoDOM=function(a,e,b,c,f){var k=!1,d={};"string"===typeof e?(k="/cdp/profile/get",d.id=e):"string"===typeof b&&(k="/cdp/profile/get-by-crm-id",d.crmRefId=b);!1===k?(console.error("loadProfileDataIntoDOM is failed, profileId or crmRefId must be a valid string! "),console.log("urlStr "+k),console.log("params "+d)):LeoAdminApiUtil.callPostAdminApi(baseLeoAdminUrl+k,d,function(g){if(0===g.httpCode&&""===g.errorMessage){var l=g.canInsertData,t=g.canDeleteData;g.canEditData||$("button.data-control-edit").attr("disabled",
"disabled");t||$("button.data-control-delete").attr("disabled","disabled");l||$("button.data-control-insert").attr("disabled","disabled");LeoCdpAdmin.routerContext.dataObject="function"===typeof c?c(g.data):g.data;$("#data_model_holder").find("*[data-field]").each(function(){$(this).prop("tagName");var q=$(this).attr("type"),r=$(this).data("fieldholder"),u=$(this).data("fieldtype"),w=$(this).data("field"),v=w.split(".");if(1===v.length){var h=LeoCdpAdmin.routerContext.dataObject[v[0]];if("html"===
r){if("int"===u||"float"===u)if(void 0===h||null==h)h="-";else{if(h=(new Number(h)).toLocaleString(),NaN==h||"NaN"==h)h="-"}else"date"===u?h=h?moment.utc(h).local().format("YYYY-MM-DD"):"-":"date_time"===u?h=h?moment.utc(h).local().format("YYYY-MM-DD HH:mm:ss"):"-":"phone"===u&&(h=h?h.replace(/\D/g,""):"-");$(this).html(h)}else if("percentage"===r)$(this).html(h).parent().attr("aria-valuenow",h).css("width",h+"%"),q=$(this).parent(),q.attr("title",h+"% "+q.attr("title"));else if("url"===r)$(this).html(checkToAddUrlValueToDOM(h));
else if("locationcode"===r)q=$("\x3ca/\x3e").attr("href","javascript:").html(textTruncate(h,80)).click(function(){var m=LeoCdpAdmin.routerContext.dataObject.locationCode;0===m.indexOf("http")?eModal.iframe(m,"Location"):m&&""!=m.trim()&&eModal.iframe("https://plus.codes/"+m,h)}),$(this).html(q);else if("inputvalue"===r)"radio"===q||"checkbox"===q?h==$(this).val()&&$(this).attr("checked","checked"):$(this).val(h);else if("html_hashmap"===r){var n=' \x3cul class\x3d"list-group" \x3e ';_.forOwn(h,function(m,
p){p=p.trim();a?(m=loadHashMapSelector(w+"_"+p,w,"socialMediaProfiles"===w?SocialMediaIconMap:"personalContacts"===w?PersonalContactIconsMap:ContactIconsMap,p,m),n+=m):(p="socialMediaProfiles"===w?SocialMediaIconMap[p]?SocialMediaIconMap[p]:!1:"personalContacts"===w?PersonalContactIconsMap[p]?PersonalContactIconsMap[p]:!1:ContactIconsMap[p]?ContactIconsMap[p]:!1,!1===p&&(p=' \x3ci class\x3d"fa fa-info-circle" aria-hidden\x3d"true"\x3e\x3c/i\x3e '),n=n+'\x3cli class\x3d"list-group-item" \x3e '+p+checkToAddUrlValueToDOM(m)+
"\x3c/li\x3e")});n+=" \x3c/ul\x3e ";$(this).html(n)}else"html_hashset"===r?(n='\x3cul class\x3d"list-group" \x3e',_.forOwn(h,function(m,p){m=a?'\x3cdiv class\x3d"col-md-11" \x3e\x3cinput value\x3d"'+m+'" class\x3d"form-control" type\x3d"text" placeholder\x3d"Value" data-fieldholder\x3d"hashset" data-fieldtype\x3d"string" autocomplete\x3d"off"\x3e\x3c/div\x3e\x3cdiv class\x3d"col-md-1" \x3e\x3ch4 onclick\x3d"$(this).parent().parent().parent().remove()" \x3e\x3ci class\x3d"fa fa-times-circle delete-item-btn" aria-hidden\x3d"true"\x3e\x3c/i\x3e\x3c/h4\x3e\x3c/div\x3e':
"system_user"===u?' \x3cdiv class\x3d"col-md-12" \x3e \x3cb\x3e \x3ci class\x3d"fa fa-info-circle" aria-hidden\x3d"true"\x3e\x3c/i\x3e\x3c/b\x3e '+buildSystemUserInfoLink(m)+"\x3c/div\x3e":' \x3cdiv class\x3d"col-md-12" \x3e \x3cb\x3e \x3ci class\x3d"fa fa-info-circle" aria-hidden\x3d"true"\x3e\x3c/i\x3e\x3c/b\x3e '+checkToAddUrlValueToDOM(m)+"\x3c/div\x3e";n=n+'\x3cli class\x3d"list-group-item" \x3e \x3cdiv class\x3d"row" \x3e '+m+"\x3c/div\x3e\x3c/li\x3e"}),n+="\x3c/ul\x3e",$(this).html(n)):"html_list_key_value"===
r?(n='\x3cul class\x3d"list-group" \x3e',q=Object.keys(h),q.sort(),q.forEach(function(m){n=n+'\x3cli class\x3d"list-group-item" \x3e '+m+'  \x3ci class\x3d"fa fa-arrow-right" aria-hidden\x3d"true"\x3e\x3c/i\x3e  '+h[m]+"\x3c/li\x3e"}),n+="\x3c/ul\x3e",$(this).html(n)):"html_custom_field"===r&&(n=' \x3cul class\x3d"list-group" \x3e ',_.forOwn(h,function(m,p){p=p.trim();a?(m=loadCustomFieldEditor(w+"_"+p,p,m),n+=m):(n+='\x3cli class\x3d"list-group-item" \x3e',n+='\x3cdiv class\x3d"row" \x3e \x3cdiv class\x3d"col-md-3"\x3e \x3cb\x3e '+
p+'\x3c/b\x3e \x3ci  style\x3d"font-size:20px" class\x3d"fa fa-equals" aria-hidden\x3d"true"\x3e\x3c/i\x3e \x3c/div\x3e',n+='\x3cdiv class\x3d"col-md-9"\x3e'+m+"\x3c/div\x3e \x3c/div\x3e\x3c/li\x3e")}),n+=" \x3c/ul\x3e ",$(this).html(n))}else if(2===v.length){var x=LeoCdpAdmin.routerContext.dataObject[v[0]]||{};h=x[v[1]]||"";"html"===r?$(this).html(h):"date"===u?(h=moment.utc(h).local().format("YYYY-MM-DD"),$(this).html(h)):"date_time"===u?(h=moment.utc(h).local().format("YYYY-MM-DD HH:mm:ss"),$(this).html(h)):
"inputvalue"===r?$(this).val(h):"url"===r?$(this).html(checkToAddUrlValueToDOM(h)):"eventlocation"===r&&(q=$("\x3ca/\x3e").attr("href","javascript:").html(h).click(function(){var m=x.locationCode||"";m&&""!=m.trim()&&eModal.iframe("https://plus.codes/"+m,h)}),$(this).html(q))}else 3===v.length&&(x=LeoCdpAdmin.routerContext.dataObject[v[0]]||{},h=(x[v[1]]||{})[v[2]]||"","html"===r?$(this).html(h):"date"===u?(h=moment.utc(h).local().format("YYYY-MM-DD"),$(this).html(h)):"date_time"===u?(h=moment.utc(h).local().format("YYYY-MM-DD HH:mm:ss"),
$(this).html(h)):"inputvalue"===r?$(this).val(h):"url"===r?$(this).html(checkToAddUrlValueToDOM(h)):"eventlocation"===r&&(q=$("\x3ca/\x3e").attr("href","javascript:").html(h).click(function(){var m=x.locationCode||"";m&&""!=m.trim()&&eModal.iframe("https://plus.codes/"+m,h)}),$(this).html(q)))}).promise().done(function(){"function"===typeof f&&f()})}else LeoAdminApiUtil.logErrorPayload(g)})};
var updateProfileDataToModel=function(a,e,b){$("#data_model_holder").find("*[data-field]").each(function(){var c=$(this).data("field"),f=$(this).data("fieldholder"),k=$(this).data("fieldtype");f="html"===f?$(this).html().trim():$(this).val();"int"===k?f=parseInt(f.replace(/,/g,"")):"float"===k?f=parseFloat(f.replace(/,/g,"")):"date"===k?f=new Date(f):"tel"===k&&(f=f.replace(/\D/g,""));c=c.split(".");1===c.length?LeoCdpAdmin.routerContext.dataObject[c[0]]=f:2===c.length&&(LeoCdpAdmin.routerContext.dataObject[c[0]][c[1]]=
f)}).promise().done(function(){LeoAdminApiUtil.callPostAdminApi(a,e,function(c){0===c.httpCode&&""===c.errorMessage?"function"===typeof b&&b(c):LeoAdminApiUtil.logErrorPayload(c)})})};window.profileTimeseriesChart=!1;
var loadProfileEventDailyReportUnit=function(a,e){var b=getDateFilterValues();b.profileId=a;a=b.beginFilterDate;$("#eventDataFromDate").text((new moment(a)).format("YYYY-MM-DD HH:mm:ss"));a=b.endFilterDate;$("#eventDataToDate").text((new moment(a)).format("YYYY-MM-DD HH:mm:ss"));LeoAdminApiUtil.getSecuredData(baseLeoAdminUrl+"/cdp/analytics360/event-report/profile",b,function(c){0===c.httpCode&&""===c.errorMessage?!0===e&&"object"===typeof window.profileTimeseriesChart?renderTimeseriesChart("timeseriesProfileEventChart",
c.data,!0,profileTimeseriesChart,!0):window.profileTimeseriesChart=renderTimeseriesChart("timeseriesProfileEventChart",c.data,!1,!1,!0):LeoAdminApiUtil.logErrorPayload(c)})};function handleProfileTabBehavioralInfo(){$("#event_flow_tabs a:first").click();$("#event_flow_vertital_tabs div:first").addClass("active")}function handleProfileTabExtInfo(){$("#profile_ext_info_tabs a:first").click();$("#profile_ext_info_vertital_tabs div:first").addClass("active")}
var loadRecommendedContents=function(){LeoAdminApiUtil.getSecuredData("/cdp/profile/recommended-contents",{profileId:viewProfileId,startIndex:0,numberResult:systemConfig.leo_recommender.service_max_item_for_profile},function(a){var e=$("#recommended_content_list");a=a.data;0<a.length&&e.empty();_.forEach(a,function(b){var c=_.template($("#recommended-content-tpl").html());b.indexScore=e.find("\x3e div").length+1;b.updatedAt=moment.utc(b.updatedAt).local().format("YYYY-MM-DD HH:mm:ss");b=c(b);e.append(b)});
new Sortable(e[0],{swap:!0,swapClass:"sortable_highlighted_item",animation:150,onEnd:function(b){var c=b.newIndex,f=b.swapItem;b=$(b.item).data("key");f=$(f).data("key");var k=parseInt($("#rank_content_"+b).text());c+=1;$("#rank_content_"+b).text(c);$("#rank_content_"+f).text(k);var d={};$("#recommended_content_list span.rank_info").each(function(g){g=$(this).data("key");var l=parseInt($(this).text());d[g]=l;console.log(d)}).promise().done(function(){var g={rankingInfoList:JSON.stringify(d),graphName:"cdp_content_graph",
profileId:viewProfileId,recommendationModel:1};LeoAdminApiUtil.callPostAdminApi("/cdp/profile/update-item-ranking",g,function(l){l.data?iziToast.success({title:"Update Content Content Ranking",timeout:3E3,message:"Data is saved successfully!"}):LeoAdminApiUtil.logErrorPayload(l)})})}})})},loadRecommendedProducts=function(){LeoAdminApiUtil.getSecuredData("/cdp/profile/recommended-products",{profileId:viewProfileId,startIndex:0,numberResult:systemConfig.leo_recommender.service_max_item_for_profile},
function(a){var e=$("#recommended_product_list");a=a.data;0<a.length&&e.empty();_.forEach(a,function(b){if(b.product){var c=_.template($("#recommended-product-tpl").html());b.indexScore=e.find("\x3e div").length+1;b.updatedAt=moment.utc(b.updatedAt).local().format("YYYY-MM-DD HH:mm:ss");b=c(b);e.append(b)}});new Sortable(e[0],{swap:!0,swapClass:"sortable_highlighted_item",animation:150,onEnd:function(b){var c=b.newIndex,f=b.swapItem;b=$(b.item).data("key");f=$(f).data("key");var k=parseInt($("#rank_product_"+
b).text());c+=1;$("#rank_product_"+b).text(c);$("#rank_product_"+f).text(k);var d={};$("#recommended_product_list span.rank_info").each(function(g){g=$(this).data("key");var l=parseInt($(this).text());d[g]=l;console.log(d)}).promise().done(function(){var g={rankingInfoList:JSON.stringify(d),graphName:"cdp_product_graph",profileId:viewProfileId,recommendationModel:1};LeoAdminApiUtil.callPostAdminApi("/cdp/profile/update-item-ranking",g,function(l){l.data?iziToast.success({title:"Product Item Ranking",
timeout:2200,message:"Data is saved successfully!"}):LeoAdminApiUtil.logErrorPayload(l)})})}});$("input.autoselectall").on("click",function(){$(this).select()})})},loadPurchasedItems=function(){LeoAdminApiUtil.getSecuredData("/cdp/profile/get-purchased-items",{profileId:viewProfileId,startIndex:0,numberResult:100},function(a){var e=$("#purchased_items_list");a=a.data;0<a.length&&e.empty();_.forEach(a,function(b){var c=_.template($("#purchased-product-tpl").html());b.indexScore=e.find("\x3e div").length+
1;b.createdAt=moment.utc(b.createdAt).local().format("YYYY-MM-DD HH:mm:ss");b=c(b);e.append(b)})})},loadFinancialEventList=function(){var a=$("#financial_event_list"),e=LeoCdpAdmin.routerContext.dataObject.financeCreditEvents;0<e.length&&a.empty();_.forEach(e,function(b){var c=_.template($("#financial-event-tpl").html());"good"===b.risk?(b.riskIcon="fa-thumbs-o-up",b.riskIconColor="#45D50F"):(b.riskIcon="fa-thumbs-o-down",b.riskIconColor="#F40209");b.risk=b.risk.toUpperCase();b=c(b);a.append(b)})},
emptyInfo='\x3cbr\x3e \x3cdiv style\x3d"font-size:24px;" class\x3d"text-center" \x3e No data available \x3ci class\x3d"fa fa-exclamation" aria-hidden\x3d"true"\x3e\x3c/i\x3e \x3c/div\x3e \x3cbr\x3e',loadEventsInProfileIndex=0,loadEventsInProfileResult=25,loadEventsInProfile=function(a){$("#keywords_filter_events").val("");var e=$("#profile_activitiy_flow");0<e.find("li.all-loaded").length?console.log("Loaded all data for loadEventsInProfile"):(0===loadEventsInProfileIndex&&(e.empty().css("height",
"640px"),$("#keywords_filter_events").change(function(){2>$(this).val().trim().toLowerCase().length&&$("#profile_activitiy_flow li").show()})),$("#profile_activitiy_flow_loader").show(),LeoAdminApiUtil.getSecuredData("/cdp/profile/tracking-events",{id:viewProfileId,startIndex:loadEventsInProfileIndex,numberResult:loadEventsInProfileResult},function(b){$("#profile_activitiy_flow_loader").hide();0===b.data.length&&(0===loadEventsInProfileIndex?(e.html(emptyInfo),$("#profileEventStatistics").html(emptyInfo)):
(e.find("li:last-child").addClass("all-loaded"),$("#profile_activitiy_flow_done").show()));_.forEach(b.data,function(c){try{c.srcTouchpoint.name=textTruncate(decodeURI(c.srcTouchpoint.name),120);c.srcTouchpoint.truncatedUrl=textTruncate(c.srcTouchpoint.url,120);c.createdAt=moment.utc(c.createdAt).local().format("YYYY-MM-DD HH:mm:ss");0<_.size(c.eventData)?c.cssStyleDisplay="block":c.cssStyleDisplay="none";var f=c.metricName,k="view-event-tpl";if("item-view"===f||"survey-view"===f||"course-view"===
f||"content-view"===f)k="key-info-view-event-tpl";else if("purchase"===f||"subscribe"===f||"enroll"===f||"pay"===f)k="conversion-event-tpl";else if(0<=f.indexOf("click")||0<=f.indexOf("submit-")||0<=f.indexOf("play-")||0<=f.indexOf("-scan")||"order-checkout"===f||"add-to-cart"===f||"like"===f||"trial"===f||"user-login"===f)k="action-event-tpl";var d=_.template($("#"+k).html())(c);e.append(d)}catch(g){console.error(g)}});"function"===typeof a?a():$("#profile_activitiy_flow_container").height(e.height()+
50)}))};function loadMoreEventsInProfile(){loadEventsInProfileIndex=$("#profile_activitiy_flow \x3e li").length;loadEventsInProfile(function(){$(document).scrollTop($(document).height()-100);$("#profile_activitiy_flow_container").scrollTop($("#profile_activitiy_flow_container").prop("scrollHeight")+200)})}
var filterEventFlow=function(){var a=$("#keywords_filter_events").val().trim().toLowerCase(),e=$("#profile_activitiy_flow li");2<=a.length&&e.each(function(){0>$(this).find("h5.media-heading").text().toLowerCase().indexOf(a)?$(this).hide():$(this).show()})},loadFeedbacksInProfileIndex=0,loadFeedbacksInProfileResult=120;
function loadFeedbackEventsInProfile(){$("#keyword_filter_feedbacks").val("");var a=$("#profile_feedback_flow");0===loadEventsInProfileIndex&&(a.empty(),$("#keywords_filter_events").change(function(){2>$(this).val().trim().toLowerCase().length&&$("#profile_activitiy_flow li").show()}));$("#profile_feedback_flow_loader").show();LeoAdminApiUtil.getSecuredData("/cdp/profile/feedback-events",{id:viewProfileId,startIndex:loadFeedbacksInProfileIndex,numberResult:loadFeedbacksInProfileResult},function(e){$("#profile_feedback_flow_loader").hide();
e=e.data;0===e.length?a.html('\x3cli class\x3d"list-group-item view" \x3e \x3cdiv class\x3d"list-group-item" \x3e No data available \x3c/div\x3e \x3c/li\x3e'):(a.css("height","650px"),_.forEach(e,function(b,c){b.createdAt=moment.utc(b.createdAt).local().format("YYYY-MM-DD HH:mm:ss");c=baseLeoObserverUrl+"/webform?\x26tplfbt\x3dSURVEY\x26tplid\x3d"+b.refTemplateId;b.previewUrl="SURVEY"===b.feedbackType?c:b.touchpointUrl;c=b.eventName;b.eventIcon="submit-feedback-form"===c?"fa-commenting-o":"submit-rating-form"===
c?"fa-star":"fa-smile-o";c=_.template($("#feedback-event-tpl").html());a.append(c(b))}))});$("#keyword_filter_feedbacks").change(function(){2>$(this).val().trim().toLowerCase().length&&$("#profile_feedback_flow li").show()})}function filterFeedbackEvent(){var a=$("#keyword_filter_feedbacks").val().trim().toLowerCase(),e=$("#profile_feedback_flow li");2<=a.length&&e.each(function(){0>$(this).find("h5.media-heading").text().toLowerCase().indexOf(a)?$(this).hide():$(this).show()})}
function removeCurrentProfile(){var a=LeoCdpAdmin.routerContext.dataObject;a?0<Object.keys(a.eventStatistics).length&&1===a.status?notifyErrorMessage("The system can not delete a profile that has event data stream"):LeoCdpAdmin.navFunctions.removeCustomerProfile(a.id):notifyErrorMessage("LeoCdpAdmin.routerContext.dataObject is NULL !")}
function loadJourneyFlowReport(a,e){$("#journeyFlowChart").parent().hide();LeoAdminApiUtil.getSecuredData("/cdp/analytics360/journey-flow-report",{journeyMapId:e,profileId:a},function(b){if(0<b.errorCode)iziToast.error({title:"Data Journey Map",message:b.errorMessage});else{var c=b.data;b=c.defaultMetricName;var f=c.journeyStages,k=c.journeyLinks,d=c.journeyNodes;c=c.touchpointHubMap;$("#journeyFlowChart").parent().show();renderJourneyFlowChart("#journeyFlowChart",b,f,d,k,c)}})}
const renderProfileBarChart=function(a,e){if(e){var b=[],c=[];$.each(e,function(f,k){b.push(f);c.push(k)});renderHorizontalBarChart(a,b,c)}else $("#"+a).html("\x3ch4\x3e No data available \x3c/h4\x3e")},loadJourneyReportForProfile=function(a,e){var b={};$.each(e.eventStatistics,function(c,f){var k=c.indexOf("-");if(0>k)b.id_default_journey="object"===typeof b.id_default_journey?b.id_default_journey:{},b.id_default_journey[c]=f;else{var d=c.substring(0,k).trim();c=c.substring(k+1);b[d]="object"===
typeof b[d]?b[d]:{};b[d][c]=f}});renderProfileBarChart("profileEventStatsChart",b.id_default_journey);renderProfileBarChart("profileReferrerChannels",e.referrerChannels);loadJourneyMapList(!1,function(c,f){$("#profileJourneyName").text(f);$("#event_journey_funnel").empty();loadEventJourneyProfile(a,c);setTimeout(function(){loadTouchpointFlowForProfile(a,c)},2E3);renderProfileBarChart("profileEventStatsChart",b[c]);loadTouchpointHubReportForProfile(a,c)},!1,function(c,f){$("#profileJourneyName").text(f)});
loadEventJourneyProfile(a,"id_default_journey");setTimeout(function(){loadTouchpointHubReportForProfile(a,"id_default_journey")},800);setTimeout(function(){loadTouchpointFlowForProfile(a,"id_default_journey")},1600)},loadTouchpointHubReportForProfile=function(a,e){$("#profileObserverChart").html('\x3cdiv class\x3d"loader"\x3e\x3c/div\x3e');LeoAdminApiUtil.getSecuredData(baseLeoAdminUrl+"/cdp/analytics360/touchpoint-hub-report",{profileId:a,journeyMapId:e},function(b){if(0===b.httpCode&&""===b.errorMessage)if(b=
b.data,0<b.length){var c=[],f=[];b.forEach(function(k){c.push(k.name);f.push(k.eventCount)});renderHorizontalBarChart("profileObserverChart",c,f)}else $("#profileObserverChart").html("\x3ch4\x3e No data available \x3c/h4\x3e");else LeoAdminApiUtil.logErrorPayload(b)})},renderProfileTouchpointChart=function(a,e,b,c){$("#profileTouchpointChart").html('\x3cdiv class\x3d"loader"\x3e\x3c/div\x3e');LeoAdminApiUtil.getSecuredData(baseLeoAdminUrl+"/cdp/analytics360/touchpoint-report",{profileId:a,touchpointType:e,
startIndex:b,numberResult:c},function(f){if(0===f.httpCode&&""===f.errorMessage){f=f.data;var k=$("#engaged_touchpoint_list");if(0<f.length){k.empty();var d=[],g=[];f.forEach(function(l){var t=l.touchpoint,q=textTruncate(t.name,60);d.push(q);g.push(l.eventCount);q=_.template($("#engaged-touchpoint-tpl").html());t.updatedAt=moment.utc(t.updatedAt).local().format("YYYY-MM-DD HH:mm:ss");t.truncatedUrl=textTruncate(t.url,120);""===t.locationCode&&(t.cssShowLocationCode="none");t.eventCount=l.eventCount;
k.append(q(t))});renderHorizontalBarChart("profileTouchpointChart",d,g)}else $("#profileTouchpointChart").html("\x3ch4\x3e No data available \x3c/h4\x3e")}else LeoAdminApiUtil.logErrorPayload(f)})},loadEventJourneyProfile=function(a,e){var b=$("#event_journey_funnel").parent().width()-15;a={profileId:a,journeyMapId:e};e=baseLeoAdminUrl+"/cdp/analytics360/event-report/journey-profile";$("#event_journey_funnel_info").html('\x3cdiv class\x3d"loader"\x3e\x3c/div\x3e');LeoAdminApiUtil.getSecuredData(e,
a,function(c){if(0===c.httpCode&&""===c.errorMessage){var f=c.data.total,k=0,d=c.data.funnelIndex;c.data.scoreCX&&(k=c.data.scoreCX.sentimentScore);var g=$("#profileJourneyFunnel");90<=d?g.attr("class","progress-bar progress-bar-striped active progress-bar-danger"):50<=d&&90>d?g.attr("class","progress-bar progress-bar-striped active progress-bar-success"):g.attr("class","progress-bar progress-bar-striped active progress-bar-primary");$("#profileJourneySentimentScore").text(k);$("#profileJourneyFunnelValue").text(d);
g.attr("aria-valuenow",d).css("width",d+"%");$("#profile_funnel_report \x3e div").removeClass("funnel-stage-active");k=Math.floor(d/10);for(d=1;d<=k;d++)$("#profile_funnel_stage_"+d).addClass("funnel-stage-active");0==f?($("#event_journey_funnel_info").html("\x3cp\x3eNo data available\x3c/p\x3e").show(),$("#journeyFlowChart").hide()):($("#event_journey_funnel_info").empty().hide(),$("#journeyFlowChart").show(),(new FunnelGraph({container:"#event_journey_funnel",gradientDirection:"horizontal",data:{labels:journeyLabel5A,
subLabels:["Event Data Point"],colors:[["#9ACAEF","#67B0E9","#309EF3"]],values:c.data.reportData},displayPercent:!0,direction:"horizontal",width:b,height:330,subLabelValue:"raw"})).draw())}else LeoAdminApiUtil.logErrorPayload(c)})},loadTouchpointFlowForProfile=function(a,e){var b=$("#profileTouchpointFlow");a={profileId:a,journeyMapId:e,beginFilterDate:"",endFilterDate:""};e=baseLeoAdminUrl+"/cdp/analytics360/touchpoint-flow-report";b.html('\x3cdiv class\x3d"loader"\x3e\x3c/div\x3e');LeoAdminApiUtil.getSecuredData(e,
a,function(c){0===c.httpCode&&""===c.errorMessage?(b.empty(),renderDirectedGraph("profileTouchpointFlow",{nodes:c.data.nodes,edges:c.data.edges},c.data.rootNodeId)):LeoAdminApiUtil.logErrorPayload(c)})},profileInfoLoadProcessor=function(a){viewProfileId=a.id;a.fullName=""!==a.firstName||""!==a.lastName?a.firstName+" "+a.lastName:"Web Visitor";0>=a.age&&(a.age="-");""===a.livingLocation&&(a.livingLocation="_");""===a.primaryPhone&&(a.primaryPhone="-");""===a.firstName&&(a.firstName="-");""===a.lastName&&
(a.lastName="-");""===a.primaryEmail&&(a.primaryEmail="-");if("number"===typeof a.jobType){var e=a.jobType;a.jobTypeAsString=0===e?"UNSKILLED AND NON-RESIDENT":1===e?"UNSKILLED AND RESIDENT":2===e?"SKILLED":3===e?"HIGHLY SKILLED":"-"}a.funnelStage=a.funnelStage?a.funnelStage.toUpperCase():"-";a.lastTrackingEvent?(a.lastTrackingEvent.createdAt=moment.utc(a.lastTrackingEvent.createdAt).local().format("YYYY-MM-DD HH:mm:ss"),a.lastTrackingEvent.fingerprintId=a.lastTrackingEvent.fingerprintId?a.lastTrackingEvent.fingerprintId:
"-",a.lastTrackingEvent&&a.lastTrackingEvent.refTouchpoint&&(a.lastTrackingEvent.refTouchpoint.name=decodeURISafe(a.lastTrackingEvent.refTouchpoint.name))):a.lastTrackingEvent.createdAt="-";a.lastTouchpoint.name=decodeURI(a.lastTouchpoint.name);return a},loadProfileListByFilter=function(a,e,b,c){var f=[{data:"type"},{data:"firstName"},{data:"primaryEmail"},{data:"primaryPhone"},{data:"lastTouchpoint"},{data:"dataQualityScore"},{data:"totalLeadScore"},{data:"totalCLV"},{data:"updatedAt"},{data:"status"}],
k=getUserSession();return k?$(b).DataTable({lengthMenu:[[30,50,60],[30,50,60]],processing:!0,serverSide:!0,searching:!1,ordering:!0,serverMethod:"POST",ajax:{url:baseLeoAdminUrl+"/cdp/profiles/filter",contentType:"application/json",beforeSend:function(d){$(e).show();$(a).hide();d.setRequestHeader("leouss",k)},data:function(d){d=c(d);d.order.map(function(g){g.field=f[g.column]?f[g.column].data:""});return JSON.stringify(d)},dataSrc:function(d){canInsertData=d.canInsertData;canEditData=d.canEditData;
canDeleteData=d.canDeleteData;!1===canInsertData&&$("button.data-control-insert").attr("disabled","disabled");!1===canEditData&&$("button.data-control-update").attr("disabled","disabled");$(e).hide();$(a).show();return d.data}},columnDefs:[{render:function(d,g,l){return'\x3cdiv class\x3d"datatable_text text-center" style\x3d"color:#41A317!important;font-size:13px!important" \x3e'+getCheckedBoxIcon((""!=l.primaryEmail||""!=l.primaryPhone)&&0<d)+"\x3c/div\x3e"},targets:0,orderable:!1},{render:function(d,
g,l){d="Web Visitor";g="datatable_text no_contact";if(0<l.firstName.length||0<l.lastName.length)d=textTruncate(l.firstName+" "+l.lastName,30),g="has_contact";return'\x3ca class\x3d"'+g+'" title\x3d"Profile Report" href\x3d"#calljs-leoCdpRouter(\'Customer_Profile_Info\',\''+(l.id+"')\" \x3e")+d+"\x3c/a\x3e"},targets:1,orderable:!1},{render:function(d,g,l){return"string"===typeof d?'\x3cdiv class\x3d"datatable_text "\x3e\x3ca title\x3d"'+(d+"\" href\x3d\"#calljs-leoCdpRouter('Customer_Profile_Info','"+
(l.id+"')\" \x3e")+textTruncate(d,30)+"\x3c/a\x3e\x3c/div\x3e"):"-"},targets:2,orderable:!1},{render:function(d,g,l){return"string"===typeof d?'\x3cdiv class\x3d"datatable_text"\x3e\x3ca title\x3d"'+(d+"\" href\x3d\"#calljs-leoCdpRouter('Customer_Profile_Info','"+(l.id+"')\" \x3e")+textTruncate(d,30)+"\x3c/a\x3e\x3c/div\x3e"):"-"},targets:3,orderable:!1},{render:function(d,g,l){"object"!==typeof l.lastTouchpoint&&(l.lastTouchpoint={name:"No data"});return'\x3cdiv style\x3d"font-size:11.4px;" title\x3d"'+
l.lastTouchpoint.name+'"\x3e'+textTruncate(l.lastTouchpoint.name,50)+"\x3c/div\x3e"},targets:4,orderable:!1},{render:function(d,g,l){g=(new Number(d)).toLocaleString();return 100>=d?'\x3cdiv class\x3d"datatable_text text-center"\x3e'+g+" \x3c/div\x3e":100<d&&250>d?'\x3cdiv class\x3d"highlight_text text-center profile_medium_score" \x3e'+g+"\x3c/div\x3e":'\x3cdiv class\x3d"highlight_text text-center profile_high_score"  \x3e'+g+"\x3c/div\x3e"},targets:5},{render:function(d,g,l){g=(new Number(d)).toLocaleString();
return 20>d?'\x3cdiv class\x3d"datatable_text text-center"\x3e'+g+" \x3c/div\x3e":20<=d&&100>d?'\x3cdiv class\x3d"highlight_text text-center profile_medium_score" \x3e'+g+"\x3c/div\x3e":100<=d?'\x3cdiv class\x3d"highlight_text text-center profile_high_score" \x3e'+g+"\x3c/div\x3e":'\x3cdiv class\x3d"highlight_text text-center" style\x3d"color:#404040!important;font-size:0.8em!important" \x3e'+g+" \x3c/div\x3e"},targets:6},{render:function(d,g,l){g=(new Number(d)).toLocaleString();return 20>d?'\x3cdiv class\x3d"datatable_text text-center"\x3e'+
g+" \x3c/div\x3e":20<=d&&100>d?'\x3cdiv class\x3d"highlight_text text-center profile_medium_score" \x3e'+g+"\x3c/div\x3e":100<=d?'\x3cdiv class\x3d"highlight_text text-center profile_high_score" \x3e'+g+" \x3c/div\x3e":'\x3cdiv class\x3d"highlight_text text-center" style\x3d"color:#404040!important;font-size:0.8em!important" \x3e'+g+" \x3c/div\x3e"},targets:7},{render:function(d,g,l){return d?'\x3cdiv class\x3d"small text-center" style\x3d"color:#3300ff;width:74px" \x3e'+moment.utc(d).local().format("YYYY-MM-DD HH:mm:ss")+
"\x3c/div\x3e":"-"},targets:8},{render:function(d,g,l){g="ACTIVE";0===d?g="INACTIVE":-1===d?g="INVALID":-4===d&&(g="REMOVED");return'\x3cdiv class\x3d"small text-center" style\x3d"color:#3300ff!important" title\x3d"The profile status is '+g+'"\x3e'+g+"\x3c/div\x3e"},targets:9},{render:function(d,g,l){d='\x3ca class\x3d"control" title\x3d"Profile Report" href\x3d"#calljs-leoCdpRouter(\'Customer_Profile_Info\',\''+(l.id+'\')" \x3e \x3ci class\x3d"fa fa-info-circle" aria-hidden\x3d"true"\x3e\x3c/i\x3e View\x3c/a\x3e');
canEditData&&(d+=' \x3cbr\x3e\x3ca class\x3d"control" title\x3d"Profile Editor" href\x3d"#calljs-leoCdpRouter(\'Customer_Profile_Editor\',\''+(l.id+'\')" \x3e \x3ci class\x3d"fa fa-pencil-square-o" aria-hidden\x3d"true"\x3e\x3c/i\x3e Edit\x3c/a\x3e'));return d},targets:10}],columns:f,order:[[8,"desc"]]}):!1};