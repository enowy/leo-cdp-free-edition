'use strict';function profileAddNewTextHashSet(c){var e=$('\x3cli class\x3d"list-group-item" \x3e\x3cdiv class\x3d"row" \x3e\x3cdiv class\x3d"col-md-11" \x3e\x3cinput class\x3d"form-control" type\x3d"text" placeholder\x3d"Value" data-fieldholder\x3d"hashset" data-fieldtype\x3d"string" autocomplete\x3d"off"\x3e\x3c/div\x3e\x3cdiv class\x3d"col-md-1" \x3e\x3ch4 onclick\x3d"$(this).parent().parent().parent().remove()" \x3e\x3ci class\x3d"fa fa-times-circle delete-item-btn" aria-hidden\x3d"true"\x3e\x3c/i\x3e\x3c/h4\x3e \x3c/div\x3e\x3c/div\x3e\x3c/li\x3e');
$('p[data-field\x3d"'+c+'"] \x3e ul').append(e);e.effect("highlight",{},4E3)}function profileAddNewCustomField(c){var e=$(loadCustomFieldEditor(c,"",""));$('p[data-field\x3d"'+c+'"] \x3e ul').append(e);e.effect("highlight",{},4E3)}
var addNewHashMapItem=function(c,e){var a=c+"_"+(new Date).getTime(),b=$("#"+c),d=Object.assign({},e);b.find("option:selected").each(function(){var g=$(this).val();delete d[g]});c=$(loadHashMapSelector(a,c,d,"",""));b.find("ul.list-group").append(c);c.effect("highlight",{},4E3)};function removeHashMapItem(c){$(c).parent().parent().remove()}
function loadHashMapSelector(c,e,a,b,d){var g='\x3cdiv class\x3d"col-md-3" \x3e \x3cselect class\x3d"form-control" id\x3d"key_'+c+'" name\x3d"'+e+'" \x3e';_.forOwn(a,function(h,k){h='\x3coption name\x3d"'+e+'" value\x3d"'+k+'"\x3e '+k.toUpperCase()+" \x3c/option\x3e";k===b&&(h='\x3coption name\x3d"'+e+'" selected value\x3d"'+k+'"\x3e '+k.toUpperCase()+" \x3c/option\x3e");g+=h});g+=" \x3c/select\x3e \x3c/div\x3e";""===b&&$("#key_"+c).find("option:first").attr("selected","selected");return'\x3cli id\x3d"item_'+
c+'" class\x3d"list-group-item" \x3e\x3cdiv class\x3d"row" \x3e '+g+('\x3cdiv class\x3d"col-md-8" \x3e\x3cinput id\x3d"value_'+c+'" value\x3d"'+(d?d:"")+'" class\x3d"form-control" type\x3d"text" placeholder\x3d"Value" data-fieldholder\x3d"hashmap" data-fieldtype\x3d"string" autocomplete\x3d"off"\x3e\x3c/div\x3e\x3cdiv title\x3d"Delete" class\x3d"col-md-1" onclick\x3d"removeHashMapItem(this)" \x3e \x3ch4\x3e\x3ci class\x3d"fa fa-times-circle delete-item-btn" aria-hidden\x3d"true"\x3e\x3c/i\x3e\x3c/h4\x3e \x3c/div\x3e \x3c/div\x3e\x3c/li\x3e')}
function loadCustomFieldEditor(c,e,a){return'\x3cli class\x3d"list-group-item" \x3e\x3cdiv class\x3d"row" \x3e \x3cdiv class\x3d"col-md-3" \x3e \x3cinput type\x3d"text" class\x3d"form-control custom_field_name" placeholder\x3d"Field Name" value\x3d"'+(e+'"\x3e \x3c/div\x3e\x3cdiv class\x3d"col-md-8" \x3e\x3cinput class\x3d"form-control custom_field_value" type\x3d"text" value\x3d"')+((a?a:"")+'" placeholder\x3d"Field Value" data-fieldholder\x3d"hashmap" data-fieldtype\x3d"string" autocomplete\x3d"off"\x3e\x3c/div\x3e\x3cdiv title\x3d"Delete" class\x3d"col-md-1" onclick\x3d"removeHashMapItem(this)" \x3e \x3ch4\x3e\x3ci class\x3d"fa fa-times-circle delete-item-btn" aria-hidden\x3d"true"\x3e\x3c/i\x3e\x3c/h4\x3e \x3c/div\x3e \x3c/div\x3e\x3c/li\x3e')}
const loadProfileDataIntoDOM=function(c,e,a,b,d){var g=!1,h={};"string"===typeof e?(g="/cdp/profile/get",h.id=e):"string"===typeof a&&(g="/cdp/profile/get-by-crm-id",h.crmRefId=a);!1===g?(console.error("loadProfileDataIntoDOM is failed, profileId or crmRefId must be a valid string! "),console.log("urlStr "+g),console.log("params "+h)):LeoAdminApiUtil.callPostAdminApi(baseLeoAdminUrl+g,h,function(k){if(0===k.httpCode&&""===k.errorMessage){var r=k.canInsertData,t=k.canDeleteData;k.canEditData||$("button.data-control-edit").attr("disabled",
"disabled");t||$("button.data-control-delete").attr("disabled","disabled");r||$("button.data-control-insert").attr("disabled","disabled");LeoCdpAdmin.routerContext.dataObject="function"===typeof b?b(k.data):k.data;$("#data_model_holder").find("*[data-field]").each(function(){$(this).prop("tagName");var p=$(this).attr("type"),q=$(this).data("fieldholder"),u=$(this).data("fieldtype"),w=$(this).data("field"),v=w.split(".");if(1===v.length){var f=LeoCdpAdmin.routerContext.dataObject[v[0]];if("html"===
q){if("int"===u||"float"===u)if(void 0===f||null==f)f="-";else{if(f=(new Number(f)).toLocaleString(),NaN==f||"NaN"==f)f="-"}else"date"===u?f=f?moment.utc(f).local().format("YYYY-MM-DD"):"-":"date_time"===u?f=f?moment.utc(f).local().format("YYYY-MM-DD HH:mm:ss"):"-":"phone"===u&&(f=f?f.replace(/\D/g,""):"-");$(this).html(f)}else if("percentage"===q)$(this).html(f).parent().attr("aria-valuenow",f).css("width",f+"%"),p=$(this).parent(),p.attr("title",f+"% "+p.attr("title"));else if("url"===q)$(this).html(checkToAddUrlValueToDOM(f));
else if("locationcode"===q)p=$("\x3ca/\x3e").attr("href","javascript:").html(textTruncate(f,80)).click(function(){var l=LeoCdpAdmin.routerContext.dataObject.locationCode;0===l.indexOf("http")?eModal.iframe(l,"Location"):l&&""!=l.trim()&&eModal.iframe("https://plus.codes/"+l,f)}),$(this).html(p);else if("inputvalue"===q)"radio"===p||"checkbox"===p?f==$(this).val()&&$(this).attr("checked","checked"):$(this).val(f);else if("html_hashmap"===q){var m=' \x3cul class\x3d"list-group" \x3e ';_.forOwn(f,function(l,
n){n=n.trim();c?(l=loadHashMapSelector(w+"_"+n,w,"socialMediaProfiles"===w?SocialMediaIconMap:"personalContacts"===w?PersonalContactIconsMap:ContactIconsMap,n,l),m+=l):(n="socialMediaProfiles"===w?SocialMediaIconMap[n]?SocialMediaIconMap[n]:!1:"personalContacts"===w?PersonalContactIconsMap[n]?PersonalContactIconsMap[n]:!1:ContactIconsMap[n]?ContactIconsMap[n]:!1,!1===n&&(n=' \x3ci class\x3d"fa fa-info-circle" aria-hidden\x3d"true"\x3e\x3c/i\x3e '),m=m+'\x3cli class\x3d"list-group-item" \x3e '+n+checkToAddUrlValueToDOM(l)+
"\x3c/li\x3e")});m+=" \x3c/ul\x3e ";$(this).html(m)}else"html_hashset"===q?(m='\x3cul class\x3d"list-group" \x3e',_.forOwn(f,function(l,n){l=c?'\x3cdiv class\x3d"col-md-11" \x3e\x3cinput value\x3d"'+l+'" class\x3d"form-control" type\x3d"text" placeholder\x3d"Value" data-fieldholder\x3d"hashset" data-fieldtype\x3d"string" autocomplete\x3d"off"\x3e\x3c/div\x3e\x3cdiv class\x3d"col-md-1" \x3e\x3ch4 onclick\x3d"$(this).parent().parent().parent().remove()" \x3e\x3ci class\x3d"fa fa-times-circle delete-item-btn" aria-hidden\x3d"true"\x3e\x3c/i\x3e\x3c/h4\x3e\x3c/div\x3e':
"system_user"===u?' \x3cdiv class\x3d"col-md-12" \x3e \x3cb\x3e \x3ci class\x3d"fa fa-info-circle" aria-hidden\x3d"true"\x3e\x3c/i\x3e\x3c/b\x3e '+buildSystemUserInfoLink(l)+"\x3c/div\x3e":' \x3cdiv class\x3d"col-md-12" \x3e \x3cb\x3e \x3ci class\x3d"fa fa-info-circle" aria-hidden\x3d"true"\x3e\x3c/i\x3e\x3c/b\x3e '+checkToAddUrlValueToDOM(l)+"\x3c/div\x3e";m=m+'\x3cli class\x3d"list-group-item" \x3e \x3cdiv class\x3d"row" \x3e '+l+"\x3c/div\x3e\x3c/li\x3e"}),m+="\x3c/ul\x3e",$(this).html(m)):"html_list_key_value"===
q?(m='\x3cul class\x3d"list-group" \x3e',p=Object.keys(f),p.sort(),p.forEach(function(l){m=m+'\x3cli class\x3d"list-group-item" \x3e '+l+'  \x3ci class\x3d"fa fa-arrow-right" aria-hidden\x3d"true"\x3e\x3c/i\x3e  '+f[l]+"\x3c/li\x3e"}),m+="\x3c/ul\x3e",$(this).html(m)):"html_custom_field"===q&&(m=' \x3cul class\x3d"list-group" \x3e ',_.forOwn(f,function(l,n){n=n.trim();c?(l=loadCustomFieldEditor(w+"_"+n,n,l),m+=l):(m+='\x3cli class\x3d"list-group-item" \x3e',m+='\x3cdiv class\x3d"row" \x3e \x3cdiv class\x3d"col-md-3"\x3e \x3cb\x3e '+
n+'\x3c/b\x3e \x3ci  style\x3d"font-size:20px" class\x3d"fa fa-equals" aria-hidden\x3d"true"\x3e\x3c/i\x3e \x3c/div\x3e',m+='\x3cdiv class\x3d"col-md-9"\x3e'+l+"\x3c/div\x3e \x3c/div\x3e\x3c/li\x3e")}),m+=" \x3c/ul\x3e ",$(this).html(m))}else if(2===v.length){var x=LeoCdpAdmin.routerContext.dataObject[v[0]]||{};f=x[v[1]]||"";"html"===q?$(this).html(f):"date"===u?(f=moment.utc(f).local().format("YYYY-MM-DD"),$(this).html(f)):"date_time"===u?(f=moment.utc(f).local().format("YYYY-MM-DD HH:mm:ss"),$(this).html(f)):
"inputvalue"===q?$(this).val(f):"url"===q?$(this).html(checkToAddUrlValueToDOM(f)):"eventlocation"===q&&(p=$("\x3ca/\x3e").attr("href","javascript:").html(f).click(function(){var l=x.locationCode||"";l&&""!=l.trim()&&eModal.iframe("https://plus.codes/"+l,f)}),$(this).html(p))}else 3===v.length&&(x=LeoCdpAdmin.routerContext.dataObject[v[0]]||{},f=(x[v[1]]||{})[v[2]]||"","html"===q?$(this).html(f):"date"===u?(f=moment.utc(f).local().format("YYYY-MM-DD"),$(this).html(f)):"date_time"===u?(f=moment.utc(f).local().format("YYYY-MM-DD HH:mm:ss"),
$(this).html(f)):"inputvalue"===q?$(this).val(f):"url"===q?$(this).html(checkToAddUrlValueToDOM(f)):"eventlocation"===q&&(p=$("\x3ca/\x3e").attr("href","javascript:").html(f).click(function(){var l=x.locationCode||"";l&&""!=l.trim()&&eModal.iframe("https://plus.codes/"+l,f)}),$(this).html(p)))}).promise().done(function(){"function"===typeof d&&d()})}else LeoAdminApiUtil.logErrorPayload(k)})};
var updateProfileDataToModel=function(c,e,a){$("#data_model_holder").find("*[data-field]").each(function(){var b=$(this).data("field"),d=$(this).data("fieldholder"),g=$(this).data("fieldtype");d="html"===d?$(this).html().trim():$(this).val();"int"===g?d=parseInt(d.replace(/,/g,"")):"float"===g?d=parseFloat(d.replace(/,/g,"")):"date"===g?d=new Date(d):"tel"===g&&(d=d.replace(/\D/g,""));b=b.split(".");1===b.length?LeoCdpAdmin.routerContext.dataObject[b[0]]=d:2===b.length&&(LeoCdpAdmin.routerContext.dataObject[b[0]][b[1]]=
d)}).promise().done(function(){LeoAdminApiUtil.callPostAdminApi(c,e,function(b){0===b.httpCode&&""===b.errorMessage?"function"===typeof a&&a(b):LeoAdminApiUtil.logErrorPayload(b)})})};window.profileTimeseriesChart=!1;
var loadProfileEventDailyReportUnit=function(c,e){var a=getDateFilterValues();a.profileId=c;c=a.beginFilterDate;$("#eventDataFromDate").text((new moment(c)).format("YYYY-MM-DD HH:mm:ss"));c=a.endFilterDate;$("#eventDataToDate").text((new moment(c)).format("YYYY-MM-DD HH:mm:ss"));LeoAdminApiUtil.getSecuredData(baseLeoAdminUrl+"/cdp/analytics360/event-report/profile",a,function(b){0===b.httpCode&&""===b.errorMessage?!0===e&&"object"===typeof window.profileTimeseriesChart?renderTimeseriesChart("timeseriesProfileEventChart",
b.data,!0,profileTimeseriesChart,!0):window.profileTimeseriesChart=renderTimeseriesChart("timeseriesProfileEventChart",b.data,!1,!1,!0):LeoAdminApiUtil.logErrorPayload(b)})};function handleProfileTabBehavioralInfo(){$("#event_flow_tabs a:first").click();$("#event_flow_vertital_tabs div:first").addClass("active")}function handleProfileTabExtInfo(){$("#profile_ext_info_tabs a:first").click();$("#profile_ext_info_vertital_tabs div:first").addClass("active")}
var loadRecommendedContents=function(){LeoAdminApiUtil.getSecuredData("/cdp/profile/recommended-contents",{profileId:viewProfileId,startIndex:0,numberResult:systemConfig.leo_recommender.service_max_item_for_profile},function(c){var e=$("#recommended_content_list");c=c.data;0<c.length&&e.empty();_.forEach(c,function(a){var b=_.template($("#recommended-content-tpl").html());a.indexScore=e.find("\x3e div").length+1;a.updatedAt=moment.utc(a.updatedAt).local().format("YYYY-MM-DD HH:mm:ss");a=b(a);e.append(a)});
new Sortable(e[0],{swap:!0,swapClass:"sortable_highlighted_item",animation:150,onEnd:function(a){var b=a.newIndex,d=a.swapItem;a=$(a.item).data("key");d=$(d).data("key");var g=parseInt($("#rank_content_"+a).text());b+=1;$("#rank_content_"+a).text(b);$("#rank_content_"+d).text(g);var h={};$("#recommended_content_list span.rank_info").each(function(k){k=$(this).data("key");var r=parseInt($(this).text());h[k]=r;console.log(h)}).promise().done(function(){var k={rankingInfoList:JSON.stringify(h),graphName:"cdp_content_graph",
profileId:viewProfileId,recommendationModel:1};LeoAdminApiUtil.callPostAdminApi("/cdp/profile/update-item-ranking",k,function(r){r.data?iziToast.success({title:"Update Content Content Ranking",timeout:3E3,message:"Data is saved successfully!"}):LeoAdminApiUtil.logErrorPayload(r)})})}})})},loadRecommendedProducts=function(){LeoAdminApiUtil.getSecuredData("/cdp/profile/recommended-products",{profileId:viewProfileId,startIndex:0,numberResult:systemConfig.leo_recommender.service_max_item_for_profile},
function(c){var e=$("#recommended_product_list");c=c.data;0<c.length&&e.empty();_.forEach(c,function(a){if(a.product){var b=_.template($("#recommended-product-tpl").html());a.indexScore=e.find("\x3e div").length+1;a.updatedAt=moment.utc(a.updatedAt).local().format("YYYY-MM-DD HH:mm:ss");a=b(a);e.append(a)}});new Sortable(e[0],{swap:!0,swapClass:"sortable_highlighted_item",animation:150,onEnd:function(a){var b=a.newIndex,d=a.swapItem;a=$(a.item).data("key");d=$(d).data("key");var g=parseInt($("#rank_product_"+
a).text());b+=1;$("#rank_product_"+a).text(b);$("#rank_product_"+d).text(g);var h={};$("#recommended_product_list span.rank_info").each(function(k){k=$(this).data("key");var r=parseInt($(this).text());h[k]=r;console.log(h)}).promise().done(function(){var k={rankingInfoList:JSON.stringify(h),graphName:"cdp_product_graph",profileId:viewProfileId,recommendationModel:1};LeoAdminApiUtil.callPostAdminApi("/cdp/profile/update-item-ranking",k,function(r){r.data?iziToast.success({title:"Product Item Ranking",
timeout:2200,message:"Data is saved successfully!"}):LeoAdminApiUtil.logErrorPayload(r)})})}});$("input.autoselectall").on("click",function(){$(this).select()})})},loadPurchasedItems=function(){LeoAdminApiUtil.getSecuredData("/cdp/profile/get-purchased-items",{profileId:viewProfileId,startIndex:0,numberResult:100},function(c){var e=$("#purchased_items_list");c=c.data;0<c.length&&e.empty();_.forEach(c,function(a){var b=_.template($("#purchased-product-tpl").html());a.indexScore=e.find("\x3e div").length+
1;a.createdAt=moment.utc(a.createdAt).local().format("YYYY-MM-DD HH:mm:ss");a=b(a);e.append(a)})})},loadFinancialEventList=function(){var c=$("#financial_event_list"),e=LeoCdpAdmin.routerContext.dataObject.financeCreditEvents;0<e.length&&c.empty();_.forEach(e,function(a){var b=_.template($("#financial-event-tpl").html());"good"===a.risk?(a.riskIcon="fa-thumbs-o-up",a.riskIconColor="#45D50F"):(a.riskIcon="fa-thumbs-o-down",a.riskIconColor="#F40209");a.risk=a.risk.toUpperCase();a=b(a);c.append(a)})},
emptyInfo='\x3cbr\x3e \x3cdiv style\x3d"font-size:24px;" class\x3d"text-center" \x3e No data available \x3ci class\x3d"fa fa-exclamation" aria-hidden\x3d"true"\x3e\x3c/i\x3e \x3c/div\x3e \x3cbr\x3e',loadEventsInProfileIndex=0,loadEventsInProfileResult=25,loadEventsInProfile=function(c){$("#keywords_filter_events").val("");var e=$("#profile_activitiy_flow");0<e.find("li.all-loaded").length?console.log("Loaded all data for loadEventsInProfile"):(0===loadEventsInProfileIndex&&(e.empty().css("height",
"640px"),$("#keywords_filter_events").change(function(){2>$(this).val().trim().toLowerCase().length&&$("#profile_activitiy_flow li").show()})),$("#profile_activitiy_flow_loader").show(),LeoAdminApiUtil.getSecuredData("/cdp/profile/tracking-events",{id:viewProfileId,startIndex:loadEventsInProfileIndex,numberResult:loadEventsInProfileResult},function(a){$("#profile_activitiy_flow_loader").hide();0===a.data.length&&(0===loadEventsInProfileIndex?(e.html(emptyInfo),$("#profileEventStatistics").html(emptyInfo)):
(e.find("li:last-child").addClass("all-loaded"),$("#profile_activitiy_flow_done").show()));_.forEach(a.data,function(b){try{b.srcTouchpoint.name=textTruncate(decodeURI(b.srcTouchpoint.name),120);b.srcTouchpoint.truncatedUrl=textTruncate(b.srcTouchpoint.url,120);b.createdAt=moment.utc(b.createdAt).local().format("YYYY-MM-DD HH:mm:ss");0<_.size(b.eventData)?b.cssStyleDisplay="block":b.cssStyleDisplay="none";var d=b.metricName,g="view-event-tpl";if("item-view"===d||"survey-view"===d||"course-view"===
d||"content-view"===d)g="key-info-view-event-tpl";else if("purchase"===d||"subscribe"===d||"enroll"===d||"pay"===d)g="conversion-event-tpl";else if(0<=d.indexOf("click")||0<=d.indexOf("submit-")||0<=d.indexOf("play-")||0<=d.indexOf("-scan")||"order-checkout"===d||"add-to-cart"===d||"like"===d||"trial"===d||"user-login"===d)g="action-event-tpl";var h=_.template($("#"+g).html())(b);e.append(h)}catch(k){console.error(k)}});"function"===typeof c?c():$("#profile_activitiy_flow_container").height(e.height()+
50)}))};function loadMoreEventsInProfile(){loadEventsInProfileIndex=$("#profile_activitiy_flow \x3e li").length;loadEventsInProfile(function(){$(document).scrollTop($(document).height()-100);$("#profile_activitiy_flow_container").scrollTop($("#profile_activitiy_flow_container").prop("scrollHeight")+200)})}
var filterEventFlow=function(){var c=$("#keywords_filter_events").val().trim().toLowerCase(),e=$("#profile_activitiy_flow li");2<=c.length&&e.each(function(){0>$(this).find("h5.media-heading").text().toLowerCase().indexOf(c)?$(this).hide():$(this).show()})},loadFeedbacksInProfileIndex=0,loadFeedbacksInProfileResult=120;
function loadFeedbackEventsInProfile(){$("#keyword_filter_feedbacks").val("");var c=$("#profile_feedback_flow");0===loadEventsInProfileIndex&&(c.empty(),$("#keywords_filter_events").change(function(){2>$(this).val().trim().toLowerCase().length&&$("#profile_activitiy_flow li").show()}));$("#profile_feedback_flow_loader").show();LeoAdminApiUtil.getSecuredData("/cdp/profile/feedback-events",{id:viewProfileId,startIndex:loadFeedbacksInProfileIndex,numberResult:loadFeedbacksInProfileResult},function(e){$("#profile_feedback_flow_loader").hide();
e=e.data;0===e.length?c.html('\x3cli class\x3d"list-group-item view" \x3e \x3cdiv class\x3d"list-group-item" \x3e No data available \x3c/div\x3e \x3c/li\x3e'):(c.css("height","650px"),_.forEach(e,function(a,b){a.createdAt=moment.utc(a.createdAt).local().format("YYYY-MM-DD HH:mm:ss");b=baseLeoObserverUrl+"/webform?\x26tplfbt\x3dSURVEY\x26tplid\x3d"+a.refTemplateId;a.previewUrl="SURVEY"===a.feedbackType?b:a.touchpointUrl;b=a.eventName;a.eventIcon="submit-feedback-form"===b?"fa-commenting-o":"submit-rating-form"===
b?"fa-star":"fa-smile-o";b=_.template($("#feedback-event-tpl").html());c.append(b(a))}))});$("#keyword_filter_feedbacks").change(function(){2>$(this).val().trim().toLowerCase().length&&$("#profile_feedback_flow li").show()})}function filterFeedbackEvent(){var c=$("#keyword_filter_feedbacks").val().trim().toLowerCase(),e=$("#profile_feedback_flow li");2<=c.length&&e.each(function(){0>$(this).find("h5.media-heading").text().toLowerCase().indexOf(c)?$(this).hide():$(this).show()})}
var deleteCurrentProfile=function(){var c=LeoCdpAdmin.routerContext.dataObject;c?0<Object.keys(c.eventStatistics).length&&1===c.status?notifyErrorMessage("The system can not delete a profile that has event data stream"):LeoCdpAdmin.navFunctions.deleteCustomerProfile(c.id):notifyErrorMessage("LeoCdpAdmin.routerContext.dataObject is NULL !")},loadJourneyFlowReport=function(c,e){$("#journeyFlowChart").parent().hide();LeoAdminApiUtil.getSecuredData("/cdp/analytics360/journey-flow-report",{journeyMapId:e,
profileId:c},function(a){if(0<a.errorCode)iziToast.error({title:"Data Journey Map",message:a.errorMessage});else{var b=a.data;a=b.defaultMetricName;var d=b.journeyStages,g=b.journeyLinks,h=b.journeyNodes;b=b.touchpointHubMap;$("#journeyFlowChart").parent().show();renderJourneyFlowChart("#journeyFlowChart",a,d,h,g,b)}})};
const renderProfileBarChart=function(c,e){if(e){var a=[],b=[];$.each(e,function(d,g){a.push(d);b.push(g)});renderHorizontalBarChart(c,a,b)}else $("#"+c).html("\x3ch4\x3e No data available \x3c/h4\x3e")},reportJourneyOfSingleProfile=function(c,e){var a={};$.each(e.eventStatistics,function(b,d){var g=b.indexOf("-");if(0>g)a.id_default_journey="object"===typeof a.id_default_journey?a.id_default_journey:{},a.id_default_journey[b]=d;else{var h=b.substring(0,g).trim();b=b.substring(g+1);a[h]="object"===
typeof a[h]?a[h]:{};a[h][b]=d}});renderProfileBarChart("profileEventStatsChart",a.id_default_journey);renderProfileBarChart("profileReferrerChannels",e.referrerChannels);loadJourneyMapList(!1,function(b,d){$("#profileJourneyName").text(d);$("#event_journey_funnel").empty();loadEventJourneyProfile(c,b);setTimeout(function(){loadTouchpointFlowForProfile(c,b)},2E3);renderProfileBarChart("profileEventStatsChart",a[b]);renderProfileObserverChart(c,b)},!1,function(b,d){$("#profileJourneyName").text(d)});
loadEventJourneyProfile(c,"id_default_journey");setTimeout(function(){loadTouchpointFlowForProfile(c,"id_default_journey")},2E3);renderProfileObserverChart(c,"id_default_journey")},renderProfileObserverChart=function(c,e){$("#profileObserverChart").html('\x3cdiv class\x3d"loader"\x3e\x3c/div\x3e');LeoAdminApiUtil.getSecuredData(baseLeoAdminUrl+"/cdp/analytics360/observer-report",{profileId:c,journeyMapId:e},function(a){if(0===a.httpCode&&""===a.errorMessage)if(a=a.data,0<a.length){var b=[],d=[];a.forEach(function(g){b.push(g.name);
d.push(g.eventCount)});renderHorizontalBarChart("profileObserverChart",b,d)}else $("#profileObserverChart").html("\x3ch4\x3e No data available \x3c/h4\x3e");else LeoAdminApiUtil.logErrorPayload(a)})},renderProfileTouchpointChart=function(c,e,a,b){$("#profileTouchpointChart").html('\x3cdiv class\x3d"loader"\x3e\x3c/div\x3e');LeoAdminApiUtil.getSecuredData(baseLeoAdminUrl+"/cdp/analytics360/touchpoint-report",{profileId:c,touchpointType:e,startIndex:a,numberResult:b},function(d){if(0===d.httpCode&&
""===d.errorMessage){d=d.data;var g=$("#engaged_touchpoint_list");if(0<d.length){g.empty();var h=[],k=[];d.forEach(function(r){var t=r.touchpoint,p=textTruncate(t.name,60);h.push(p);k.push(r.eventCount);p=_.template($("#engaged-touchpoint-tpl").html());t.updatedAt=moment.utc(t.updatedAt).local().format("YYYY-MM-DD HH:mm:ss");t.truncatedUrl=textTruncate(t.url,120);""===t.locationCode&&(t.cssShowLocationCode="none");t.eventCount=r.eventCount;g.append(p(t))});renderHorizontalBarChart("profileTouchpointChart",
h,k)}else $("#profileTouchpointChart").html("\x3ch4\x3e No data available \x3c/h4\x3e")}else LeoAdminApiUtil.logErrorPayload(d)})},loadEventJourneyProfile=function(c,e){var a=$("#event_journey_funnel").parent().width()-15;LeoAdminApiUtil.getSecuredData(baseLeoAdminUrl+"/cdp/analytics360/event-report/journey-profile",{profileId:c,journeyMapId:e},function(b){if(0===b.httpCode&&""===b.errorMessage){var d=b.data.total,g=0,h=b.data.funnelIndex;b.data.scoreCX&&(g=b.data.scoreCX.sentimentScore);var k=$("#profileJourneyFunnel");
90<=h?k.attr("class","progress-bar progress-bar-striped active progress-bar-danger"):50<=h&&90>h?k.attr("class","progress-bar progress-bar-striped active progress-bar-success"):k.attr("class","progress-bar progress-bar-striped active progress-bar-primary");$("#profileJourneySentimentScore").text(g);$("#profileJourneyFunnelValue").text(h);k.attr("aria-valuenow",h).css("width",h+"%");$("#profile_funnel_report \x3e div").removeClass("funnel-stage-active");g=Math.floor(h/10);for(h=1;h<=g;h++)$("#profile_funnel_stage_"+
h).addClass("funnel-stage-active");0==d?($("#event_journey_funnel_nodata").show(),$("#journeyFlowChart").hide()):($("#event_journey_funnel_nodata").hide(),$("#journeyFlowChart").show(),(new FunnelGraph({container:"#event_journey_funnel",gradientDirection:"horizontal",data:{labels:journeyLabel5A,subLabels:["Event Data Point"],colors:[["#9ACAEF","#67B0E9","#309EF3"]],values:b.data.reportData},displayPercent:!0,direction:"horizontal",width:a,height:330,subLabelValue:"raw"})).draw())}else LeoAdminApiUtil.logErrorPayload(b)})},
loadTouchpointFlowForProfile=function(c,e){LeoAdminApiUtil.getSecuredData(baseLeoAdminUrl+"/cdp/analytics360/touchpoint-flow-report",{profileId:c,journeyMapId:e,beginFilterDate:"",endFilterDate:""},function(a){0===a.httpCode&&""===a.errorMessage?renderDirectedGraph("profileTouchpointFlow",{nodes:a.data.nodes,edges:a.data.edges},a.data.rootNodeId):LeoAdminApiUtil.logErrorPayload(a)})};