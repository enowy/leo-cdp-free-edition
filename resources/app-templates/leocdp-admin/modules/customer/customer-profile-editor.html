
<style>
	ol.profile_ext_data {
		margin-left: 28px;
	}
	div.delete-item-btn {
		font-size: 1.2em;
	}
</style>

<div class="row">
     <div class="col-md-6" >
 		<h5 class="page-header" id="page_breadcrumb" > </h5>
 	 </div> 
     <div class="col-lg-6 text-right" style="padding: 10px">
     	<button type="button" class="btn btn-info" onclick="history.back()" title="Go back"  > 
       		<i class="fa fa-arrow-circle-left" aria-hidden="true"></i> Back
       	</button>
       	<button type="button" class="btn btn-danger data-control-delete" onclick="deleteCurrentProfile()" title="Delete this profile" > 
     		<i class="fa fa-trash" aria-hidden="true"></i> Delete 
     	</button>
       	<button type="button" class="btn btn-success data-control-edit" onclick="saveProfileHandler()" title="Edit this profile"  > 
     		<i class="fa fa-check-square-o" aria-hidden="true"></i> Save 
     	</button>
     </div>
</div>

<div class="container-fluid" id="data_model_holder" >

       <!-- MAIN BODY here -->
       
       <div class="col-md-12">
      		<div class="col-md-7">
      			<!-- Avatar Data -->
	    		<div class="text-center" >
		            <img id="profile_avatar_img" style="display: none;" alt="Profile Avatar" class="rounded mx-auto d-block avatar">
		            <input id="profile_avatar_input" class="form-control" type="text" style="font-size: 12px" placeholder="Primary Avatar Image URL" data-field="primaryAvatar" data-fieldholder="inputvalue" data-fieldtype="string" autocomplete="off" >
		            <div style="width: 94%; margin: auto;" >
		           		<input id="profile_avatar_uploader" type="file" class="filepond" name="image" multiple data-max-file-size="2MB" data-max-files="1" />
		            </div>
	        	</div>
      		</div>
      		<div class="col-md-5">
      			<!-- Funnel Data -->
	        	<div>
		            <b>Current Funnel Stage </b> 
			  		<div class="progress" style="text-transform: uppercase;font-weight: bold;" >
					  	<div id="profileJourneyScore" class="progress-bar progress-bar-striped active" role="progressbar"
					  				aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width:0%" >
					    	<span data-field="journeyScore" data-fieldholder="html" data-fieldtype="int" >0</span> % funnel
					  	</div>
				   	</div>              	  
	        	</div>
      		
	        	<!-- Primary fields -->
	        	<div>
	        		<div class="primary_field" > 
	        			<b> <i class="fa fa-id-badge" aria-hidden="true"></i> Profile ID </b> 
	                	<span class="data_field" data-field="id" data-fieldholder="html" data-fieldtype="string" > - </span>
	                </div>
	                  
	                <div class="primary_field" >      	   
	                	<b> <i class="fa fa-id-badge" aria-hidden="true"></i> Web Visitor ID </b> 
	                	<span class="data_field" data-field="visitorId" data-fieldholder="html"  data-fieldtype="string" > - </span>
	                </div>
	                    
	                <div class="primary_field" >      	      
	                	<b> <i class="fa fa-id-badge" aria-hidden="true"></i> CRM User ID </b> 
	                	<input class="form-control" type="text" placeholder="CRM User ID" data-field="crmRefId" data-fieldholder="inputvalue" data-fieldtype="string" autocomplete="off" >
	                </div>
	                <hr>
	                
	                <div class="primary_field" > 
                    	<b> <i class="fa fa-clock-o" aria-hidden="true"></i> Created at </b> 
                    	<span class="data_field" data-field="createdAt" data-fieldholder="html"  data-fieldtype="date_time"  > - </span> 
                    </div>  
                    <div class="primary_field" >   
                    	<b> <i class="fa fa-clock-o" aria-hidden="true"></i> Updated at </b> 
                   		<span class="data_field" data-field="updatedAt" data-fieldholder="html"  data-fieldtype="date_time"  > -  </span> 
                    </div>
	                             
	        	</div>
      		</div>
       </div>
       <hr>

       <!--  Tab Navigation Items -->
       <ul class="nav nav-tabs" data-tab-content="profile_ext_data_tabs" >
       		<li class="active" >
       			<a href="javascript:" data-target-tab="panel_personal_info" > <i class="fa fa-user-circle-o" aria-hidden="true"></i> Identity Data</a>
       		</li>	
          	<li ><a href="javascript:" data-target-tab="panel_profile_contact" > <i class="fa fa-address-card-o" aria-hidden="true"></i> Contact Data </a></li>
          	<li ><a href="javascript:" data-target-tab="panel_profile_taxonomy" > <i class="fa fa-tags" aria-hidden="true"></i> Taxonomy </a></li>
          	<li ><a href="javascript:" data-target-tab="panel_profile_location" > <i class="fa fa-map-marker" aria-hidden="true"></i> Location Data</a></li>
          	<li ><a href="javascript:" data-target-tab="panel_profile_business" > <i class="fa fa-briefcase" aria-hidden="true"></i> Business Data</a></li>
          	<li ><a href="javascript:" data-target-tab="panel_profile_marketing" > <i class="fa fa-line-chart" aria-hidden="true"></i> Marketing Data </a></li>
          	<li ><a href="javascript:" data-target-tab="panel_profile_custom" > <i class="fa fa-table" aria-hidden="true"></i> Custom Data </a></li>
          	<li ><a href="javascript:" data-target-tab="panel_profile_data_authorization" > <i class="fa fa-lock" aria-hidden="true"></i> Data Authorization </a></li>
	   </ul>

	   <!-- Tab Contents  -->
       <div class="tab-content" id="profile_ext_data_tabs" >
       
       		<!-- tab 1 recommended items -->
			<div class="tab-pane active" id="panel_personal_info"  >
		     	
		     	<!--  Begin Profile Key Information -->
           	   	<h4 class="highlight_text" > <i class="fa fa-info-circle" aria-hidden="true"></i> Identity  </h4>
	           	<div class="col-md-12">
	               <table border=0 class="underlined" style="width: 100%;">
	                   <tr>
	                       <td>
	                           <ol id="personal_attributes" data-field="personal_attributes">
	                           	 	<li>
	                                  <b data-persona="key" > <i class="fa fa-fw fa-user-o"></i> Status </b> 
	                                  <div style="font-size: 12px;">
		                                   <div class="radio">
											  <label><input type="radio" name="status" value="1" data-field="status" data-fieldholder="inputvalue" data-fieldtype="int" >ACTIVE</label>
										   </div>
		                                   <div class="radio">
											  <label><input type="radio" name="status" value="0" data-field="status" data-fieldholder="inputvalue" data-fieldtype="int" >INACTIVE</label>
										   </div>
										   <div class="radio ">
											  <label><input type="radio" name="status" value="-1" data-field="status" data-fieldholder="inputvalue" data-fieldtype="int" >INVALID</label>
										   </div>
										   <div class="radio ">
											  <label><input type="radio" name="status" value="-4" data-field="status" data-fieldholder="inputvalue" data-fieldtype="int" >DELETED</label>
										   </div>
	                                   </div>
	                               </li>
	                              
	                           	   <li>
	                                   <b data-persona="key" > <i class="fa fa-fw fa-id-badge"></i> First Name </b> 
	                                   <input class="form-control" type="text" placeholder="First Name" data-field="firstName" data-fieldholder="inputvalue" data-fieldtype="string" autocomplete="off" >
	                               </li>
	                               
	                               <li>
	                                   <b data-persona="key" > <i class="fa fa-fw fa-id-badge"></i> Last Name </b> 
	                                   <input class="form-control" type="text" placeholder="Last Name" data-field="lastName" data-fieldholder="inputvalue" data-fieldtype="string" autocomplete="off" >
	                               </li>
	                               
	                               <li>
	                                   <b data-persona="key" > <i class="fa fa-fw fa-envelope"></i> Primary Email <span class="small_highlight_text">(Data for Identity Resolution)</span> </b> 
	                                   <input class="form-control" type="email" placeholder="Email" data-field="primaryEmail" data-fieldholder="inputvalue" data-fieldtype="string" autocomplete="off" >
	                               </li>
	                               
	                               <li>
	                                   <b data-persona="key" > <i class="fa fa-fw fa-phone-square"></i> Primary Mobile Phone <span class="small_highlight_text">(Data for Identity Resolution)</span> </b> 
	                                   <input class="form-control" type="tel" placeholder="Mobile Phone" data-field="primaryPhone" data-fieldholder="inputvalue" data-fieldtype="tel" autocomplete="off" >
	                               </li>
	                               
	                               <li class="personal_info" >
	                                   <b data-persona="key" > <i class="fa fa-fw fa-user-o"></i> Gender </b> 
	                                   <div class="radio">
										  <label><input type="radio" name="gender" value="0" data-field="gender" data-fieldholder="inputvalue" data-fieldtype="int" >Female</label>
									   </div>
	                                   <div class="radio">
										  <label><input type="radio" name="gender" value="1" data-field="gender" data-fieldholder="inputvalue" data-fieldtype="int" >Male</label>
									   </div>
									   <div class="radio ">
										  <label><input type="radio" name="gender" value="7" data-field="gender" data-fieldholder="inputvalue" data-fieldtype="int" >Unknown</label>
									   </div>
	                               </li>
	                               
	                               <li class="personal_info" >
	                                   <b data-persona="key"  > <i class="fa fa-fw fa-user-o"></i> Age </b> 
	                                   <input id='profileAge' readonly="readonly" class="form-control" type="number" placeholder="Age" data-field="age" data-fieldholder="inputvalue" data-fieldtype="int" autocomplete="false" >
	                               </li>
	                               
	                               <li class="personal_info" >
	                                  <b data-persona="key"  > <i class="fa fa-fw fa-user-o"></i> Date of Birth </b>      
									  <div class='input-group date' id='profileDateOfBirth' >
											<input type='text' class="form-control" autocomplete="off" /> 
											<span class="input-group-addon"> <span class="glyphicon glyphicon-calendar"></span> </span>
									  </div>
	       						   </li>
	                           </ol>
	                       </td>
	                   </tr>
	               </table>
	           </div>
	           <!--  End Profile Key Information -->
			</div>

			<!-- tab 2 Personal Extension Data  -->
			<div class="tab-pane" id="panel_profile_contact" >
				<h4 class="highlight_text" > <i class="fa fa-info-circle" aria-hidden="true"></i> Contacts </h4>
				<table border=0 class="underlined" style="width: 100%;">
                   <tr>
                       <td>
							<ol class="profile_ext_data" data-field="personal_attributes">
								<li>
				                   <b data-persona="key" > <i class="fa fa-fw fa-list"></i>  Secondary Emails <span class="small_highlight_text">(Data for Identity Resolution)</span> </b> 
				                   <button type="button" class="btn btn-do-now btn-xs" onclick="profileAddNewTextHashSet('secondaryEmails')" title="Add new email"  > 
				    					<i class="fa fa-plus-circle" aria-hidden="true"></i> New Email 
				    			   </button>
				                   <p data-field="secondaryEmails" data-fieldholder="html_hashset"  data-fieldtype="hashset" data-editable="true"  >  </p>
				               	</li>
				               	
				               	<li>
				                   <b data-persona="key" > <i class="fa fa-fw fa-list"></i> Secondary Phones <span class="small_highlight_text">(Data for Identity Resolution)</span> </b> 
				                   <button type="button" class="btn btn-do-now btn-xs" onclick="profileAddNewTextHashSet('secondaryPhones')" title="Add new phone"  > 
				    					<i class="fa fa-plus-circle" aria-hidden="true"></i> New Phone 
				    			   </button>
				                   <p data-field="secondaryPhones" data-fieldholder="html_hashset"  data-fieldtype="hashset" data-editable="true"  >  </p>
				               	</li>
				               	
				               	<li>
				                   <b data-persona="key" > <i class="fa fa-fw fa-list"></i> Citizen ID Number / Passport ID Number <span class="small_highlight_text">(Data for Identity Resolution)</span> </b> 
				                   <button type="button" class="btn btn-do-now btn-xs" onclick="profileAddNewTextHashSet('governmentIssuedIDs')"title="Add New ID Number"  > 
				    					<i class="fa fa-plus-circle" aria-hidden="true"></i> New ID Number
				    			   </button>
				                   <p data-field="governmentIssuedIDs" data-fieldholder="html_hashset" data-fieldtype="hashset" data-editable="true" > </p>
				               	</li>
							
								<li>
                                   <b data-persona="key" > <i class="fa fa-fw fa-users"></i> Social Media Profiles <span class="small_highlight_text">(Data for Identity Resolution)</span> </b> 
                                   <button type="button" class="btn btn-do-now btn-xs" onclick="addNewHashMapItem('socialMediaProfiles', SocialMediaIconMap)" title="Add new profile"  > 
				    					<i class="fa fa-plus-circle" aria-hidden="true"></i> New Profile 
				    			   </button>
                                   <p data-field="socialMediaProfiles" data-fieldholder="html_hashmap" data-fieldtype="hashmap" data-editable="true" id="socialMediaProfiles" > </p>
                                </li>
							    
                                <li>
				                   <b data-persona="key" > <i class="fa fa-fw fa-list"></i> Business Contacts <span class="small_highlight_text">(Data for Identity Resolution)</span> </b> 
				                   <button type="button" class="btn btn-do-now btn-xs" onclick="addNewHashMapItem('businessContacts', ContactIconsMap)" title="Add new"  > 
				    					<i class="fa fa-plus-circle" aria-hidden="true"></i> New Contact 
				    			   </button>
				                   <p data-field="businessContacts" data-fieldholder="html_hashmap" data-fieldtype="hashmap" data-editable="true" id="businessContacts" > </p>
				               	</li>
			               	</ol>
               	  		</td>
                   </tr>
               </table>
               
               
			</div>
			
			<!-- tab 3 Taxonomy  -->
			<div class="tab-pane" id="panel_profile_taxonomy" >
				<h4 class="highlight_text" > <i class="fa fa-info-circle" aria-hidden="true"></i> Taxonomy </h4>
					<table border=0 class="underlined" style="width: 100%;">
                   	<tr>
                       <td>
							<ol class="profile_ext_data" data-field="personal_attributes">
							
								 <li>
					                 <b data-persona="key" > <i class="fa fa-fw fa-list"></i> Data Labels </b> 
					                 <button type="button" class="btn btn-do-now btn-xs" onclick="profileAddNewTextHashSet('dataLabels')" title="Add new"  > 
					    					<i class="fa fa-plus-circle" aria-hidden="true"></i> New Value 
					    			 </button>
					                 <p data-field="dataLabels" data-fieldholder="html_hashset" data-fieldtype="hashset" data-editable="true" >  </p>
					             </li>
					               	
					              <li>
			                           <b> <i class="fa fa-id-card-o" aria-hidden="true"></i> Contact Type <span class="small_highlight_text">(Data for Identity Resolution)</span> </b>  <br>
		                               <div style="font-size: 13px; background-color: #fff;padding: 8px 25px;" >
		                                   	<div class="radio">
											  	<label><input type="radio" name="type" value="0" data-field="type" data-fieldholder="inputvalue" data-fieldtype="int" >ANONYMOUS_VISITOR</label>
										   	</div>
		                                   	<div class="radio">
											  	<label><input type="radio" name="type" value="1" data-field="type" data-fieldholder="inputvalue" data-fieldtype="int" >LOGIN_USER_CONTACT</label>
										   	</div>
										   	<div class="radio">
											  	<label><input type="radio" name="type" value="2" data-field="type" data-fieldholder="inputvalue" data-fieldtype="int" >CUSTOMER_CONTACT</label>
										   	</div>
										   	<div class="radio">
											  	<label><input type="radio" name="type" value="3" data-field="type" data-fieldholder="inputvalue" data-fieldtype="int" >STUDENT_CONTACT</label>
										   	</div>
										   	<div class="radio">
											  	<label><input type="radio" name="type" value="4" data-field="type" data-fieldholder="inputvalue" data-fieldtype="int" >CRM_IMPORTED_CONTACT</label>
										   	</div>
										   	<div class="radio">
											  	<label><input type="radio" name="type" value="5" data-field="type" data-fieldholder="inputvalue" data-fieldtype="int" >DIRECT_INPUT_CONTACT</label>
										   	</div>
										   	<div class="radio">
											  	<label><input type="radio" name="type" value="6" data-field="type" data-fieldholder="inputvalue" data-fieldtype="int" >INFLUENCER_CONTACT</label>
										   	</div>
										   	<div class="radio">
											  	<label><input type="radio" name="type" value="7" data-field="type" data-fieldholder="inputvalue" data-fieldtype="int" >CLIENT_CONTACT</label>
										   	</div>
										   	<div class="radio">
											  	<label><input type="radio" name="type" value="8" data-field="type" data-fieldholder="inputvalue" data-fieldtype="int" >B2B_PARTNER_CONTACT</label>
										   	</div>
										   	<div class="radio">
											  	<label><input type="radio" name="type" value="9" data-field="type" data-fieldholder="inputvalue" data-fieldtype="int" >EMPLOYEE_CONTACT</label>
										   	</div>
										   	<div class="radio">
											  	<label><input type="radio" name="type" value="10" data-field="type" data-fieldholder="inputvalue" data-fieldtype="int" >KEY_ACCOUNT_CONTACT</label>
										   	</div>
										   	<div class="radio">
											  	<label><input type="radio" name="type" value="11" data-field="type" data-fieldholder="inputvalue" data-fieldtype="int" >SYSTEM_USER_CONTACT</label>
										   	</div>
										</div>
	                              </li>
	             			</ol>
               	  		</td>
                   </tr>
                </table>
			</div>
			
			
			<!-- tab 5 Location  -->
			<div class="tab-pane" id="panel_profile_location" >
				<h4 class="highlight_text" > <i class="fa fa-info-circle" aria-hidden="true"></i> Living Location </h4>
				
			    <table border=0 class="underlined" style="width: 100%;">
                   <tr>
                       <td>
							<ol class="profile_ext_data" data-field="personal_attributes">
								<li class="personal_info" >
                                   	<b data-persona="key" > <i class="fa fa-fw fa-map-marker"></i> Living Location Address </b>
                                   	<input class="form-control" type="text" placeholder="Living Location Address" data-field="livingLocation" data-fieldholder="inputvalue" data-fieldtype="string" autocomplete="off">
                                </li>
	                            <li class="personal_info" > 
                                   	<b data-persona="key" > <i class="fa fa-fw fa-map-marker"></i> Living Location Code 
                                   		(<a id="locationCodeSearch" class="small_highlight_text" href="https://www.google.com/maps/?q=" target="_blank">Search the location code</a>)
                                   	</b>
                                   	<input class="form-control" type="text" placeholder="Living Location Code" data-field="locationCode" data-fieldholder="inputvalue" data-fieldtype="string" autocomplete="off">
	                            </li>
								<li>
	                                <b data-persona="key"> <i class="fa fa-fw fa-globe"></i> Primary Nationality  </b> 
	                                <input class="form-control" type="text" placeholder="Primary Nationality" data-field="primaryNationality" data-fieldholder="inputvalue" data-fieldtype="string" autocomplete="off" >
	                            </li>
	                            <li>
	                                <b data-persona="key" > <i class="fa fa-fw fa-globe"></i> Current Living City </b> 
	                                <input class="form-control" type="text" placeholder="Current Living City" data-field="livingCity" data-fieldholder="inputvalue" data-fieldtype="string" autocomplete="off" >
	                            </li>
	                            <li>
	                                <b data-persona="key" > <i class="fa fa-fw fa-globe"></i> Current Living State </b> 
	                                <input class="form-control" type="text" placeholder="Current Living State" data-field="livingState" data-fieldholder="inputvalue" data-fieldtype="string" autocomplete="off" >
	                            </li>
	                            <li>
	                                <b data-persona="key" > <i class="fa fa-fw fa-globe"></i> Current Living Country </b> 
	                                <input class="form-control" type="text" placeholder="Current Living Country" data-field="livingCountry" data-fieldholder="inputvalue" data-fieldtype="string" autocomplete="off" >
	                            </li>
	                            <li>
	                                <b data-persona="key" > <i class="fa fa-fw fa-globe"></i> Current ZipCode </b> 
	                                <input class="form-control" type="text" placeholder="Current ZipCode" data-field="currentZipCode" data-fieldholder="inputvalue" data-fieldtype="string" autocomplete="off" >
	                            </li>							
							</ol>
						</td>
					</tr>
				</table>
			</div>
			
			<!-- tab 5 Business  -->
			<div class="tab-pane" id="panel_profile_business" >
				<h4 class="highlight_text" > <i class="fa fa-info-circle" aria-hidden="true"></i> Business </h4>
				
			    <table border=0 class="underlined" style="width: 100%;">
                   <tr>
                       <td>
							<ol class="profile_ext_data" data-field="personal_attributes">
				               	<li>
				                   <b data-persona="key" > <i class="fa fa-fw fa-list"></i> Soft Skills </b> 
				                   <button type="button" class="btn btn-do-now btn-xs" onclick="profileAddNewTextHashSet('softSkills')" title="Add new"  > 
				    					<i class="fa fa-plus-circle" aria-hidden="true"></i> New Value 
				    			   </button>
				                   <p data-field="softSkills" data-fieldholder="html_hashset"  data-fieldtype="hashset" data-editable="true"  >  </p>
				               	</li>
				               	
				               	<li>
				                   <b data-persona="key" > <i class="fa fa-fw fa-list"></i> Learning History </b> 
				                   <button type="button" class="btn btn-do-now btn-xs" onclick="profileAddNewTextHashSet('learningHistory')" title="Add new"  > 
				    					<i class="fa fa-plus-circle" aria-hidden="true"></i> New Value 
				    			   </button>
				                   <p data-field="learningHistory" data-fieldholder="html_hashset"  data-fieldtype="hashset" data-editable="true"  >  </p>
				               	</li>
				               	
				               	<li>
				                   <b data-persona="key" >  <i class="fa fa-fw fa-list"></i> Study Certificates </b> 
				                   <button type="button" class="btn btn-do-now btn-xs" onclick="profileAddNewTextHashSet('studyCertificates')" title="Add new"  > 
				    					<i class="fa fa-plus-circle" aria-hidden="true"></i> New Value 
				    			   </button>
				                   <p data-field="studyCertificates" data-fieldholder="html_hashset"  data-fieldtype="hashset"  data-editable="true" >  </p>
				               	</li>
				               	
				               	<li>
				                   <b data-persona="key" > <i class="fa fa-fw fa-list"></i> Job Titles </b> 
				                   <button type="button" class="btn btn-do-now btn-xs" onclick="profileAddNewTextHashSet('jobTitles')" title="Add new"  > 
				    					<i class="fa fa-plus-circle" aria-hidden="true"></i> New Value 
				    			   </button>
				                   <p data-field="jobTitles" data-fieldholder="html_hashset"  data-fieldtype="hashset" data-editable="true"  >  </p>
				               	</li>
				               	
				               	<li>
				                   <b data-persona="key" > <i class="fa fa-fw fa-list"></i> Working History </b> 
				                   <button type="button" class="btn btn-do-now btn-xs" onclick="profileAddNewTextHashSet('workingHistory')" title="Add new"  > 
				    					<i class="fa fa-plus-circle" aria-hidden="true"></i> New Value 
				    			   </button>
				                   <p data-field="workingHistory" data-fieldholder="html_hashset"  data-fieldtype="hashset" data-editable="true"  >  </p>
				               	</li>
				               	
				               	<li>
				                   <b data-persona="key" >  <i class="fa fa-fw fa-list"></i> Experience in Business Industries </b> 
				                   <button type="button" class="btn btn-do-now btn-xs" onclick="profileAddNewTextHashSet('businessIndustries')" title="Add new"  > 
				    					<i class="fa fa-plus-circle" aria-hidden="true"></i> New Value 
				    			   </button>
				                   <p data-field="businessIndustries" data-fieldholder="html_hashset"  data-fieldtype="hashset" data-editable="true" >  </p>
				               	</li>
			               	</ol>
               	  		</td>
                   </tr>
                </table>
               
			</div>
			
			<!-- tab 6 Marketing  -->
			<div class="tab-pane" id="panel_profile_marketing" >
				<h4 class="highlight_text" > <i class="fa fa-info-circle" aria-hidden="true"></i> Marketing Data </h4>
				<table border=0 class="underlined" style="width: 100%;">
                   <tr>
                       <td>
							<ol class="profile_ext_data" data-field="personal_attributes">

                                <li>
				                   <b data-persona="key" > <i class="fa fa-fw fa-list"></i> Content Marketing Keywords </b> 
				                   <button type="button" class="btn btn-do-now btn-xs" onclick="profileAddNewTextHashSet('contentKeywords')" title="Add new"  > 
				    					<i class="fa fa-plus-circle" aria-hidden="true"></i> New Value 
				    			   </button>
				                   <p data-field="contentKeywords" data-fieldholder="html_hashset"  data-fieldtype="hashset" data-editable="true" >  </p>
				               	</li>
				               	
				               	<li>
				                   <b data-persona="key" > <i class="fa fa-fw fa-list"></i> Product Marketing Keywords </b> 
				                   <button type="button" class="btn btn-do-now btn-xs" onclick="profileAddNewTextHashSet('productKeywords')" title="Add new"  > 
				    					<i class="fa fa-plus-circle" aria-hidden="true"></i> New Value 
				    			   </button>
				                   <p data-field="productKeywords" data-fieldholder="html_hashset"  data-fieldtype="hashset" data-editable="true" >  </p>
				               	</li>
				               
				                <li>
				                   <b data-persona="key" > <i class="fa fa-fw fa-list"></i> Personal Interests </b> 
				                   <button type="button" class="btn btn-do-now btn-xs" onclick="profileAddNewTextHashSet('personalInterests')" title="Add new"  > 
				    					<i class="fa fa-plus-circle" aria-hidden="true"></i> New Value 
				    			   </button>
				                   <p data-field="personalInterests" data-fieldholder="html_hashset"  data-fieldtype="hashset" data-editable="true" >  </p>
				               	</li>
				               	
				               	<li>
				                   <b data-persona="key" > <i class="fa fa-fw fa-list"></i> Reachable Media Channels </b> 
				                   <button type="button" class="btn btn-do-now btn-xs" onclick="profileAddNewTextHashSet('mediaChannels')" title="Add new"  > 
				    					<i class="fa fa-plus-circle" aria-hidden="true"></i> New Value 
				    			   </button>
				                   <p data-field="mediaChannels" data-fieldholder="html_hashset"  data-fieldtype="hashset" data-editable="true"  >  </p>
				               	</li>
				               	
				               	<li>
				                   <b data-persona="key" >  <i class="fa fa-fw fa-list"></i> Personal Problems or Pain-points </b> 
				                   <button type="button" class="btn btn-do-now btn-xs" onclick="profileAddNewTextHashSet('personalProblems')" title="Add new"  > 
				    					<i class="fa fa-plus-circle" aria-hidden="true"></i> New Value 
				    			   </button>
				                   <p data-field="personalProblems" data-fieldholder="html_hashset"  data-fieldtype="hashset" data-editable="true" >  </p>
				               	</li>
				               	
				               	<li>
				                   <b data-persona="key" >  <i class="fa fa-fw fa-list"></i> Solutions for Customer </b> 
				                   <button type="button" class="btn btn-do-now btn-xs" onclick="profileAddNewTextHashSet('solutionsForCustomer')" title="Add new"  > 
				    					<i class="fa fa-plus-circle" aria-hidden="true"></i> New Value 
				    			   </button>
				                   <p data-field="solutionsForCustomer" data-fieldholder="html_hashset"  data-fieldtype="hashset" data-editable="true" >  </p>
				               	</li>
				               	
				               	<li>
				                   <b data-persona="key" >  <i class="fa fa-fw fa-list"></i> Next Best Actions </b> 
				                   <button type="button" class="btn btn-do-now btn-xs" onclick="profileAddNewTextHashSet('nextBestActions')" title="Add new"  > 
				    					<i class="fa fa-plus-circle" aria-hidden="true"></i> New Value 
				    			   </button>
				                   <p data-field="nextBestActions" data-fieldholder="html_hashset"  data-fieldtype="hashset" data-editable="true" >  </p>
				               	</li>
			               	</ol>
               	  		</td>
                   </tr>
               </table>
			</div>
			
			
			<!-- tab 6 Custom  -->
			<div class="tab-pane" id="panel_profile_custom" >
				<h4 class="highlight_text" > <i class="fa fa-info-circle" aria-hidden="true"></i> Custom Data Fields </h4>
				<div class="col-md-12">
					<button type="button" class="btn btn-do-now btn-sm" onclick="profileAddNewCustomField('extAttributes')" title="Add new custom field"  > 
    					<i class="fa fa-plus-circle" aria-hidden="true"></i> New Custom Data Field 
    				</button>
				</div>
				<div class="col-md-12" >
					<div class="col-md-3" > <h5>Field Name</h5> </div>
			    	<div class="col-md-9" > <h5>Field Value</h5> </div>
				</div>
			    <div class="col-md-12" style="padding: 4px 8px; background-color: #f6f6f6; border-radius: 8px" >
					<p id="profile_extAttributes" data-field="extAttributes" data-fieldholder="html_custom_field" data-fieldtype="custom_field" data-editable="true" > 
						-
					</p>
                </div>
			</div>
			
			<!-- tab 7 Data Authorization  -->
			<div class="tab-pane" id="panel_profile_data_authorization" >
				<h4 class="highlight_text" > <i class="fa fa-lock" aria-hidden="true"></i> Data Authorization </h4>
				<table border=0 class="underlined" style="width: 100%;">
                   <tr>
                       <td>
							<ol class="profile_ext_data" data-field="personal_attributes">

                                <li>
				                   <b data-persona="key" > <i class="fa fa-fw fa-list"></i> Authorized Viewers </b> 
				                   <button type="button" class="btn btn-do-now btn-xs" onclick="profileAddNewTextHashSet('authorizedViewers')" title="Add Username"  > 
				    					<i class="fa fa-plus-circle" aria-hidden="true"></i> New Viewer 
				    			   </button>
				                   <p data-field="authorizedViewers" data-fieldholder="html_hashset"  data-fieldtype="hashset" data-editable="true" >  </p>
				               	</li>
				               	
				               	<li>
				                   <b data-persona="key" > <i class="fa fa-fw fa-list"></i>  Authorized Editors </b> 
				                   <button type="button" class="btn btn-do-now btn-xs" onclick="profileAddNewTextHashSet('authorizedEditors')" title="Add Username"  > 
				    					<i class="fa fa-plus-circle" aria-hidden="true"></i> New Editor 
				    			   </button>
				                   <p data-field="authorizedEditors" data-fieldholder="html_hashset"  data-fieldtype="hashset" data-editable="true" >  </p>
				               	</li>
				               
			               	</ol>
               	  		</td>
                   </tr>
               </table>
			</div>
			
	   </div>
      
       <div class="line"></div>

</div>

<script type="text/javascript">
    ///Js code
   
    var editedProfileModel = '';
    var initProfileEditor = function(profileId) {
    	//setup editable node
		setupTabPanels();
		loadProfileData(profileId);
    }
    
    var saveProfileHandler = function () {
    	iziToast.info({
    	    title: 'Profile Editor',
    	    message: 'System is processing ...',
    	    timeout: 2000,
    	});
    	updateEditedProfileModel();
    	var callback = function(rs){
    		if(rs != null){
    			location.hash = "calljs-leoCdpRouter('Customer_Profile_Info','" + rs + "')";
    			iziToast.success({
    	    	    title: 'Profile Editor',
    	    	    message: 'Profile data is saved OK!',
    	    	    timeout: 3000,
    	    	});
    		}
    		else {
    			console.error('saveProfileHandler ', rs)
    		}
    	};
    	var params = {'objectJson' : JSON.stringify(editedProfileModel) };
    	LeoAdminApiUtil.callPostAdminApi('/cdp/profile/update', params, function (json) {
            if (json.httpCode === 0 && json.errorMessage === '') {
    			callback(json.data);
            } else {
                LeoAdminApiUtil.logErrorPayload(json);
            }
       	}, callback);
    }
    
    var deleteCurrentProfile = function (){
    	var profile = LeoCdpAdmin.routerContext.dataObject;
    	var canNotDelete = Object.keys(profile.eventStatistics).length > 0 && profile.status === 1;
    	if(canNotDelete) {
    		notifyErrorMessage("The system can not delete a profile that has event data stream");
    	} else {
    		LeoCdpAdmin.navFunctions.deleteCustomerProfile(viewProfileId);	
    	}
    }
    
    var formatSelectionList = function(selector) {
    	$(selector + ":checked").parent().addClass('data_field');
    	$(selector).click(function(){
			$(selector).parent().removeClass('data_field');
			$(this).parent().addClass('data_field');
    	});
    }
    
    var loadProfileData = function (profileId) {
         console.log('loadProfileData profileId ' + profileId);
         
         var dataProcessor = function(data){
        	var formatDateTime = 'YYYY-MM-DD';
        	var dateOfBirth = false;
        	if(data.dateOfBirth) {
        		dateOfBirth = data.dateOfBirth;
        	} else {
        		dateOfBirth = new moment().subtract(data.age, "years").toDate();
        	}
    		$('#profileDateOfBirth').datetimepicker({
    	        useCurrent: false, 
    	        format: formatDateTime,
    	        defaultDate: moment.utc(dateOfBirth).local().format('YYYY-MM-DD')
    	    }).on('dp.change', function(e){ 
    	        var age = moment().diff(e.date, 'years');
    	        $('#profileAge').val(age);
    	    });
    		

        	return data;
         }
         
         loadProfileDataIntoDOM(true, profileId, false, dataProcessor, function(){
        	 //console.log(LeoCdpAdmin.routerContext.dataObject);
        	 editedProfileModel = LeoCdpAdmin.routerContext.dataObject;
        	 // avatar
        	 initProfileAvatarUploader(editedProfileModel);
        	 
        	 // Journey Data Funnel : journey percentage 
         	 var journeyScoreNode = $('#profileJourneyScore');
        	 var journeyScore = editedProfileModel.journeyScore;
         	 journeyScoreNode.attr('aria-valuenow', journeyScore).css('width', journeyScore+'%');
	       	 if(journeyScore > 90) {
	       		 journeyScoreNode.addClass("progress-bar-danger");
	       	 }
	       	 else if(journeyScore >= 50 && journeyScore < 90) {
	       		 journeyScoreNode.addClass("progress-bar-success");
	       	 }
	       	 else {
	       		 journeyScoreNode.addClass("progress-bar-info");
	       	 }
         	 
         	 // profile type
         	 formatSelectionList('input[name="type"]')
         	 
         	 // profile status
         	 formatSelectionList('input[name="status"]')
         	 
         	 // profile gender
         	 formatSelectionList('input[name="gender"]')
         	 
         	 // set search link
         	 if(typeof editedProfileModel.livingLocation === "string") {
         		$('#locationCodeSearch').attr("href", 'https://www.google.com/maps/?q=' +  editedProfileModel.livingLocation);
         	 }
         	 
     		 $('#panel_profile_location').find('input[data-field="locationCode"]').change(function(){
   				var newValue = $(this).val();
   				// remove iframe tag in Google Map embedded HTML Code
   				if( newValue.indexOf("<iframe") >= 0 ) {
   					newValue = $(newValue).attr("src");
   					$(this).val(newValue);
   				}
   			 });
    		
    		 $('#panel_profile_location').find('input[data-field="livingLocation"]').change(function(){ 
    			// set new search link
    			var newVal = encodeURIComponent($(this).val()) ;
    			$('#locationCodeSearch').attr("href", 'https://www.google.com/maps/?q=' +  newVal);
    		 })
         });
    }
    
    var updateEditedProfileModel = function() {
    	var dataDomHolder = $('#data_model_holder');
    	dataDomHolder.find('input[data-field][type="radio"]:checked').each(function(){ 
    		var field = $(this).data('field'); 
    		var fieldtype = $(this).data('fieldtype'); 
    		var val = $(this).val();
    		
    		if(fieldtype === 'int'){
    			val = parseInt(val);
    		} else if(fieldtype === 'float'){
    			val = parseFloat(val);
    		}
    		
    		editedProfileModel[field] = val;
    	});
    	dataDomHolder.find('input[data-field][type="text"],input[data-field][type="email"]').each(function(){ 
    		var field = $(this).data('field'); 
    		var val = $(this).val();
    		editedProfileModel[field] = val;
    	});
    	dataDomHolder.find('input[data-field][type="tel"]').each(function(){ 
    		var field = $(this).data('field'); 
    		var val = $(this).val().replace(/\D/g,'');
    		editedProfileModel[field] = val;
    	});
    	dataDomHolder.find('input[data-field][type="number"]').each(function(){ 
    		var field = $(this).data('field'); 
    		var fieldtype = $(this).data('fieldtype'); 
    		var val = $(this).val();
    		if(fieldtype === 'int'){
    			val = parseInt(val);
    		} else if(fieldtype === 'float'){
    			val = parseFloat(val);
    		}
    		editedProfileModel[field] = val;
    	});
    	dataDomHolder.find('p[data-field][data-editable]').each(function(){ 
    		var pfield = $(this).data('field');  
    		var pfieldtype = $(this).data('fieldtype'); 
    		 
    		if(pfieldtype === 'hashset') {
    			var list = [];
    			$(this).find('input[type="text"]').each(function(){
    				var fieldtype = $(this).data('fieldtype'); 
    				var val = $(this).val();
    				if(fieldtype === 'int'){
    	    			val = parseInt(val);
    	    		} else if(fieldtype === 'float'){
    	    			val = parseFloat(val);
    	    		}
    				if(val.trim() !== ''){
    					list.push(val);
    				}
    				console.log(val);
    			})
    			editedProfileModel[pfield] = list;
    		}
    		else if(pfieldtype === 'hashmap') {
    			var map = {};
    			var nodes = $('#'+ pfield).find('li');
    			nodes.each(function(){
    				var key = $(this).find('select').val(); 
    				var value = $(this).find('input').val(); 
    				if(key.trim() != '' && value.trim() != ''){
    					map[key] = value;
    				}
    			});
    			editedProfileModel[pfield] = map;
    		}
    		else if(pfieldtype === "custom_field" ) {
    			var map = {};
    			var nodes = $(this).find('li');
    			nodes.each(function(){
    				var fieldName = $(this).find("input.custom_field_name").val().trim();
    				var fieldValue = $(this).find("input.custom_field_value").val().trim();
    				if(fieldName !== ''){
    					map[fieldName] = fieldValue;
    				}
    			});
    			editedProfileModel[pfield] = map;
    		}
    	});
    	
    	var dob = new moment.utc( $('#profileDateOfBirth').data("DateTimePicker").date() );
    	editedProfileModel.dateOfBirth = dob;
    	console.log(editedProfileModel);
    }
    
    var initProfileAvatarUploader = function (profileData) {
    	
    	var defaultAvatarUrl = baseLeoAdminUrl + '/public/images/avatars/profile-default-avatar.png';
    	var avatarUrl = '';
    	if(profileData.primaryAvatar === ''){
    		 avatarUrl = defaultAvatarUrl;
    	}
    	else {
    		 avatarUrl = profileData.primaryAvatar;
    	}
    	
    	$('#profile_avatar_img').attr('src', avatarUrl);
    	$('#profile_avatar_input').val(avatarUrl);
    	$('#profile_avatar_img').show();
    	
		//headline image uploader
		var refObjectClass = 'profile';
		var refObjectKey = 'avatar-'+ profileData.id;
		
        setupUploaderWidget(refObjectClass, refObjectKey, '#profile_avatar_uploader', function (rs) {
            if(rs.data.fileUrls.length > 0){
            	var imageFileUrl = rs.data.fileUrls[0];
            	$('#profile_avatar_img').attr('src', imageFileUrl);
           	 	$('#profile_avatar_input').val(imageFileUrl);
            }
        });
	}
    
</script>
